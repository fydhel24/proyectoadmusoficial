import{j as e,q as R,r as d,$ as q}from"./app-B43QGLc0.js";import{b as J,A as K,p as Q}from"./app-layout-Be3qQQND.js";import{d as x}from"./index-C7iYlLSV.js";import{u as V,B as X,T as o,P as O}from"./Box-wyR9uVm8.js";import{G as h}from"./Grid-CETg5pbP.js";import{C as f,a as k}from"./CardContent-DjPAPL63.js";import{C as y}from"./CardHeader-DaousaAn.js";import{A as Y}from"./AccessTime-DAJkkfjM.js";import{T,a as _,b as w,c as u,d as n,e as D,D as Z}from"./Delete-BkjAzzvM.js";import{C as ee}from"./Checkbox-DXyLT61I.js";import{I as A}from"./IconButton-BL5db-mN.js";import{A as se}from"./Add-BrhojVUH.js";import{D as re,a as ne,b as ie,c as ae}from"./DialogTitle-DF65PE_P.js";import{F as g,I as C,S as v}from"./Select-BCKCZh52.js";import{M as I}from"./MenuItem-DkzQH4XY.js";import{B as S}from"./Button-DYoxZ0OF.js";import"./app-logo-icon-2Eh3Z-eT.js";import"./index-CfAE_ukx.js";import"./index-HnoccPYx.js";import"./useThemeProps-B6-r2NBi.js";import"./getThemeProps-DFqRyJBL.js";import"./Grow-DipP32jZ.js";import"./Portal-DCrN8Gw5.js";import"./ButtonBase-BmVSOhCT.js";import"./CircularProgress-Bt0vLMV2.js";import"./dividerClasses-CS4maqJB.js";const te=J(e.jsx("path",{d:"M16.59 7.58 10 14.17l-3.59-3.58L5 12l5 5 8-8zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"})),oe=[{title:"weeks",href:"/weeks"},{title:"bookings",href:""}];function Ee(){var B;V();const{week:l,bookings:a,companies:b}=R().props,[E,W]=d.useState(!1),[r,c]=d.useState({userId:null,companyId:"",dayOfWeek:"",turno:""}),j=d.useMemo(()=>{const s=new Map;return a.forEach(i=>s.set(i.user.id,i.user)),Array.from(s.values())},[a]),[t,M]=d.useState(null),H=d.useMemo(()=>t?a.filter(s=>s.user.id===t):[],[t,a]),m=b.find(s=>s.id===Number(r.companyId)),$=m?[...new Set(m.availabilityDays.map(s=>s.day_of_week))]:[],F=m&&r.dayOfWeek?[...new Set(m.availabilityDays.filter(s=>s.day_of_week===r.dayOfWeek).map(s=>s.turno))]:[];function N(s){c({userId:s,companyId:"",dayOfWeek:"",turno:""}),W(!0)}function p(){W(!1)}function P(){r.userId&&r.companyId&&r.dayOfWeek&&r.turno&&x.Inertia.post(`/weeks/${l.id}/bookings`,{user_id:r.userId,company_id:r.companyId,day_of_week:r.dayOfWeek,turno:r.turno},{onSuccess:()=>{p(),x.Inertia.reload({only:["bookings"]})}})}function z(s){confirm("¿Eliminar esta reserva?")&&x.Inertia.delete(`/weeks/${l.id}/bookings/${s}`,{onSuccess:()=>x.Inertia.reload({only:["bookings"]})})}const L=a.length,U=a.filter(s=>s.status==="Active").length,G=a.filter(s=>s.status==="Completed").length;return e.jsxs(K,{breadcrumbs:oe,children:[e.jsx(q,{title:`Bookings — ${l.name}`}),e.jsxs(X,{p:3,maxWidth:1200,mx:"auto",children:[e.jsxs(o,{variant:"h4",color:"primary",gutterBottom:!0,children:["Bookings — ",l.start_date," al ",l.end_date]}),e.jsxs(h,{container:!0,spacing:2,mb:4,children:[e.jsx(h,{item:!0,xs:!0,children:e.jsxs(f,{children:[e.jsx(y,{avatar:e.jsx(Q,{}),title:"Total"}),e.jsx(k,{children:e.jsx(o,{children:L})})]})}),e.jsx(h,{item:!0,xs:!0,children:e.jsxs(f,{children:[e.jsx(y,{avatar:e.jsx(te,{}),title:"Activos"}),e.jsx(k,{children:e.jsx(o,{children:U})})]})}),e.jsx(h,{item:!0,xs:!0,children:e.jsxs(f,{children:[e.jsx(y,{avatar:e.jsx(Y,{}),title:"Completados"}),e.jsx(k,{children:e.jsx(o,{children:G})})]})})]}),e.jsxs(o,{variant:"h6",children:["Usuarios (",j.length,")"]}),e.jsx(T,{component:O,sx:{maxHeight:300,mb:4},children:e.jsxs(_,{stickyHeader:!0,size:"small",children:[e.jsx(w,{children:e.jsxs(u,{children:[e.jsx(n,{}),e.jsx(n,{children:"Nombre"}),e.jsx(n,{children:"Acción"})]})}),e.jsx(D,{children:j.map(s=>e.jsxs(u,{hover:!0,selected:s.id===t,onClick:()=>M(i=>i===s.id?null:s.id),children:[e.jsx(n,{padding:"checkbox",children:e.jsx(ee,{checked:s.id===t})}),e.jsx(n,{children:s.name}),e.jsx(n,{children:e.jsx(A,{onClick:i=>{i.stopPropagation(),N(s.id)},children:e.jsx(se,{})})})]},s.id))})]})}),t&&e.jsxs(e.Fragment,{children:[e.jsxs(o,{variant:"h6",children:["Bookings de ",(B=j.find(s=>s.id===t))==null?void 0:B.name]}),e.jsx(T,{component:O,sx:{maxHeight:300},children:e.jsxs(_,{stickyHeader:!0,size:"small",children:[e.jsx(w,{children:e.jsxs(u,{children:[e.jsx(n,{children:"Día"}),e.jsx(n,{children:"Empresa"}),e.jsx(n,{children:"Turno"}),e.jsx(n,{children:"Estado"}),e.jsx(n,{children:"Inicio"}),e.jsx(n,{children:"Fin"}),e.jsx(n,{children:"Acción"})]})}),e.jsx(D,{children:H.map(s=>e.jsxs(u,{hover:!0,children:[e.jsx(n,{children:s.day_of_week}),e.jsx(n,{children:s.company.name}),e.jsx(n,{children:s.turno}),e.jsx(n,{children:s.status}),e.jsx(n,{children:s.start_time}),e.jsx(n,{children:s.end_time}),e.jsx(n,{children:e.jsx(A,{onClick:()=>z(s.id),children:e.jsx(Z,{})})})]},s.id))})]})})]}),e.jsxs(re,{open:E,onClose:p,children:[e.jsx(ne,{children:"Nueva reserva"}),e.jsxs(ie,{children:[e.jsxs(g,{fullWidth:!0,margin:"normal",children:[e.jsx(C,{children:"Compañía"}),e.jsx(v,{value:r.companyId,onChange:s=>c(i=>({...i,companyId:Number(s.target.value),dayOfWeek:"",turno:""})),children:b.map(s=>e.jsx(I,{value:s.id,children:s.name},s.id))})]}),e.jsxs(g,{fullWidth:!0,margin:"normal",disabled:!r.companyId,children:[e.jsx(C,{children:"Día"}),e.jsx(v,{value:r.dayOfWeek,onChange:s=>c(i=>({...i,dayOfWeek:s.target.value,turno:""})),children:$.map(s=>e.jsx(I,{value:s,children:s},s))})]}),e.jsxs(g,{fullWidth:!0,margin:"normal",disabled:!r.dayOfWeek,children:[e.jsx(C,{children:"Turno"}),e.jsx(v,{value:r.turno,onChange:s=>c(i=>({...i,turno:s.target.value})),children:F.map(s=>e.jsx(I,{value:s,children:s},s))})]})]}),e.jsxs(ae,{children:[e.jsx(S,{onClick:p,children:"Cancelar"}),e.jsx(S,{variant:"contained",onClick:P,disabled:!(r.userId&&r.companyId&&r.dayOfWeek&&r.turno),children:"Crear"})]})]})]})]})}export{Ee as default};

import{r as o,a as d,j as r,$ as Y}from"./app-hmuC0z_W.js";import{A as Z}from"./app-layout-tfxOdOKB.js";import{u as _,P as ee,T as re}from"./Typography-D9aOS4L9.js";import{u as oe}from"./index-4a7AVbQy.js";import{B as I}from"./Box-4C9-OmNb.js";import{T as p}from"./TextField-C5FPbCxz.js";import{I as h}from"./IconButton-5suIbhPZ.js";import{S as te}from"./Search-BGzkUUj0.js";import{B as k}from"./Button-CI4PvYH9.js";import{E as W}from"./Edit-BRh_CxWN.js";import{T as se}from"./TableContainer-DfD3xtBG.js";import{T as ae,a as ie,b as M,c as le}from"./TableRow-CqlzVxMY.js";import{T as s}from"./TableCell-CmdScgSd.js";import{C as N}from"./Checkbox-CFIfKH9-.js";import{D as ne}from"./Delete-XrUhzWCn.js";import{D as me,a as ce,b as de}from"./DialogTitle-qfXQee4s.js";import{C as D}from"./Close-HFD67J2S.js";import{F as pe,I as he,S as ue}from"./Select-BXe5PBU8.js";import{M as B}from"./MenuItem-BrmMwhAd.js";import{D as xe}from"./DialogActions-By6P71zP.js";import"./button-BdWLbofJ.js";import"./clsx-B-dksMZM.js";import"./avatar-SH5xSAMo.js";import"./createLucideIcon-B2A0n4jm.js";import"./index-BeDZ4tg0.js";import"./index-B2CGEqEW.js";import"./index-CDmN9uZR.js";import"./settings-B81NYrWU.js";import"./app-logo-icon-DF-2vurZ.js";import"./createSvgIcon-DmtCSiy2.js";import"./DefaultPropsProvider-B9G9mrQg.js";import"./createSimplePaletteValueFilter-BLiQVDB3.js";import"./getThemeProps-Ci1Myslq.js";import"./useTimeout-CyHmLoFO.js";import"./useSlot-b8oj5fjv.js";import"./TransitionGroupContext-zx_Mae6Z.js";import"./useId-CIKGyZXY.js";import"./ButtonBase-CKxFeLN_.js";import"./CircularProgress-DbGwbuXF.js";import"./SwitchBase-5uCyApIu.js";import"./useControlled-D8uUDMf0.js";import"./Fade-CwyH9ByJ.js";import"./Modal-B3L5jhwL.js";import"./ownerDocument-DW-IO8s5.js";import"./Portal-3qAPjvvz.js";import"./isMuiElement-DUef8CkO.js";import"./index-CPN-dXc6.js";import"./useSlotProps-B7GeVvJr.js";import"./List-e32Tbcmu.js";import"./debounce-Be36O1Ab.js";import"./Grow-CwDNX7JD.js";import"./listItemTextClasses-BuwBTG13.js";import"./dividerClasses-DyS1-ewh.js";const fe=[{title:"Usuarios y Roles",href:"/users-roles"}];function fr(){const[L,z]=o.useState([]),[A,l]=o.useState(!1),[u,x]=o.useState(""),[f,g]=o.useState(""),[j,T]=o.useState(""),[b,C]=o.useState(null),[H,P]=o.useState([]),[w,U]=o.useState(!1),[m,R]=o.useState(!1),[$,q]=o.useState(null),[S,F]=o.useState(""),[c,v]=o.useState([]),a=_(),i=oe(a.breakpoints.down("sm"));o.useEffect(()=>{y(),G()},[]);const y=()=>{d.get("/api/users").then(e=>z(e.data)).catch(e=>console.error("Error fetching users:",e))},G=()=>{d.get("/api/roles").then(e=>P(e.data)).catch(e=>console.error("Error fetching roles:",e))},Q=()=>{R(!1),x(""),g(""),T(""),C(""),l(!0)},X=e=>{var t;R(!0),q(e.id),x(e.name),g(e.email),C(((t=e.roles[0])==null?void 0:t.name)||""),l(!0)},J=()=>{if(!u.trim()||!f.trim()||!m&&!j.trim()||!b)return alert("Todos los campos son obligatorios");U(!0);const e={name:u,email:f,password:j,role:b};(m?d.put(`/users/${$}`,e):d.post("/users",e)).then(()=>{l(!1),y()}).catch(E=>{console.error("Error guardando el usuario:",E),alert("Hubo un error")}).finally(()=>U(!1))},K=e=>{confirm("¿Estás seguro de que deseas eliminar este usuario?")&&d.delete(`/users/${e}`).then(()=>y()).catch(t=>{console.error("Error al eliminar el usuario:",t),alert("Hubo un error al eliminar el usuario")})},n=L.filter(e=>e.name.toLowerCase().includes(S.toLowerCase())||e.email.toLowerCase().includes(S.toLowerCase())),O=e=>{v(t=>t.includes(e)?t.filter(E=>E!==e):[...t,e])},V=()=>{c.length===n.length?v([]):v(n.map(e=>e.id))};return r.jsxs(Z,{breadcrumbs:fe,children:[r.jsx(Y,{title:"Usuarios y Roles"}),r.jsxs(I,{sx:{padding:2},children:[r.jsxs(I,{sx:{display:"flex",alignItems:"center",marginBottom:2},children:[r.jsx(p,{label:"Buscar",variant:"outlined",size:"small",fullWidth:!0,value:S,onChange:e=>F(e.target.value),sx:{marginRight:2},InputProps:{startAdornment:r.jsx(h,{children:r.jsx(te,{})})}}),r.jsx(k,{variant:"contained",color:"primary",sx:{ml:2},onClick:Q,startIcon:r.jsx(W,{}),children:"Nuevo Usuario"})]}),r.jsx(se,{component:ee,sx:{borderRadius:2,boxShadow:3,overflowX:"auto",maxHeight:"calc(100vh - 200px)"},children:r.jsxs(ae,{stickyHeader:!0,sx:{minWidth:650},children:[r.jsx(ie,{children:r.jsxs(M,{children:[r.jsx(s,{padding:"checkbox",children:r.jsx(N,{color:"primary",checked:n.length>0&&c.length===n.length,indeterminate:c.length>0&&c.length<n.length,onChange:V})}),r.jsx(s,{sx:{fontWeight:"bold",backgroundColor:a.palette.primary.main,color:a.palette.common.white,padding:i?"8px":"16px",fontSize:i?"0.875rem":"1rem"},children:"Nombre"}),r.jsx(s,{sx:{fontWeight:"bold",backgroundColor:a.palette.primary.main,color:a.palette.common.white,padding:i?"8px":"16px",fontSize:i?"0.875rem":"1rem"},children:"Email"}),r.jsx(s,{sx:{fontWeight:"bold",backgroundColor:a.palette.primary.main,color:a.palette.common.white,padding:i?"8px":"16px",fontSize:i?"0.875rem":"1rem"},children:"Rol"}),r.jsx(s,{sx:{fontWeight:"bold",backgroundColor:a.palette.primary.main,color:a.palette.common.white,padding:i?"8px":"16px",fontSize:i?"0.875rem":"1rem"},children:"Acciones"})]})}),r.jsx(le,{children:n.map(e=>r.jsxs(M,{hover:!0,children:[r.jsx(s,{padding:"checkbox",children:r.jsx(N,{color:"primary",checked:c.includes(e.id),onChange:()=>O(e.id)})}),r.jsx(s,{children:e.name}),r.jsx(s,{children:e.email}),r.jsx(s,{children:e.roles&&e.roles.length>0?e.roles.map(t=>t.name).join(", "):r.jsx("span",{className:"italic text-gray-400",children:"Sin rol"})}),r.jsxs(s,{children:[r.jsx(h,{color:"primary",onClick:()=>X(e),"aria-label":"Editar",children:r.jsx(W,{})}),r.jsx(h,{color:"error",onClick:()=>K(e.id),"aria-label":"Eliminar",children:r.jsx(ne,{})})]})]},e.id))})]})})]}),r.jsxs(me,{open:A,onClose:()=>l(!1),maxWidth:"sm",fullWidth:!0,children:[r.jsxs(ce,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx(re,{variant:"h6",children:m?"Editar Usuario":"Crear Nuevo Usuario"}),r.jsx(h,{onClick:()=>l(!1),children:r.jsx(D,{})})]}),r.jsxs(de,{dividers:!0,children:[r.jsx(p,{label:"Nombre del usuario",variant:"outlined",fullWidth:!0,value:u,onChange:e=>x(e.target.value),sx:{mb:2}}),r.jsx(p,{label:"Email del usuario",variant:"outlined",fullWidth:!0,value:f,onChange:e=>g(e.target.value),sx:{mb:2}}),!m&&r.jsx(p,{label:"Contraseña",variant:"outlined",fullWidth:!0,type:"password",value:j,onChange:e=>T(e.target.value),sx:{mb:2}}),r.jsxs(pe,{fullWidth:!0,sx:{mb:2},children:[r.jsx(he,{id:"select-role-label",children:"Rol"}),r.jsxs(ue,{labelId:"select-role-label",value:b||"",label:"Rol",onChange:e=>C(e.target.value),children:[r.jsx(B,{value:"",children:r.jsx("em",{children:"Seleccionar rol"})}),H.map(e=>r.jsx(B,{value:e.name,children:e.name},e.id))]})]})]}),r.jsxs(xe,{children:[r.jsx(k,{onClick:()=>l(!1),color:"inherit",variant:"outlined",disabled:w,startIcon:r.jsx(D,{}),children:"Cancelar"}),r.jsx(k,{onClick:J,color:"primary",variant:"contained",disabled:w,children:w?"Guardando...":m?"Actualizar":"Crear"})]})]})]})}export{fr as default};

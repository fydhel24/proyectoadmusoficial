import{q,r as a,j as e,Y as c,m as i}from"./app-CyHY4qXq.js";import{A as z}from"./app-layout-CR2VM0FS.js";import{T as C}from"./TextField-CaWg8z4c.js";import{D as S,a as I,b as w}from"./DialogTitle-CsQ7IZVm.js";import{D}from"./DialogActions-DzIW1MJD.js";import{B as d}from"./Button-B5QymhUM.js";import"./button-D9s6bao3.js";import"./clsx-B-dksMZM.js";import"./avatar-DM9x7_D4.js";import"./createLucideIcon-DzD-rnf8.js";import"./index-Rp65u7US.js";import"./index-B36Mxma7.js";import"./index-CQLPyUva.js";import"./settings-DdDrqPmp.js";import"./app-logo-icon-C6G1VvIS.js";import"./createSvgIcon-DFkYpeFR.js";import"./DefaultPropsProvider-CieIQJ4l.js";import"./useSlot-BD1cC_p3.js";import"./TransitionGroupContext-BSxo9aJI.js";import"./useId-AiqUT9-C.js";import"./Select-6JcSj1Oi.js";import"./isMuiElement-tDv9Kr5f.js";import"./createSimplePaletteValueFilter-CHgcW5pF.js";import"./index-DeuVn2yV.js";import"./useSlotProps-mZ78eGn3.js";import"./List-FQZRBiMT.js";import"./Typography-DquxNzfk.js";import"./ownerDocument-DW-IO8s5.js";import"./Modal-Br5Yv6Vo.js";import"./useTimeout-2kURTJpt.js";import"./Portal-3K29QfTN.js";import"./Fade-CJOgqix0.js";import"./debounce-Be36O1Ab.js";import"./Grow-BhDWOfCT.js";import"./useControlled-BWKDwO3o.js";import"./ButtonBase-B7jPhJrj.js";import"./CircularProgress-BcU9b_yV.js";const Ie=()=>{const{informes:p,filters:M}=q().props,[E,A]=a.useState(M.search||""),[T,x]=a.useState(!1),[_,h]=a.useState(!1),[l,n]=a.useState(""),[u,j]=a.useState(null),[g,y]=a.useState([]),[k,f]=a.useState(""),O=t=>{confirm("¿Eliminar este informe?")&&i.delete(route("informes.destroy",t))},F=t=>{j(t),n(""),x(!0)},m=()=>{x(!1),j(null),n("")},L=()=>{!l||u===null||i.post(route("comentarios.store"),{contenido:l,informe_id:u},{onSuccess:()=>{m(),alert("Comentario agregado con éxito!")}})},B=t=>{y(t.comentarios??[]),f(t.titulo),h(!0)},b=()=>{y([]),f(""),h(!1)},W=t=>{A(t.target.value),i.get(route("informes.index"),{search:t.target.value},{preserveState:!0,replace:!0})},Y=p.data.reduce((t,s)=>{var o;const r=((o=s.company)==null?void 0:o.name)??"Sin empresa";return t[r]||(t[r]=[]),t[r].push(s),t},{});return e.jsx(z,{children:e.jsxs("div",{className:"mx-auto max-w-7xl px-6 py-10",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Listado de Informes"}),e.jsx(c,{href:route("informes.create"),className:"rounded bg-blue-600 px-4 py-2 font-semibold text-white transition hover:bg-blue-700",children:"Crear Informe"})]}),e.jsx("div",{className:"mb-4",children:e.jsx(C,{label:"Buscar informes...",variant:"outlined",size:"small",value:E,onChange:W,className:"w-64"})}),e.jsx("div",{className:"overflow-x-auto rounded bg-white shadow",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-left text-sm",children:[e.jsx("thead",{className:"bg-gray-100 tracking-wider text-gray-600 uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Empresa"}),e.jsx("th",{className:"px-4 py-3",children:"Título"}),e.jsx("th",{className:"px-4 py-3",children:"Estado"}),e.jsx("th",{className:"px-4 py-3",children:"Fecha Inicio"}),e.jsx("th",{className:"px-4 py-3",children:"Fecha Fin"}),e.jsx("th",{className:"px-4 py-3",children:"Descripción"}),e.jsx("th",{className:"px-4 py-3",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:Object.entries(Y).map(([t,s])=>s.map((r,o)=>{var N,v;return e.jsxs("tr",{className:"transition hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 font-medium",children:o===0?e.jsx(c,{href:route("empresas.detalle",{id:(N=r.company)==null?void 0:N.id}),className:"text-blue-600 hover:text-blue-800",children:t}):""}),e.jsx("td",{className:"px-4 py-2 font-medium",children:r.titulo}),e.jsx("td",{className:"px-4 py-2",children:r.estado??"-"}),e.jsx("td",{className:"px-4 py-2",children:r.fecha_inicio}),e.jsx("td",{className:"px-4 py-2",children:r.fecha_fin??"-"}),e.jsx("td",{className:"px-4 py-2",children:((v=r.descripcion)==null?void 0:v.substring(0,50))??"-"}),e.jsxs("td",{className:"flex space-x-2 px-4 py-2",children:[e.jsx(c,{href:route("informes.edit",r.id),className:"text-sm text-blue-600 hover:text-blue-800",children:"Editar"}),e.jsx("button",{onClick:()=>O(r.id),className:"text-sm text-red-600 hover:text-red-800",children:"Eliminar"}),e.jsx("button",{onClick:()=>F(r.id),className:"text-sm text-green-600 hover:text-green-800",children:"Agregar Comentario"}),e.jsx("button",{onClick:()=>B(r),className:"text-sm text-gray-600 hover:text-gray-800",children:"Ver Comentarios"})]})]},r.id)}))})]})}),e.jsx("div",{className:"mt-4 flex justify-end space-x-2",children:p.links.map((t,s)=>e.jsx("button",{className:`px-3 py-1 rounded ${t.active?"bg-blue-600 text-white":"bg-gray-200 text-gray-700"}`,disabled:!t.url,onClick:()=>t.url&&i.get(t.url,{},{preserveState:!0,replace:!0}),dangerouslySetInnerHTML:{__html:t.label}},s))}),e.jsxs(S,{open:T,onClose:m,children:[e.jsx(I,{children:"Agregar Comentario"}),e.jsx(w,{children:e.jsx(C,{label:"Comentario",fullWidth:!0,multiline:!0,rows:4,value:l,onChange:t=>n(t.target.value)})}),e.jsxs(D,{children:[e.jsx(d,{onClick:m,color:"secondary",children:"Cancelar"}),e.jsx(d,{onClick:L,variant:"contained",color:"primary",children:"Guardar"})]})]}),e.jsxs(S,{open:_,onClose:b,fullWidth:!0,maxWidth:"sm",children:[e.jsxs(I,{children:['Comentarios de "',k,'"']}),e.jsx(w,{dividers:!0,children:g.length>0?g.map(t=>{var s;return e.jsxs("div",{className:"mb-4 border-b border-gray-200 pb-2",children:[e.jsx("p",{className:"text-gray-800",children:t.contenido}),e.jsxs("p",{className:"text-xs text-gray-500",children:[((s=t.user)==null?void 0:s.name)??"Usuario"," - ",new Date(t.created_at).toLocaleString()]})]},t.id)}):e.jsx("p",{className:"text-gray-500",children:"No hay comentarios para este informe."})}),e.jsx(D,{children:e.jsx(d,{onClick:b,color:"primary",children:"Cerrar"})})]})]})})};export{Ie as default};

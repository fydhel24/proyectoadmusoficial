import{r as i,j as t,$ as Y}from"./app-B43QGLc0.js";import{A as Z}from"./app-layout-Be3qQQND.js";import{D as K,T as ee,a as te,b as oe,c as N,d as c,e as ae}from"./Delete-BkjAzzvM.js";import{E as R}from"./Edit-ObCAyVeJ.js";import{S as ne}from"./Search-FSgN8jeY.js";import{u as ie,B as P,T as se,P as re}from"./Box-wyR9uVm8.js";import{T as I}from"./TextField-DxJvG6sb.js";import{I as A}from"./IconButton-BL5db-mN.js";import{T as le,a as ce}from"./TablePagination-ByLNpSOA.js";import{C as q}from"./Checkbox-DXyLT61I.js";import{T as w}from"./TableSortLabel-BhlA9Og9.js";import{S as de}from"./Snackbar-DXjD44eI.js";import"./app-logo-icon-2Eh3Z-eT.js";import"./index-CfAE_ukx.js";import"./index-HnoccPYx.js";import"./Grow-DipP32jZ.js";import"./Select-BCKCZh52.js";import"./Portal-DCrN8Gw5.js";import"./ButtonBase-BmVSOhCT.js";import"./CircularProgress-Bt0vLMV2.js";import"./MenuItem-DkzQH4XY.js";import"./dividerClasses-CS4maqJB.js";const me=[{title:"Listado de influencers",href:"/infuencersdatos"}];function H(a,m,s){return m[s]<a[s]?-1:m[s]>a[s]?1:0}function ue(a,m){return a==="desc"?(s,r)=>H(s,r,m):(s,r)=>-H(s,r,m)}function pe(a,m){const s=a.map((r,g)=>[r,g]);return s.sort((r,g)=>{const u=m(r[0],g[0]);return u!==0?u:r[1]-g[1]}),s.map(r=>r[0])}function Oe(){const a=ie(),[m,s]=i.useState([]),[r,g]=i.useState(""),[u,C]=i.useState(null),[y,M]=i.useState(null),[f,j]=i.useState(""),[E,h]=i.useState(null),[d,$]=i.useState("asc"),[l,U]=i.useState("id"),[p,z]=i.useState([]),[T,O]=i.useState(0),[S,X]=i.useState(10);i.useEffect(()=>{fetch("/api/infuencersdatos").then(e=>e.json()).then(e=>s(e)).catch(e=>console.error("Error fetching users:",e))},[]);const B=async e=>{var n;if(window.confirm("¿Estás seguro de que deseas eliminar este usuario?"))try{const o=(n=document.querySelector('meta[name="csrf-token"]'))==null?void 0:n.getAttribute("content");await fetch(`/infuencersdatos/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":o||""}}),s(v=>v.filter(W=>W.id!==e)),h("Usuario eliminado exitosamente")}catch{h("Hubo un error al eliminar el usuario")}},b=(e,n,o)=>{C(e),M(n),j(o),n==="cantidad"&&!o&&j(0)},k=async()=>{var n;if(f.toString().trim()===""){h("El campo no puede estar vacío.");return}const e={[y]:f};try{const o=(n=document.querySelector('meta[name="csrf-token"]'))==null?void 0:n.getAttribute("content"),v=await fetch(`/infuencersdatos/${u}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":o||""},body:JSON.stringify(e)});if(!v.ok)throw new Error("Error al actualizar el campo");const W=await v.json();s(Q=>Q.map(F=>F.id===u?{...F,[y]:f}:F)),h("Campo actualizado exitosamente"),C(null),M(null),j("")}catch{h("Hubo un error al actualizar el campo")}},x=i.useMemo(()=>m.filter(e=>e.name.toLowerCase().includes(r.toLowerCase())||String(e.id).includes(r)),[m,r]),L=i.useMemo(()=>pe(x,ue(d,l)),[x,d,l]),V=i.useMemo(()=>L.slice(T*S,T*S+S),[L,T,S]),D=e=>{$(l===e&&d==="asc"?"desc":"asc"),U(e)},J=e=>{e.target.checked?z(x.map(n=>n.id)):z([])},_=e=>{z(n=>n.includes(e)?n.filter(o=>o!==e):[...n,e])},G=e=>p.indexOf(e)!==-1;return i.useEffect(()=>{if(!E)return;const e=setTimeout(()=>h(null),4e3);return()=>clearTimeout(e)},[E]),t.jsxs(Z,{breadcrumbs:me,children:[t.jsx(Y,{title:"Influencer"}),t.jsx(P,{sx:{display:"flex",gap:2,mb:3,alignItems:"center"},children:t.jsx(I,{label:"Buscar por nombre o ID",variant:"outlined",size:"small",value:r,onChange:e=>g(e.target.value),sx:{maxWidth:320},InputProps:{startAdornment:t.jsx(A,{tabIndex:-1,children:t.jsx(ne,{})})}})}),p.length>0&&t.jsxs(le,{sx:{bgcolor:"action.selected",mb:1,borderRadius:2},children:[t.jsxs(se,{sx:{flex:"1 1 100%"},color:"inherit",children:[p.length," seleccionado",p.length>1?"s":""]}),t.jsx(A,{color:"error",onClick:()=>p.forEach(e=>B(e)),children:t.jsx(K,{})})]}),t.jsxs(ee,{component:re,sx:{borderRadius:2,boxShadow:3,overflowX:"auto",border:"1px solid #e0e0e0",background:a.palette.background.paper,mx:{xs:0,md:2}},children:[t.jsxs(te,{size:"small",children:[t.jsx(oe,{children:t.jsxs(N,{children:[t.jsx(c,{padding:"checkbox",sx:{backgroundColor:a.palette.primary.main,color:a.palette.common.white},children:t.jsx(q,{indeterminate:p.length>0&&p.length<x.length,checked:x.length>0&&p.length===x.length,onChange:J,sx:{color:a.palette.common.white}})}),t.jsx(c,{sortDirection:l==="id"?d:!1,sx:{fontWeight:"bold",backgroundColor:a.palette.primary.main,color:a.palette.common.white},children:t.jsx(w,{active:l==="id",direction:l==="id"?d:"asc",onClick:()=>D("id"),sx:{color:a.palette.common.white,"&.Mui-active":{color:a.palette.common.white}},children:"ID"})}),t.jsx(c,{sortDirection:l==="name"?d:!1,sx:{fontWeight:"bold",backgroundColor:a.palette.primary.main,color:a.palette.common.white},children:t.jsx(w,{active:l==="name",direction:l==="name"?d:"asc",onClick:()=>D("name"),sx:{color:a.palette.common.white,"&.Mui-active":{color:a.palette.common.white}},children:"Nombre"})}),t.jsx(c,{sortDirection:l==="email"?d:!1,sx:{fontWeight:"bold",backgroundColor:a.palette.primary.main,color:a.palette.common.white},children:t.jsx(w,{active:l==="email",direction:l==="email"?d:"asc",onClick:()=>D("email"),sx:{color:a.palette.common.white,"&.Mui-active":{color:a.palette.common.white}},children:"Email"})}),t.jsx(c,{sortDirection:l==="cantidad"?d:!1,sx:{fontWeight:"bold",backgroundColor:a.palette.primary.main,color:a.palette.common.white},children:t.jsx(w,{active:l==="cantidad",direction:l==="cantidad"?d:"asc",onClick:()=>D("cantidad"),sx:{color:a.palette.common.white,"&.Mui-active":{color:a.palette.common.white}},children:"Cantidad de videos asignados"})}),t.jsx(c,{sx:{fontWeight:"bold",backgroundColor:a.palette.primary.main,color:a.palette.common.white},children:"Acciones"})]})}),t.jsx(ae,{children:V.map(e=>{const n=G(e.id);return t.jsxs(N,{hover:!0,selected:n,onClick:()=>_(e.id),children:[t.jsx(c,{padding:"checkbox",children:t.jsx(q,{checked:n})}),t.jsx(c,{children:e.id}),t.jsx(c,{children:u===e.id&&y==="name"?t.jsx(I,{value:f,size:"small",autoFocus:!0,onChange:o=>j(o.target.value),onBlur:k,onKeyDown:o=>{o.key==="Enter"&&k(),o.key==="Escape"&&C(null)}}):t.jsxs(P,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(R,{fontSize:"small",color:"action",sx:{cursor:"pointer"},onClick:o=>{o.stopPropagation(),b(e.id,"name",e.name)}}),t.jsx("span",{onDoubleClick:()=>b(e.id,"name",e.name),style:{cursor:"pointer"},title:"Doble click para editar",children:e.name})]})}),t.jsx(c,{children:u===e.id&&y==="email"?t.jsx(I,{value:f,size:"small",autoFocus:!0,onChange:o=>j(o.target.value),onBlur:k,onKeyDown:o=>{o.key==="Enter"&&k(),o.key==="Escape"&&C(null)}}):t.jsxs(P,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(R,{fontSize:"small",color:"action",sx:{cursor:"pointer"},onClick:o=>{o.stopPropagation(),b(e.id,"email",e.email)}}),t.jsx("span",{onDoubleClick:()=>b(e.id,"email",e.email),style:{cursor:"pointer"},title:"Doble click para editar",children:e.email})]})}),t.jsx(c,{children:u===e.id&&y==="cantidad"?t.jsx(I,{type:"number",value:f,size:"small",autoFocus:!0,onChange:o=>j(o.target.value),onBlur:k,onKeyDown:o=>{o.key==="Enter"&&k(),o.key==="Escape"&&C(null)}}):t.jsxs(P,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(R,{fontSize:"small",color:"action",sx:{cursor:"pointer"},onClick:o=>{o.stopPropagation(),b(e.id,"cantidad",e.cantidad)}}),t.jsx("span",{onDoubleClick:()=>b(e.id,"cantidad",e.cantidad),style:{cursor:"pointer"},title:"Doble click para editar",children:e.cantidad})]})}),t.jsx(c,{children:t.jsx(A,{size:"small",color:"error",onClick:o=>{o.stopPropagation(),B(e.id)},children:t.jsx(K,{})})})]},e.id)})})]}),t.jsx(ce,{component:"div",count:x.length,page:T,rowsPerPage:S,onPageChange:(e,n)=>O(n),onRowsPerPageChange:e=>{X(parseInt(e.target.value,10)),O(0)},rowsPerPageOptions:[5,10,25],labelRowsPerPage:"Filas por página"})]}),t.jsx(de,{open:!!E,message:E,onClose:()=>h(null),autoHideDuration:4e3})]})}export{Oe as default};

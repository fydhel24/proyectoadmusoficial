import{q as Z,r as a,j as e,m as y}from"./app-YEuHkux5.js";import{A as ee,B as se,P as re}from"./app-layout-Dh5sl-jU.js";import{B as C}from"./Box-DZXJg_qv.js";import{C as te}from"./Card-DmMu79y6.js";import{C as ae}from"./CardHeader-DpzeDNoD.js";import{S as w}from"./Stack-DH4x_kPu.js";import{B as g}from"./Button-CMjaMz42.js";import{T as oe}from"./TextField-CpThoci2.js";import{C as ne}from"./CardContent-DNXYRSCg.js";import{A as L}from"./Alert-M1Fv6YQG.js";import{P as ie,T as j}from"./Typography-D8rBbavg.js";import{T as le,a as ce,b as _,c as de}from"./TableRow-cov9Pl37.js";import{T as d}from"./TableCell-9OmuTGMb.js";import{C as me}from"./Chip-D0HSmcM1.js";import{I as H}from"./IconButton-DepEmupO.js";import{D as pe}from"./Delete-Ct1Ol2la.js";import{A as xe}from"./Add-DFr0aPth.js";import{D as he,a as ue,b as ge}from"./DialogTitle-DT-dALo8.js";import{C as je}from"./Close-Bm0cbP4p.js";import{F as fe,I as be,S as Se}from"./Select-B_eRVbu_.js";import{M as De}from"./MenuItem-EZI4tQJZ.js";import{D as ye}from"./DialogActions-DSNCgedV.js";import"./button-_5e2JbJM.js";import"./clsx-B-dksMZM.js";import"./avatar-DPKp3hQk.js";import"./createLucideIcon-9JrBpBfL.js";import"./index-D3g71isE.js";import"./index-B2kdsAU2.js";import"./index-m3ZdHyWT.js";import"./settings-d7GkTK56.js";import"./app-logo-icon-BYryv9rn.js";import"./createSvgIcon-Bv7lX4UF.js";import"./DefaultPropsProvider-CEXgxhq8.js";import"./useSlot-q3G4gJ7a.js";import"./TransitionGroupContext-mQf08jKB.js";import"./useThemeProps-B1feN13w.js";import"./getThemeProps-BO29yZBp.js";import"./createSimplePaletteValueFilter-J_8iZNoO.js";import"./useId-DF1cwINX.js";import"./ButtonBase-CS4YXIYb.js";import"./useTimeout-g4Ibx1fA.js";import"./CircularProgress-Bn3EXqD5.js";import"./Close-B3-jeOLy.js";import"./Fade-pc_dseJo.js";import"./Modal-B5zRzlCf.js";import"./ownerDocument-DW-IO8s5.js";import"./Portal-1gL4VHaW.js";import"./isMuiElement-C40F-WzM.js";import"./index-CyVCCTxO.js";import"./useSlotProps-BXV3urdk.js";import"./List-2At25vZV.js";import"./debounce-Be36O1Ab.js";import"./Grow-J0HjpUkY.js";import"./useControlled-CZTOPfKL.js";import"./listItemTextClasses-B6w7MOm2.js";import"./dividerClasses-Df44jC95.js";const As=()=>{var F;const{companies:v,pasantes:R,asignaciones:O,currentWeek:m,weeks:Ce,diasSemana:p,turnos:k,flash:n,filters:f}=Z().props,[$,A]=a.useState(!1),[b,T]=a.useState(null),[S,P]=a.useState(""),[c,I]=a.useState(""),[x,W]=a.useState(null),[G,we]=a.useState(m.id),[z,B]=a.useState(!1),[U,q]=a.useState((f==null?void 0:f.search)||""),[o,E]=a.useState(null),N=s=>{q(s),y.get("/semana-pasantes",{week_id:m.id,search:s},{preserveState:!0,replace:!0})},h=a.useMemo(()=>{const s=new Date(m.start_date),r={};return p.forEach((l,t)=>{const i=new Date(s);i.setDate(s.getDate()+t),r[l]=i.toISOString().split("T")[0]}),r},[m,p]),J=(s,r,l)=>{T(s),P(r),I(l),A(!0)},u=()=>{A(!1),T(null),P(""),I(""),W(null)},K=async()=>{if(!(!x||!b||!S||!c)){B(!0);try{await y.post("/asignacion-pasantes",{user_id:x,company_id:b,turno:S,dia:c,week_id:G,fecha:h[c]}),u()}catch(s){console.error("Error al asignar pasante:",s)}finally{B(!1)}}},Q=async s=>{if(confirm("¿Estás seguro de eliminar esta asignación?"))try{await y.delete(`/asignacion-pasantes/${s}`)}catch(r){console.error("Error al eliminar asignación:",r)}},V=(s,r,l)=>{var t,i;return((i=(t=O[s])==null?void 0:t[r])==null?void 0:i[l])||[]},X=async()=>{try{window.open("/generar-pdf-disponibilidad","_blank")}catch(s){console.error("Error al generar el PDF:",s),alert("Hubo un error al generar el PDF. Por favor, inténtalo de nuevo.")}},Y=s=>s.split(" ")[0];return e.jsx(ee,{children:e.jsxs(C,{sx:{p:3},children:[e.jsxs(te,{children:[e.jsx(ae,{title:`Gestión de Pasantes - ${m.name}`,action:e.jsxs(w,{direction:"row",spacing:2,children:[e.jsx(g,{variant:"contained",color:"success",onClick:X,children:"Generar PDF"}),e.jsx(oe,{size:"small",label:"Buscar empresa",variant:"outlined",value:U,onChange:s=>N(s.target.value)})]})}),e.jsxs(ne,{children:[(n==null?void 0:n.success)&&e.jsx(L,{severity:"success",sx:{mb:2},children:n.success}),(n==null?void 0:n.error)&&e.jsx(L,{severity:"error",sx:{mb:2},children:n.error}),e.jsx(ie,{sx:{overflow:"auto"},children:e.jsxs(le,{size:"small",children:[e.jsx(ce,{children:e.jsxs(_,{children:[e.jsxs(d,{sx:{width:150,fontWeight:"bold",position:"sticky",left:0,zIndex:10,bgcolor:"background.paper"},children:[e.jsx(se,{sx:{mr:1,verticalAlign:"middle"}}),"Empresa"]}),e.jsx(d,{sx:{width:100,fontWeight:"bold"},children:"Turno"}),p.map(s=>e.jsxs(d,{sx:{minWidth:150,fontWeight:"bold"},children:[s.charAt(0).toUpperCase()+s.slice(1),e.jsx("br",{}),e.jsx(j,{variant:"caption",color:"textSecondary",children:new Date(new Date(h[s]).setDate(new Date(h[s]).getDate()+1)).toLocaleDateString()})]},s))]})}),e.jsx(de,{children:v.map(s=>k.map((r,l)=>e.jsxs(_,{children:[l===0&&e.jsx(d,{rowSpan:k.length,sx:{verticalAlign:"top",borderRight:1,borderRightColor:"divider",position:"sticky",left:0,zIndex:5,bgcolor:"background.paper"},children:e.jsx(j,{variant:"body2",fontWeight:"medium",children:s.name})}),e.jsx(d,{sx:{fontWeight:"medium"},children:e.jsx(me,{label:r.charAt(0).toUpperCase()+r.slice(1),size:"small",color:r==="mañana"?"primary":r==="tarde"?"secondary":"default"})}),p.map(t=>{const i=V(s.id,r,t),M=(o==null?void 0:o.companyId)===s.id&&(o==null?void 0:o.turno)===r&&(o==null?void 0:o.dia)===t;return e.jsx(d,{sx:{verticalAlign:"top"},onMouseEnter:()=>E({companyId:s.id,turno:r,dia:t}),onMouseLeave:()=>E(null),children:e.jsxs(w,{spacing:1,children:[i.map(D=>e.jsxs(C,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",bgcolor:"grey.100",p:1,borderRadius:1,fontSize:"0.875rem"},children:[e.jsxs(C,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(re,{sx:{fontSize:16,mr:.5}}),e.jsx(j,{variant:"body2",children:Y(D.user.name)})]}),e.jsx(H,{size:"small",color:"error",onClick:()=>Q(D.id),children:e.jsx(pe,{sx:{fontSize:16}})})]},D.id)),(M||i.length===0)&&e.jsx(g,{size:"small",startIcon:e.jsx(xe,{}),variant:"outlined",sx:{mt:1,opacity:M?1:0,transition:"opacity 0.2s ease-in-out"},onClick:()=>J(s.id,r,t),children:"Agregar"})]})},t)})]},`${s.id}-${r}`)))})]})})]})]}),e.jsxs(he,{open:$,onClose:u,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(ue,{children:["Agregar Pasante",e.jsx(H,{onClick:u,sx:{position:"absolute",right:8,top:8},children:e.jsx(je,{})})]}),e.jsx(ge,{children:e.jsxs(w,{spacing:3,sx:{mt:2},children:[e.jsxs(j,{variant:"body1",children:[e.jsx("strong",{children:"Empresa:"})," ",(F=v.find(s=>s.id===b))==null?void 0:F.name,e.jsx("br",{}),e.jsx("strong",{children:"Turno:"})," ",S,e.jsx("br",{}),e.jsx("strong",{children:"Día:"})," ",c,e.jsx("br",{}),e.jsx("strong",{children:"Fecha:"})," ",c?new Date(h[c]).toLocaleDateString():""]}),e.jsxs(fe,{fullWidth:!0,children:[e.jsx(be,{children:"Seleccionar Pasante"}),e.jsx(Se,{value:x||"",label:"Seleccionar Pasante",onChange:s=>W(s.target.value),children:R.map(s=>e.jsx(De,{value:s.id,children:s.name},s.id))})]})]})}),e.jsxs(ye,{children:[e.jsx(g,{onClick:u,children:"Cancelar"}),e.jsx(g,{onClick:K,variant:"contained",disabled:!x||z,children:z?"Asignando...":"Asignar Pasante"})]})]})]})})};export{As as default};

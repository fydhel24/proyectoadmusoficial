import{q as Z,r as a,j as e,m as y}from"./app-DwTpSH0U.js";import{A as ee,B as re,P as se}from"./app-layout-DnzGBPFG.js";import{B as D}from"./Box-Dm-9Odlo.js";import{C as te}from"./Card-BU2PQy8v.js";import{C as ae}from"./CardHeader-G0Iww25E.js";import{S as k}from"./Stack-CfXKeJ1o.js";import{B as g}from"./Button-D3LYaN2t.js";import{T as oe}from"./TextField-C7xTuRXe.js";import{C as ie}from"./CardContent-CdRAFDU_.js";import{A as H}from"./Alert-CXzScL7w.js";import{P as ne,T as u}from"./Typography-B8heRhDi.js";import{T as le,a as ce,b as _,c as de}from"./TableRow-CEnFIRrY.js";import{T as c}from"./TableCell-Bne9Txfy.js";import{C as me}from"./Chip-BiIDCYhV.js";import{I as L}from"./IconButton-zbVVF-M4.js";import{D as pe}from"./Delete-CQLmOos_.js";import{A as xe}from"./Add-DVZ5trvM.js";import{D as he,a as ge,b as ue}from"./DialogTitle-ZAyjaWw9.js";import{C as je}from"./Close-4wzGaFRr.js";import{F as fe,I as be,S as Ce}from"./Select-D3mwh1vN.js";import{M as Se}from"./MenuItem-BREP7BA3.js";import{D as ye}from"./DialogActions-jpbpOf34.js";import"./button-CE2sw9In.js";import"./clsx-B-dksMZM.js";import"./avatar-3rZPDCsD.js";import"./createLucideIcon-8z-XiBgF.js";import"./index-DQwHB60N.js";import"./index-Bu13Uyqm.js";import"./index-DuFQU5C7.js";import"./settings-BWGxbpXO.js";import"./app-logo-icon-kT6HeMlV.js";import"./createSvgIcon-DkcSd2-O.js";import"./DefaultPropsProvider-DRRnqVYH.js";import"./useSlot-DErp_0ST.js";import"./TransitionGroupContext-nALX_Gj3.js";import"./useThemeProps-BzNHYq9I.js";import"./getThemeProps-BDgLecqf.js";import"./createSimplePaletteValueFilter-fPviOYGM.js";import"./useId-DQCmvY1A.js";import"./ButtonBase-DRmvLRZN.js";import"./useTimeout--HoZvQIH.js";import"./CircularProgress-D9k1A7p4.js";import"./Close-C7XsUd9X.js";import"./Fade-CPmkmtx1.js";import"./Modal-EvmVwdIL.js";import"./ownerDocument-DW-IO8s5.js";import"./Portal-dRwe7D2B.js";import"./isMuiElement-BJS3qdzF.js";import"./index-Bw2APseq.js";import"./useSlotProps-BNWp3nnv.js";import"./List-NBjoO2Ug.js";import"./debounce-Be36O1Ab.js";import"./Grow-BaQddceE.js";import"./useControlled-CkY63cvR.js";import"./listItemTextClasses-PvA2CV_-.js";import"./dividerClasses-DGcU9ie_.js";const Ar=()=>{var M;const{companies:v,pasantes:R,asignaciones:O,currentWeek:d,weeks:De,diasSemana:m,turnos:w,flash:i,filters:j}=Z().props,[$,A]=a.useState(!1),[f,T]=a.useState(null),[b,I]=a.useState(""),[p,z]=a.useState(""),[x,P]=a.useState(null),[G,ke]=a.useState(d.id),[W,B]=a.useState(!1),[U,q]=a.useState((j==null?void 0:j.search)||""),[o,E]=a.useState(null),N=r=>{q(r),y.get("/semana-pasantes",{week_id:d.id,search:r},{preserveState:!0,replace:!0})},C=a.useMemo(()=>{const r=new Date(d.start_date),s={};return m.forEach((l,t)=>{const n=new Date(r);n.setDate(r.getDate()+t),s[l]=n.toISOString().split("T")[0]}),s},[d,m]),J=(r,s,l)=>{T(r),I(s),z(l),A(!0)},h=()=>{A(!1),T(null),I(""),z(""),P(null)},K=async()=>{if(!(!x||!f||!b||!p)){B(!0);try{await y.post("/asignacion-pasantes",{user_id:x,company_id:f,turno:b,dia:p,week_id:G,fecha:C[p]}),h()}catch(r){console.error("Error al asignar pasante:",r)}finally{B(!1)}}},Q=async r=>{if(confirm("¿Estás seguro de eliminar esta asignación?"))try{await y.delete(`/asignacion-pasantes/${r}`)}catch(s){console.error("Error al eliminar asignación:",s)}},V=(r,s,l)=>{var t,n;return((n=(t=O[r])==null?void 0:t[s])==null?void 0:n[l])||[]},X=async()=>{try{window.open("/generar-pdf-disponibilidad","_blank")}catch(r){console.error("Error al generar el PDF:",r),alert("Hubo un error al generar el PDF. Por favor, inténtalo de nuevo.")}},Y=r=>r.split(" ")[0];return e.jsx(ee,{children:e.jsxs(D,{sx:{p:3},children:[e.jsxs(te,{children:[e.jsx(ae,{title:`Gestión de Camarografos - ${d.name}`,action:e.jsxs(k,{direction:"row",spacing:2,children:[e.jsx(g,{variant:"contained",color:"success",onClick:X,children:"Generar PDF"}),e.jsx(oe,{size:"small",label:"Buscar empresa",variant:"outlined",value:U,onChange:r=>N(r.target.value)})]})}),e.jsxs(ie,{children:[(i==null?void 0:i.success)&&e.jsx(H,{severity:"success",sx:{mb:2},children:i.success}),(i==null?void 0:i.error)&&e.jsx(H,{severity:"error",sx:{mb:2},children:i.error}),e.jsx(ne,{sx:{maxHeight:"600px",overflow:"auto"},children:e.jsxs(le,{size:"small",children:[e.jsx(ce,{children:e.jsxs(_,{children:[e.jsxs(c,{sx:{width:150,fontWeight:"bold",position:"sticky",left:0,top:0,zIndex:11,bgcolor:"background.paper"},children:[e.jsx(re,{sx:{mr:1,verticalAlign:"middle"}}),"Empresa"]}),e.jsx(c,{sx:{width:100,fontWeight:"bold",position:"sticky",top:0,zIndex:10,bgcolor:"background.paper"},children:"Turno"}),m.map(r=>e.jsxs(c,{sx:{minWidth:150,fontWeight:"bold",position:"sticky",top:0,zIndex:9,bgcolor:"background.paper"},children:[r.charAt(0).toUpperCase()+r.slice(1),e.jsx("br",{}),e.jsx(u,{variant:"caption",color:"textSecondary",children:new Date(new Date(C[r]).setDate(new Date(C[r]).getDate()+1)).toLocaleDateString()})]},r))]})}),e.jsx(de,{children:v.map(r=>w.map((s,l)=>e.jsxs(_,{children:[l===0&&e.jsx(c,{rowSpan:w.length,sx:{verticalAlign:"top",borderRight:1,borderRightColor:"divider",position:"sticky",left:0,zIndex:5,bgcolor:"background.paper"},children:e.jsx(u,{variant:"body2",fontWeight:"medium",children:r.name})}),e.jsx(c,{sx:{fontWeight:"medium"},children:e.jsx(me,{label:s.charAt(0).toUpperCase()+s.slice(1),size:"small",color:s==="mañana"?"primary":s==="tarde"?"secondary":"default"})}),m.map(t=>{const n=V(r.id,s,t),F=(o==null?void 0:o.companyId)===r.id&&(o==null?void 0:o.turno)===s&&(o==null?void 0:o.dia)===t;return e.jsx(c,{sx:{verticalAlign:"top"},onMouseEnter:()=>E({companyId:r.id,turno:s,dia:t}),onMouseLeave:()=>E(null),children:e.jsxs(k,{spacing:1,children:[n.map(S=>e.jsxs(D,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",bgcolor:"grey.100",p:1,borderRadius:1,fontSize:"0.875rem"},children:[e.jsxs(D,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(se,{sx:{fontSize:16,mr:.5}}),e.jsx(u,{variant:"body2",children:Y(S.user.name)})]}),e.jsx(L,{size:"small",color:"error",onClick:()=>Q(S.id),children:e.jsx(pe,{sx:{fontSize:16}})})]},S.id)),(F||n.length===0)&&e.jsx(g,{size:"small",startIcon:e.jsx(xe,{}),variant:"outlined",sx:{mt:1,opacity:F?1:0,transition:"opacity 0.2s ease-in-out"},onClick:()=>J(r.id,s,t),children:"Agregar"})]})},t)})]},`${r.id}-${s}`)))})]})})]})]}),e.jsxs(he,{open:$,onClose:h,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(ge,{children:["Agregar Camarografo",e.jsx(L,{onClick:h,sx:{position:"absolute",right:8,top:8},children:e.jsx(je,{})})]}),e.jsx(ue,{children:e.jsxs(k,{spacing:3,sx:{mt:2},children:[e.jsxs(u,{variant:"body1",children:[e.jsx("strong",{children:"Empresa:"})," ",(M=v.find(r=>r.id===f))==null?void 0:M.name,e.jsx("br",{}),e.jsx("strong",{children:"Turno:"})," ",b,e.jsx("br",{}),e.jsx("strong",{children:"Día:"})," ",p,e.jsx("br",{})]}),e.jsxs(fe,{fullWidth:!0,children:[e.jsx(be,{children:"Seleccionar Camarografo"}),e.jsx(Ce,{value:x||"",label:"Seleccionar Camarografo",onChange:r=>P(r.target.value),children:R.map(r=>e.jsx(Se,{value:r.id,children:r.name},r.id))})]})]})}),e.jsxs(ye,{children:[e.jsx(g,{onClick:h,children:"Cancelar"}),e.jsx(g,{onClick:K,variant:"contained",disabled:!x||W,children:W?"Asignando...":"Asignar Camarografo"})]})]})]})})};export{Ar as default};

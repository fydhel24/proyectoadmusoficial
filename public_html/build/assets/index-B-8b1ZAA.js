import{r as i,j as t,$ as oe}from"./app-CUaISujP.js";import{A as re}from"./app-layout-CWuB6NnO.js";import{A as ae}from"./Add-De3J4oTr.js";import{D as W}from"./Delete-Dw3wghQe.js";import{E as ie}from"./Edit-BqoUF0Kc.js";import{S as ne}from"./Search-C72N3j8E.js";import{u as se,T as ce,P as le}from"./Typography-BXYVZiZC.js";import{B as q}from"./Box-F7bZ1tjM.js";import{T as P}from"./TextField-k7btXKeC.js";import{I as v}from"./IconButton-C9CZ2MaG.js";import{B as N}from"./Button-BnJ1HrMo.js";import{T as me,a as de}from"./TablePagination-B-tqJKy2.js";import{T as pe}from"./TableContainer-CWbvjH18.js";import{T as ue,a as he,b as L,c as ge}from"./TableRow-DPD5_gbf.js";import{T as u}from"./TableCell-CNOqIwaJ.js";import{C as M}from"./Checkbox-CELrtglo.js";import{T as K}from"./TableSortLabel-C328wzC9.js";import{D as xe,a as fe,b as be}from"./DialogTitle-BDIXDovD.js";import{D as je}from"./DialogActions-V7uP84uM.js";import{S as Ce}from"./Snackbar-B7vsGb3O.js";import"./button-0Hij8kFa.js";import"./clsx-B-dksMZM.js";import"./avatar-vMY4vQMB.js";import"./createLucideIcon-XVNSMSUw.js";import"./index-DZ5Pi2z6.js";import"./index-b-iRS2c_.js";import"./index-JQPl0ewz.js";import"./settings-CLpIyV6T.js";import"./app-logo-icon-DxXq1G7b.js";import"./createSvgIcon-CsdeE9h-.js";import"./DefaultPropsProvider-DnyQ5W7l.js";import"./useSlot-CYEIGEy5.js";import"./TransitionGroupContext-Ci2WFGYL.js";import"./useId-B2OWouFT.js";import"./Select-vcTzVEW7.js";import"./isMuiElement-6h6e2Qkh.js";import"./index-Coxc2Kyf.js";import"./useSlotProps-BLv6iqgZ.js";import"./List-C4LEDEwh.js";import"./ownerDocument-DW-IO8s5.js";import"./Modal-ZVwyIF_S.js";import"./useTimeout-BTm0asfU.js";import"./Portal-8nlpaEwd.js";import"./Fade-ChnIJY1B.js";import"./debounce-Be36O1Ab.js";import"./Grow-B_EMGJuI.js";import"./useControlled-QlBAzUVK.js";import"./ButtonBase-DE1CgUJq.js";import"./CircularProgress-nCrY-oKD.js";import"./KeyboardArrowRight-CBXyxG8r.js";import"./LastPage-pLnkY1fb.js";import"./MenuItem-bfQTmTsC.js";import"./listItemTextClasses-D-n0sOX5.js";import"./dividerClasses-Bv3o9dJ8.js";import"./SwitchBase-C0XU40cX.js";import"./ClickAwayListener-CJ5v628k.js";const Se=[{title:"Categorías",href:"/categories"}];function X(m,o,n){return o[n]<m[n]?-1:o[n]>m[n]?1:0}function ke(m,o){return m==="desc"?(n,s)=>X(n,s,o):(n,s)=>-X(n,s,o)}function ye(m,o){const n=m.map((s,d)=>[s,d]);return n.sort((s,d)=>{const f=o(s[0],d[0]);return f!==0?f:s[1]-d[1]}),n.map(s=>s[0])}function Dt({categories:m}){const o=se(),[n,s]=i.useState(m),[d,f]=i.useState(""),[$,C]=i.useState(!1),[S,c]=i.useState(null),[H,T]=i.useState(null),[w,D]=i.useState(""),[k,J]=i.useState(""),[h,U]=i.useState("asc"),[l,_]=i.useState("id"),[p,E]=i.useState([]),[y,I]=i.useState(0),[b,G]=i.useState(10),A=async e=>{var r;if(window.confirm("¿Seguro que deseas eliminar?"))try{const a=((r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content"))||"";await fetch(`/categories/${e}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":a}}),s(x=>x.filter(j=>j.id!==e)),c("Categoría eliminada")}catch{c("Error al eliminar")}},R=(e,r)=>{T(e),D(r)},O=async e=>{var r;if(!w.trim()){c("Nombre obligatorio");return}try{const a=((r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content"))||"",x=await fetch(`/categories/${e}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":a},body:JSON.stringify({name:w})});if(!x.ok)throw new Error;const j=await x.json();s(te=>te.map(B=>B.id===e?j:B)),c("Categoría actualizada")}catch{c("Error al actualizar")}finally{T(null),D("")}},Q=async()=>{var e;if(!d.trim()){c("Nombre obligatorio");return}try{const r=((e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.getAttribute("content"))||"",a=await fetch("/categories",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":r},body:JSON.stringify({name:d})});if(!a.ok)throw new Error;const x=await a.json();s(j=>[...j,x]),c("Categoría creada"),f(""),C(!1)}catch{c("Error al crear")}};i.useEffect(()=>{if(!S)return;const e=setTimeout(()=>c(null),4e3);return()=>clearTimeout(e)},[S]);const g=i.useMemo(()=>n.filter(e=>e.name.toLowerCase().includes(k.toLowerCase())||String(e.id).includes(k)),[n,k]),z=i.useMemo(()=>ye(g,ke(h,l)),[g,h,l]),V=i.useMemo(()=>z.slice(y*b,y*b+b),[z,y,b]),F=e=>{U(l===e&&h==="asc"?"desc":"asc"),_(e)},Y=e=>{e.target.checked?E(g.map(r=>r.id)):E([])},Z=e=>{E(r=>r.includes(e)?r.filter(a=>a!==e):[...r,e])},ee=e=>p.indexOf(e)!==-1;return t.jsxs(re,{breadcrumbs:Se,children:[t.jsx(oe,{title:"Categorías"}),t.jsxs(q,{sx:{display:"flex",gap:2,mb:3,alignItems:"center"},children:[t.jsx(P,{label:"Buscar por nombre o ID",variant:"outlined",size:"small",value:k,onChange:e=>J(e.target.value),sx:{maxWidth:320},InputProps:{startAdornment:t.jsx(v,{tabIndex:-1,children:t.jsx(ne,{})})}}),t.jsx(N,{variant:"contained",startIcon:t.jsx(ae,{}),onClick:()=>C(!0),sx:{fontWeight:"bold"},children:"Crear categoría"})]}),p.length>0&&t.jsxs(me,{sx:{bgcolor:"action.selected",mb:1,borderRadius:2},children:[t.jsxs(ce,{sx:{flex:"1 1 100%"},color:"inherit",children:[p.length," seleccionado",p.length>1?"s":""]}),t.jsx(v,{color:"error",onClick:()=>p.forEach(e=>A(e)),children:t.jsx(W,{})})]}),t.jsxs(pe,{component:le,sx:{borderRadius:2,boxShadow:3,overflowX:"auto",border:"1px solid #e0e0e0",background:o.palette.background.paper,mx:{xs:0,md:2}},children:[t.jsxs(ue,{size:"small",children:[t.jsx(he,{children:t.jsxs(L,{children:[t.jsx(u,{padding:"checkbox",sx:{backgroundColor:o.palette.primary.main,color:o.palette.common.white},children:t.jsx(M,{indeterminate:p.length>0&&p.length<g.length,checked:g.length>0&&p.length===g.length,onChange:Y,sx:{color:o.palette.common.white}})}),t.jsx(u,{sortDirection:l==="id"?h:!1,sx:{fontWeight:"bold",backgroundColor:o.palette.primary.main,color:o.palette.common.white},children:t.jsx(K,{active:l==="id",direction:l==="id"?h:"asc",onClick:()=>F("id"),sx:{color:o.palette.common.white,"&.Mui-active":{color:o.palette.common.white}},children:"ID"})}),t.jsx(u,{sortDirection:l==="name"?h:!1,sx:{fontWeight:"bold",backgroundColor:o.palette.primary.main,color:o.palette.common.white},children:t.jsx(K,{active:l==="name",direction:l==="name"?h:"asc",onClick:()=>F("name"),sx:{color:o.palette.common.white,"&.Mui-active":{color:o.palette.common.white}},children:"Nombre"})}),t.jsx(u,{sx:{fontWeight:"bold",backgroundColor:o.palette.primary.main,color:o.palette.common.white},children:"Acciones"})]})}),t.jsx(ge,{children:V.map(e=>{const r=ee(e.id);return t.jsxs(L,{hover:!0,selected:r,onClick:()=>Z(e.id),children:[t.jsx(u,{padding:"checkbox",children:t.jsx(M,{checked:r})}),t.jsx(u,{children:e.id}),t.jsx(u,{children:H===e.id?t.jsx(P,{value:w,size:"small",autoFocus:!0,onChange:a=>D(a.target.value),onBlur:()=>O(e.id),onKeyDown:a=>{a.key==="Enter"&&O(e.id),a.key==="Escape"&&T(null)}}):t.jsxs(q,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(ie,{fontSize:"small",color:"action",sx:{cursor:"pointer"},onClick:a=>{a.stopPropagation(),R(e.id,e.name)}}),t.jsx("span",{onDoubleClick:()=>R(e.id,e.name),style:{cursor:"pointer"},title:"Doble click para editar",children:e.name})]})}),t.jsx(u,{children:t.jsx(v,{size:"small",color:"error",onClick:a=>{a.stopPropagation(),A(e.id)},children:t.jsx(W,{})})})]},e.id)})})]}),t.jsx(de,{component:"div",count:g.length,page:y,rowsPerPage:b,onPageChange:(e,r)=>I(r),onRowsPerPageChange:e=>{G(parseInt(e.target.value,10)),I(0)},rowsPerPageOptions:[5,10,25],labelRowsPerPage:"Filas por página"})]}),t.jsxs(xe,{open:$,onClose:()=>C(!1),children:[t.jsx(fe,{children:"Crear Nueva Categoría"}),t.jsx(be,{children:t.jsx(P,{autoFocus:!0,fullWidth:!0,margin:"dense",label:"Nombre de la categoría",value:d,onChange:e=>f(e.target.value)})}),t.jsxs(je,{children:[t.jsx(N,{onClick:()=>C(!1),children:"Cancelar"}),t.jsx(N,{variant:"contained",onClick:Q,children:"Crear"})]})]}),t.jsx(Ce,{open:!!S,message:S,onClose:()=>c(null),autoHideDuration:4e3})]})}export{Dt as default};

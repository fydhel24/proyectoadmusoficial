import{r as o,a as d,j as r,$ as Y}from"./app-CyHY4qXq.js";import{A as Z}from"./app-layout-CR2VM0FS.js";import{u as _,P as ee,T as re}from"./Typography-DquxNzfk.js";import{u as oe}from"./index-CURM9lNO.js";import{B as I}from"./Box-Ceqq6WPS.js";import{T as p}from"./TextField-CaWg8z4c.js";import{I as h}from"./IconButton-B9_fiBgM.js";import{S as te}from"./Search-DIVzUW0W.js";import{B as k}from"./Button-B5QymhUM.js";import{E as W}from"./Edit-BvTcJ_Qq.js";import{T as se}from"./TableContainer-4zPIkVPi.js";import{T as ae,a as ie,b as M,c as le}from"./TableRow-FNpscNeL.js";import{T as s}from"./TableCell-EmrQpkrd.js";import{C as N}from"./Checkbox-D6-qYv9O.js";import{D as ne}from"./Delete-cOm2upTA.js";import{D as me,a as ce,b as de}from"./DialogTitle-CsQ7IZVm.js";import{C as D}from"./Close-1nObbuId.js";import{F as pe,I as he,S as ue}from"./Select-6JcSj1Oi.js";import{M as B}from"./MenuItem-BFP2klYp.js";import{D as xe}from"./DialogActions-DzIW1MJD.js";import"./button-D9s6bao3.js";import"./clsx-B-dksMZM.js";import"./avatar-DM9x7_D4.js";import"./createLucideIcon-DzD-rnf8.js";import"./index-Rp65u7US.js";import"./index-B36Mxma7.js";import"./index-CQLPyUva.js";import"./settings-DdDrqPmp.js";import"./app-logo-icon-C6G1VvIS.js";import"./createSvgIcon-DFkYpeFR.js";import"./DefaultPropsProvider-CieIQJ4l.js";import"./createSimplePaletteValueFilter-CHgcW5pF.js";import"./getThemeProps-CSTSEX59.js";import"./useTimeout-2kURTJpt.js";import"./useSlot-BD1cC_p3.js";import"./TransitionGroupContext-BSxo9aJI.js";import"./useId-AiqUT9-C.js";import"./ButtonBase-B7jPhJrj.js";import"./CircularProgress-BcU9b_yV.js";import"./SwitchBase-Bv2wVN7s.js";import"./useControlled-BWKDwO3o.js";import"./Fade-CJOgqix0.js";import"./Modal-Br5Yv6Vo.js";import"./ownerDocument-DW-IO8s5.js";import"./Portal-3K29QfTN.js";import"./isMuiElement-tDv9Kr5f.js";import"./index-DeuVn2yV.js";import"./useSlotProps-mZ78eGn3.js";import"./List-FQZRBiMT.js";import"./debounce-Be36O1Ab.js";import"./Grow-BhDWOfCT.js";import"./listItemTextClasses-BGlA8WXQ.js";import"./dividerClasses-BrhqyHKe.js";const fe=[{title:"Usuarios y Roles",href:"/users-roles"}];function fr(){const[L,z]=o.useState([]),[A,l]=o.useState(!1),[u,x]=o.useState(""),[f,g]=o.useState(""),[j,T]=o.useState(""),[b,C]=o.useState(null),[H,P]=o.useState([]),[w,U]=o.useState(!1),[m,R]=o.useState(!1),[$,q]=o.useState(null),[S,F]=o.useState(""),[c,v]=o.useState([]),a=_(),i=oe(a.breakpoints.down("sm"));o.useEffect(()=>{y(),G()},[]);const y=()=>{d.get("/api/users").then(e=>z(e.data)).catch(e=>console.error("Error fetching users:",e))},G=()=>{d.get("/api/roles").then(e=>P(e.data)).catch(e=>console.error("Error fetching roles:",e))},Q=()=>{R(!1),x(""),g(""),T(""),C(""),l(!0)},X=e=>{var t;R(!0),q(e.id),x(e.name),g(e.email),C(((t=e.roles[0])==null?void 0:t.name)||""),l(!0)},J=()=>{if(!u.trim()||!f.trim()||!m&&!j.trim()||!b)return alert("Todos los campos son obligatorios");U(!0);const e={name:u,email:f,password:j,role:b};(m?d.put(`/users/${$}`,e):d.post("/users",e)).then(()=>{l(!1),y()}).catch(E=>{console.error("Error guardando el usuario:",E),alert("Hubo un error")}).finally(()=>U(!1))},K=e=>{confirm("¿Estás seguro de que deseas eliminar este usuario?")&&d.delete(`/users/${e}`).then(()=>y()).catch(t=>{console.error("Error al eliminar el usuario:",t),alert("Hubo un error al eliminar el usuario")})},n=L.filter(e=>e.name.toLowerCase().includes(S.toLowerCase())||e.email.toLowerCase().includes(S.toLowerCase())),O=e=>{v(t=>t.includes(e)?t.filter(E=>E!==e):[...t,e])},V=()=>{c.length===n.length?v([]):v(n.map(e=>e.id))};return r.jsxs(Z,{breadcrumbs:fe,children:[r.jsx(Y,{title:"Usuarios y Roles"}),r.jsxs(I,{sx:{padding:2},children:[r.jsxs(I,{sx:{display:"flex",alignItems:"center",marginBottom:2},children:[r.jsx(p,{label:"Buscar",variant:"outlined",size:"small",fullWidth:!0,value:S,onChange:e=>F(e.target.value),sx:{marginRight:2},InputProps:{startAdornment:r.jsx(h,{children:r.jsx(te,{})})}}),r.jsx(k,{variant:"contained",color:"primary",sx:{ml:2},onClick:Q,startIcon:r.jsx(W,{}),children:"Nuevo Usuario"})]}),r.jsx(se,{component:ee,sx:{borderRadius:2,boxShadow:3,overflowX:"auto",maxHeight:"calc(100vh - 200px)"},children:r.jsxs(ae,{stickyHeader:!0,sx:{minWidth:650},children:[r.jsx(ie,{children:r.jsxs(M,{children:[r.jsx(s,{padding:"checkbox",children:r.jsx(N,{color:"primary",checked:n.length>0&&c.length===n.length,indeterminate:c.length>0&&c.length<n.length,onChange:V})}),r.jsx(s,{sx:{fontWeight:"bold",backgroundColor:a.palette.primary.main,color:a.palette.common.white,padding:i?"8px":"16px",fontSize:i?"0.875rem":"1rem"},children:"Nombre"}),r.jsx(s,{sx:{fontWeight:"bold",backgroundColor:a.palette.primary.main,color:a.palette.common.white,padding:i?"8px":"16px",fontSize:i?"0.875rem":"1rem"},children:"Email"}),r.jsx(s,{sx:{fontWeight:"bold",backgroundColor:a.palette.primary.main,color:a.palette.common.white,padding:i?"8px":"16px",fontSize:i?"0.875rem":"1rem"},children:"Rol"}),r.jsx(s,{sx:{fontWeight:"bold",backgroundColor:a.palette.primary.main,color:a.palette.common.white,padding:i?"8px":"16px",fontSize:i?"0.875rem":"1rem"},children:"Acciones"})]})}),r.jsx(le,{children:n.map(e=>r.jsxs(M,{hover:!0,children:[r.jsx(s,{padding:"checkbox",children:r.jsx(N,{color:"primary",checked:c.includes(e.id),onChange:()=>O(e.id)})}),r.jsx(s,{children:e.name}),r.jsx(s,{children:e.email}),r.jsx(s,{children:e.roles&&e.roles.length>0?e.roles.map(t=>t.name).join(", "):r.jsx("span",{className:"italic text-gray-400",children:"Sin rol"})}),r.jsxs(s,{children:[r.jsx(h,{color:"primary",onClick:()=>X(e),"aria-label":"Editar",children:r.jsx(W,{})}),r.jsx(h,{color:"error",onClick:()=>K(e.id),"aria-label":"Eliminar",children:r.jsx(ne,{})})]})]},e.id))})]})})]}),r.jsxs(me,{open:A,onClose:()=>l(!1),maxWidth:"sm",fullWidth:!0,children:[r.jsxs(ce,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx(re,{variant:"h6",children:m?"Editar Usuario":"Crear Nuevo Usuario"}),r.jsx(h,{onClick:()=>l(!1),children:r.jsx(D,{})})]}),r.jsxs(de,{dividers:!0,children:[r.jsx(p,{label:"Nombre del usuario",variant:"outlined",fullWidth:!0,value:u,onChange:e=>x(e.target.value),sx:{mb:2}}),r.jsx(p,{label:"Email del usuario",variant:"outlined",fullWidth:!0,value:f,onChange:e=>g(e.target.value),sx:{mb:2}}),!m&&r.jsx(p,{label:"Contraseña",variant:"outlined",fullWidth:!0,type:"password",value:j,onChange:e=>T(e.target.value),sx:{mb:2}}),r.jsxs(pe,{fullWidth:!0,sx:{mb:2},children:[r.jsx(he,{id:"select-role-label",children:"Rol"}),r.jsxs(ue,{labelId:"select-role-label",value:b||"",label:"Rol",onChange:e=>C(e.target.value),children:[r.jsx(B,{value:"",children:r.jsx("em",{children:"Seleccionar rol"})}),H.map(e=>r.jsx(B,{value:e.name,children:e.name},e.id))]})]})]}),r.jsxs(xe,{children:[r.jsx(k,{onClick:()=>l(!1),color:"inherit",variant:"outlined",disabled:w,startIcon:r.jsx(D,{}),children:"Cancelar"}),r.jsx(k,{onClick:J,color:"primary",variant:"contained",disabled:w,children:w?"Guardando...":m?"Actualizar":"Crear"})]})]})]})}export{fr as default};

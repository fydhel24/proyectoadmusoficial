import{r as d,j as e,$ as F,U as G}from"./app-hmuC0z_W.js";import{A as _}from"./app-layout-tfxOdOKB.js";import{C as $}from"./CheckCircle-DIV5afmv.js";import{E as U}from"./Edit-BRh_CxWN.js";import{P as V}from"./Pending-DmtwW12C.js";import{B as S}from"./Box-4C9-OmNb.js";import{T as s}from"./Typography-D9aOS4L9.js";import{G as h}from"./Grid-B8p_XyNn.js";import{C}from"./Card-DF9nCZsV.js";import{C as E}from"./CardContent-C53nuT2n.js";import{T as D}from"./TextField-C5FPbCxz.js";import{A as q}from"./Alert-n7JhyHaU.js";import{T as J}from"./Tooltip-C2YJTe4A.js";import{I as K}from"./IconButton-5suIbhPZ.js";import{D as X}from"./Divider-CF7op6F0.js";import{C as Y}from"./Chip-Dcvl53u6.js";import{B as P}from"./Button-CI4PvYH9.js";import{M as H}from"./Modal-B3L5jhwL.js";import{M as Q}from"./MenuItem-BrmMwhAd.js";import{S as Z}from"./Stack-ofWMD4V8.js";import"./button-BdWLbofJ.js";import"./clsx-B-dksMZM.js";import"./avatar-SH5xSAMo.js";import"./createLucideIcon-B2A0n4jm.js";import"./index-BeDZ4tg0.js";import"./index-B2CGEqEW.js";import"./index-CDmN9uZR.js";import"./settings-B81NYrWU.js";import"./app-logo-icon-DF-2vurZ.js";import"./createSvgIcon-DmtCSiy2.js";import"./DefaultPropsProvider-B9G9mrQg.js";import"./createSimplePaletteValueFilter-BLiQVDB3.js";import"./useThemeProps-D5Z9mzbb.js";import"./getThemeProps-Ci1Myslq.js";import"./isMuiElement-DUef8CkO.js";import"./useSlot-b8oj5fjv.js";import"./TransitionGroupContext-zx_Mae6Z.js";import"./useId-CIKGyZXY.js";import"./Select-BXe5PBU8.js";import"./index-CPN-dXc6.js";import"./useSlotProps-B7GeVvJr.js";import"./List-e32Tbcmu.js";import"./ownerDocument-DW-IO8s5.js";import"./debounce-Be36O1Ab.js";import"./Grow-CwDNX7JD.js";import"./Fade-CwyH9ByJ.js";import"./useTimeout-CyHmLoFO.js";import"./useControlled-D8uUDMf0.js";import"./Close-B1u00IW_.js";import"./Popper-Bof0hLwX.js";import"./Portal-3qAPjvvz.js";import"./ButtonBase-CKxFeLN_.js";import"./CircularProgress-DbGwbuXF.js";import"./dividerClasses-DyS1-ewh.js";import"./listItemTextClasses-BuwBTG13.js";const ee=[{value:"pendiente",label:"Pendiente"},{value:"en_revision",label:"En revision"},{value:"publicada",label:"Publicada"}],te=j=>j==="publicada"?"success.main":"background.paper",A={alta:"游댠 Importantes",media:"游리 Normales",baja:"游릭 B치sicas"};function re({open:j,onClose:m,tarea:r,onSave:y}){const[f,c]=d.useState((r==null?void 0:r.estado)||"pendiente"),[t,i]=d.useState((r==null?void 0:r.detalle)||""),[o,b]=d.useState(!1);G.useEffect(()=>{r&&(c(r.estado),i(r.detalle||""))},[r]);const v=async()=>{r&&(b(!0),await y(r.id,f,t),b(!1),m())};return e.jsx(H,{open:j,onClose:m,children:e.jsxs(S,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",boxShadow:24,p:4,borderRadius:2},children:[e.jsx(s,{variant:"h6",mb:2,children:"Editar Estado y Detalle"}),e.jsx(D,{fullWidth:!0,select:!0,label:"Estado",value:f,onChange:n=>c(n.target.value),sx:{mb:2},children:ee.map(n=>e.jsx(Q,{value:n.value,children:n.label},n.value))}),e.jsx(D,{fullWidth:!0,label:"Detalle",multiline:!0,minRows:3,value:t,onChange:n=>i(n.target.value),sx:{mb:3}}),e.jsxs(Z,{direction:"row",spacing:2,justifyContent:"flex-end",children:[e.jsx(P,{onClick:m,disabled:o,children:"Cancelar"}),e.jsx(P,{variant:"contained",onClick:v,disabled:o,children:"Guardar"})]})]})})}const B=({title:j,items:m,onEdit:r})=>{const[y,f]=d.useState(new Set);if(!m||m.length===0)return null;const c=t=>{f(i=>{const o=new Set(i);return o.has(t)?o.delete(t):o.add(t),o})};return e.jsxs(S,{sx:{mb:6},children:[e.jsx(s,{variant:"h5",sx:{mb:2},children:j}),e.jsx(h,{container:!0,spacing:3,children:m.map(t=>{var v,n,p;const i=t.estado==="publicada",o=t.detalle&&t.detalle.length>100,b=!o||y.has(t.id)?t.detalle:((v=t.detalle)==null?void 0:v.slice(0,100))+"...";return e.jsxs(h,{item:!0,xs:12,md:4,children:[" ",e.jsx(C,{sx:{bgcolor:te(t.estado),transition:"background-color 0.3s",height:"100%",display:"flex",flexDirection:"column",justifyContent:"space-between"},children:e.jsxs(E,{children:[e.jsxs(S,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(s,{variant:"h6",children:t.tarea.titulo}),e.jsx(J,{title:"Editar Estado y Detalle",children:e.jsx(K,{onClick:()=>r(t),size:"small",color:i?"success":"primary",children:e.jsx(U,{})})})]}),e.jsx(s,{variant:"body2",color:"text.secondary",children:t.tarea.descripcion}),e.jsx(X,{sx:{my:2}}),e.jsxs(S,{children:[" ",e.jsx("strong",{children:"Tipo:"})," ",((n=t.tarea.tipo)==null?void 0:n.nombre_tipo)||"N/A"," ",e.jsx("br",{}),e.jsx("strong",{children:"Empresa:"})," ",((p=t.tarea.company)==null?void 0:p.name)||"N/A"," ",e.jsx("br",{}),e.jsx("strong",{children:"Estado:"})]}),e.jsx(Y,{label:t.estado,color:i?"success":"default",size:"small",icon:i?e.jsx($,{}):e.jsx(V,{})})," ",e.jsxs(S,{children:[e.jsx("strong",{children:"Detalle:"})," ",b," ",o&&e.jsx(P,{size:"small",onClick:()=>c(t.id),sx:{textTransform:"none",ml:1},children:y.has(t.id)?"Ver menos":"Ver m치s"})]})]})})]},t.id)})})]})};function st({tareas:j,filters:m}){const[r,y]=d.useState(m.search||""),[f,c]=d.useState(null),[t,i]=d.useState(j),[o,b]=d.useState({type:null,message:null}),v=d.useCallback((a,u,x)=>{i(g=>{var w;const l={...g};for(const k in l)l[k]&&(l[k]=((w=l[k])==null?void 0:w.map(I=>I.id===a?{...I,estado:u,detalle:x}:I))||[]);return l})},[i]),n=d.useMemo(()=>{var u,x,g;const a=l=>l.tarea.titulo.toLowerCase().includes(r.toLowerCase());return{alta:((u=t.alta)==null?void 0:u.filter(a))||[],media:((x=t.media)==null?void 0:x.filter(a))||[],baja:((g=t.baja)==null?void 0:g.filter(a))||[]}},[r,t]),p=a=>(a==null?void 0:a.length)||0,T=(a,u)=>(a==null?void 0:a.filter(x=>x.estado===u).length)||0,W=p(t.alta),z=p(t.media),L=p(t.baja),M=T(t.alta,"publicada")+T(t.media,"publicada")+T(t.baja,"publicada"),N=p(t.alta)+p(t.media)+p(t.baja)-M,R=async(a,u,x)=>{var g;try{const l=(g=document.querySelector('meta[name="csrf-token"]'))==null?void 0:g.getAttribute("content");if(!(await fetch(`/pasante/actualizar/${a}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":l||""},body:JSON.stringify({estado:u,detalle:x})})).ok)throw new Error("Error actualizando la tarea");v(a,u,x),c(null),b({type:"success",message:"Tarea actualizada correctamente"})}catch(l){b({type:"error",message:"Error actualizando la tarea: "+l.message})}},O=[{title:"Pasante",href:"/pasante"}];return e.jsxs(_,{breadcrumbs:O,children:[e.jsx(F,{title:"Tareas del D칤a"}),e.jsxs(S,{sx:{px:2,py:4},children:[e.jsx(s,{variant:"h4",gutterBottom:!0,children:"Tareas del D칤a"}),e.jsxs(h,{container:!0,spacing:2,sx:{mb:4},children:[e.jsx(h,{item:!0,xs:12,sm:6,md:2,children:e.jsx(C,{sx:{bgcolor:"error.light"},children:e.jsxs(E,{children:[e.jsx(s,{variant:"h6",color:"error.main",align:"center",children:W}),e.jsx(s,{variant:"body2",align:"center",fontWeight:"bold",color:"error.main",children:"Importantes"})]})})}),e.jsx(h,{item:!0,xs:12,sm:6,md:2,children:e.jsx(C,{sx:{bgcolor:"warning.light"},children:e.jsxs(E,{children:[e.jsx(s,{variant:"h6",color:"warning.main",align:"center",children:z}),e.jsx(s,{variant:"body2",align:"center",fontWeight:"bold",color:"warning.main",children:"Normales"})]})})}),e.jsx(h,{item:!0,xs:12,sm:6,md:2,children:e.jsx(C,{sx:{bgcolor:"info.light"},children:e.jsxs(E,{children:[e.jsx(s,{variant:"h6",color:"info.main",align:"center",children:L}),e.jsx(s,{variant:"body2",align:"center",fontWeight:"bold",color:"info.main",children:"B치sicas"})]})})}),e.jsx(h,{item:!0,xs:12,sm:6,md:3,children:e.jsx(C,{sx:{bgcolor:"success.light"},children:e.jsxs(E,{children:[e.jsx(s,{variant:"h6",color:"success.main",align:"center",children:M}),e.jsx(s,{variant:"body2",align:"center",fontWeight:"bold",color:"success.main",children:"Completadas"})]})})}),e.jsx(h,{item:!0,xs:12,sm:6,md:3,children:e.jsx(C,{sx:{bgcolor:"grey.300"},children:e.jsxs(E,{children:[e.jsx(s,{variant:"h6",align:"center",color:"text.primary",children:N}),e.jsx(s,{variant:"body2",align:"center",fontWeight:"bold",color:"text.primary",children:"Pendientes"})]})})})]}),e.jsx(D,{label:"Buscar tareas por t칤tulo",variant:"outlined",fullWidth:!0,value:r,onChange:a=>y(a.target.value),sx:{mb:4}}),o.type&&e.jsx(q,{severity:o.type,sx:{mb:2},children:o.message}),e.jsx(B,{title:A.alta,items:n.alta,onEdit:c}),e.jsx(B,{title:A.media,items:n.media,onEdit:c}),e.jsx(B,{title:A.baja,items:n.baja,onEdit:c})]}),e.jsx(re,{open:!!f,onClose:()=>c(null),tarea:f,onSave:R})]})}export{st as default};

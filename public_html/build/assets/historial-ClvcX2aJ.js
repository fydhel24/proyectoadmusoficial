import{q as w,r as d,v as F,j as e,$ as z,U as J,m as N}from"./app-iQxetvcT.js";import{A as K}from"./app-layout-DZNLsAUN.js";import{A as Q}from"./Add-CBCWMX5y.js";import{D as V}from"./Delete-BRI_MQtg.js";import{E as X}from"./Edit-BvpwWmD8.js";import{B as m}from"./Box-F6yhJlLA.js";import{T as l}from"./TextField-CadfSDcJ.js";import{B as p}from"./Button-hUEMcK7z.js";import{T as Y}from"./TableContainer-BNy0G_N0.js";import{P as Z,T as ee}from"./Typography-Vu44IVe3.js";import{T as re,a as te,b,c as ie}from"./TableRow-C9YU1-sU.js";import{T as t}from"./TableCell-DXhT6vb0.js";import{I as P}from"./IconButton-oUlJzW07.js";import{M as se}from"./Modal-DA_teWuH.js";import{G as n}from"./Grid-CfBvjvwC.js";import{F as v,I as y,S as C}from"./Select-B2fmC2tg.js";import{M as c}from"./MenuItem-C6-0h0yb.js";import"./button-Br5uzfA2.js";import"./clsx-B-dksMZM.js";import"./avatar-BfsoZtdh.js";import"./createLucideIcon-DcDr_LZ4.js";import"./index-xUTrLbSm.js";import"./index-STaUq66L.js";import"./index-HkiN5Yj1.js";import"./settings-CpjDLTZ2.js";import"./app-logo-icon-4ncQ7Ez_.js";import"./createSvgIcon-ClVcefPA.js";import"./DefaultPropsProvider-ByswQ0ug.js";import"./useSlot-Ea-Y7OKI.js";import"./TransitionGroupContext-BXJRKgr0.js";import"./useId-CJlvviJa.js";import"./createSimplePaletteValueFilter-DBX30MBl.js";import"./ButtonBase-Dne6GeZ5.js";import"./useTimeout-BYDghXNP.js";import"./CircularProgress-BqVLwA-j.js";import"./ownerDocument-DW-IO8s5.js";import"./Portal-Cwx4ynoN.js";import"./Fade-Buv2aBp9.js";import"./useThemeProps-BAPtVuKn.js";import"./getThemeProps-CQORG8wP.js";import"./isMuiElement-BAKBvZFj.js";import"./index-BXx7jxtS.js";import"./useSlotProps-DdKiwNsd.js";import"./List-Dkqnlm7C.js";import"./debounce-Be36O1Ab.js";import"./Grow-DFUA3ued.js";import"./useControlled-BkHvu2fc.js";import"./listItemTextClasses-Biqf2cqH.js";import"./dividerClasses-_g5ZrvsR.js";const er=()=>{const{seguimientos:h,users:x,paquetes:j,filters:M}=w().props,[A,_]=d.useState(!1),[u,S]=d.useState(!1),[I,E]=d.useState(null),{data:a,setData:o,post:B,put:D,reset:q}=F({nombre_empresa:"",id_user:x.length>0?x[0].id:0,id_paquete:j.length>0?j[0].id:0,estado:"",fecha_inicio:"",fecha_fin:"",descripcion:""}),[f,L]=d.useState(M.search||""),R=r=>{const i=r.target.value;L(i),N.get(route("seguimiento-empresa.index"),{search:i},{replace:!0,preserveState:!0})},W=r=>{r?(S(!0),E(r.id),o({nombre_empresa:r.nombre_empresa,id_user:r.id_user,id_paquete:r.id_paquete,estado:r.estado,fecha_inicio:r.fecha_inicio,fecha_fin:r.fecha_fin||"",descripcion:r.descripcion||""})):(S(!1),E(null),q()),_(!0)},g=()=>{_(!1),q()},U=r=>{r.preventDefault();const i=()=>{g(),window.location.reload()};u&&I?D(route("seguimiento-empresa.update",I),{onSuccess:i}):B(route("seguimiento-empresa.store"),{onSuccess:i})},{delete:G}=F(),$=r=>{confirm("¿Estás seguro de que deseas eliminar este seguimiento?")&&G(route("seguimiento-empresa.destroy",r))},H=()=>e.jsx("nav",{"aria-label":"Page navigation",children:e.jsx("ul",{className:"inline-flex items-center -space-x-px",children:h.links.map((r,i)=>e.jsx("li",{children:r.url===null?e.jsx("span",{className:`border border-gray-300 bg-white px-3 py-2 leading-tight text-gray-500 ${r.active?"bg-blue-50 text-blue-600":""}`,dangerouslySetInnerHTML:{__html:r.label}}):e.jsx("button",{onClick:()=>N.get(r.url,{search:f},{preserveState:!0}),className:`border border-gray-300 bg-white px-3 py-2 leading-tight text-gray-500 hover:bg-gray-100 hover:text-gray-700 ${r.active?"bg-blue-50 text-blue-600":""}`,dangerouslySetInnerHTML:{__html:r.label}})},i))})}),T=d.useMemo(()=>{const r={};return h.data.forEach(i=>{const s=i.usuario.id;r[s]||(r[s]={user:i.usuario,seguimientos:[]}),r[s].seguimientos.push(i)}),Object.values(r)},[h.data]);return e.jsxs(K,{user:w().props.auth.user,header:e.jsx("h2",{className:"text-xl leading-tight font-semibold text-gray-800",children:"Seguimiento de Empresas"}),children:[e.jsx(z,{title:"Seguimiento de Empresas"}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:e.jsxs("div",{className:"overflow-hidden bg-white p-6 shadow-sm sm:rounded-lg",children:[e.jsxs(m,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(l,{label:"Buscar...",variant:"outlined",value:f,onChange:R,sx:{width:"300px"}}),e.jsx(p,{variant:"contained",color:"secondary",onClick:()=>{const r=route("seguimiento-empresa.pdf",{search:f});window.open(r,"_blank")},sx:{ml:2},children:"Generar PDF"}),e.jsx(p,{variant:"contained",startIcon:e.jsx(Q,{}),onClick:()=>W(),children:"Nuevo Seguimiento"})]}),e.jsx(Y,{component:Z,children:e.jsxs(re,{sx:{minWidth:650},"aria-label":"simple table",children:[e.jsx(te,{children:e.jsxs(b,{children:[e.jsx(t,{sx:{fontWeight:"bold"},children:"Usuario"}),e.jsx(t,{sx:{fontWeight:"bold"},children:"Empresa"}),e.jsx(t,{sx:{fontWeight:"bold"},children:"Paquete"}),e.jsx(t,{sx:{fontWeight:"bold"},children:"Estado"}),e.jsx(t,{sx:{fontWeight:"bold"},children:"Fecha Inicio"}),e.jsx(t,{sx:{fontWeight:"bold"},children:"Fecha Fin"}),e.jsx(t,{sx:{fontWeight:"bold"},children:"Acciones"})]})}),e.jsx(ie,{children:T.length>0?T.map((r,i)=>e.jsx(J.Fragment,{children:r.seguimientos.map((s,O)=>{var k;return e.jsxs(b,{children:[O===0?e.jsx(t,{component:"th",scope:"row",rowSpan:r.seguimientos.length,children:r.user.name}):e.jsx(t,{style:{display:"none"}}),e.jsx(t,{children:s.nombre_empresa}),e.jsx(t,{children:(k=s.paquete)==null?void 0:k.nombre_paquete}),e.jsx(t,{children:s.estado}),e.jsx(t,{children:s.fecha_inicio}),e.jsx(t,{children:s.fecha_fin||"N/A"}),e.jsxs(t,{children:[e.jsx(P,{color:"primary",onClick:()=>W(s),children:e.jsx(X,{})}),e.jsx(P,{color:"error",onClick:()=>$(s.id),children:e.jsx(V,{})})]})]},s.id)})},r.user.id)):e.jsx(b,{children:e.jsx(t,{colSpan:7,align:"center",children:"No se encontraron seguimientos."})})})]})}),e.jsx(m,{sx:{mt:2,display:"flex",justifyContent:"center"},children:H()})]})})}),e.jsx(se,{open:A,onClose:g,children:e.jsxs(m,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:600,bgcolor:"background.paper",borderRadius:"12px",boxShadow:"0 8px 32px 0 rgba(0, 0, 0, 0.1)",p:4,display:"flex",flexDirection:"column",gap:3},component:"form",onSubmit:U,children:[e.jsx(ee,{variant:"h5",component:"h2",sx:{fontWeight:"bold",color:"primary.main",textAlign:"center",mb:1},children:u?"Editar Seguimiento":"Crear Seguimiento"}),e.jsxs(n,{container:!0,spacing:3,children:[e.jsx(n,{item:!0,xs:12,children:e.jsx(l,{fullWidth:!0,label:"Nombre de Empresa",value:a.nombre_empresa,onChange:r=>o("nombre_empresa",r.target.value),required:!0,variant:"outlined"})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsxs(v,{fullWidth:!0,required:!0,children:[e.jsx(y,{children:"Usuario"}),e.jsx(C,{value:a.id_user,label:"Usuario",onChange:r=>o("id_user",r.target.value),variant:"outlined",children:x.map(r=>e.jsx(c,{value:r.id,children:r.name},r.id))})]})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsxs(v,{fullWidth:!0,required:!0,children:[e.jsx(y,{children:"Paquete"}),e.jsx(C,{value:a.id_paquete,label:"Paquete",onChange:r=>o("id_paquete",r.target.value),variant:"outlined",children:j.map(r=>e.jsx(c,{value:r.id,children:r.nombre_paquete},r.id))})]})}),e.jsx(n,{item:!0,xs:12,children:u?e.jsx(l,{fullWidth:!0,label:"Estado",value:a.estado,disabled:!0,variant:"outlined",sx:{"& .MuiInputBase-input.Mui-disabled":{"-webkit-text-fill-color":"text.primary"}}}):e.jsxs(v,{fullWidth:!0,required:!0,children:[e.jsx(y,{children:"Estado"}),e.jsxs(C,{value:a.estado,label:"Estado",onChange:r=>o("estado",r.target.value),variant:"outlined",children:[e.jsx(c,{value:"En proceso",children:"En proceso"}),e.jsx(c,{value:"Completado",children:"Completado"}),e.jsx(c,{value:"Sin exito",children:"Sin éxito"})]})]})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(l,{fullWidth:!0,label:"Fecha de Inicio",type:"date",value:a.fecha_inicio,onChange:r=>o("fecha_inicio",r.target.value),InputLabelProps:{shrink:!0},required:!0,variant:"outlined"})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(l,{fullWidth:!0,label:"Fecha de Fin",type:"date",value:a.fecha_fin,onChange:r=>o("fecha_fin",r.target.value),InputLabelProps:{shrink:!0},variant:"outlined"})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(l,{fullWidth:!0,label:"Descripción",multiline:!0,rows:4,value:a.descripcion,onChange:r=>o("descripcion",r.target.value),variant:"outlined"})})]}),e.jsxs(m,{sx:{display:"flex",justifyContent:"flex-end",mt:2,gap:2},children:[e.jsx(p,{onClick:g,variant:"outlined",sx:{borderRadius:"8px",borderColor:"primary.main",color:"primary.main","&:hover":{backgroundColor:"primary.light",borderColor:"primary.light"}},children:"Cancelar"}),e.jsx(p,{type:"submit",variant:"contained",sx:{borderRadius:"8px",backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"}},children:u?"Guardar Cambios":"Crear"})]})]})})]})};export{er as default};

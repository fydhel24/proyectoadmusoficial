import{q,r as m,j as e,$ as J}from"./app-DWYhLQL6.js";import{A as Q,a as V}from"./app-layout-p7K4X7eV.js";import{d as u}from"./index-CHqsbLd4.js";import{u as Y}from"./index-BcECN-C9.js";import{u as K,P as O}from"./Paper-EniTK7He.js";import{B as X}from"./Box-BbMU-_RR.js";import{T as n}from"./Typography-IkT196je.js";import{G as l}from"./Grid-DU2EuT6q.js";import{C as f}from"./Card-8ZfkaAJ7.js";import{C as y}from"./CardHeader-DGPgwVeW.js";import{P as Z,C as ee}from"./People-BTR4YX2_.js";import{C as g}from"./CardContent-JwUFqTB9.js";import{T as S}from"./TableContainer-DwTJ9q9t.js";import{T as _,a as A,b as x,c as B}from"./TableRow-DBOU2XrP.js";import{T as o}from"./TableCell-C5DOKis2.js";import{C as re}from"./Checkbox-CWR5Giys.js";import{B as k}from"./Button-BrLf_Pls.js";import{I as se}from"./IconButton-BGvBFu85.js";import{D as oe}from"./Delete-mfqLQQwu.js";import{D as ie,a as te,b as ae}from"./DialogTitle-BRc-au27.js";import{F as b,I as C,S as v}from"./Select-DJEe7ust.js";import{M as I}from"./MenuItem-Bm9YqGqc.js";import{D as ne}from"./DialogActions-2fZYmJbN.js";import"./button-wMTuvAkw.js";import"./clsx-B-dksMZM.js";import"./avatar-C0bnmZQz.js";import"./createLucideIcon-DISkT-zV.js";import"./index-vDywYphy.js";import"./index-CvZMSx04.js";import"./index-C-qtZoBa.js";import"./settings-B1FLQ7wV.js";import"./app-logo-icon-HoYzQaBs.js";import"./createSvgIcon-C-V1FIKo.js";import"./DefaultPropsProvider-CHy6HlRv.js";import"./getThemeProps-DLKBaTjH.js";import"./useTimeout-CcjJ2cmE.js";import"./createSimplePaletteValueFilter-WGi9SSDd.js";import"./useThemeProps-Bas4AH8z.js";import"./isMuiElement-D94hBNTL.js";import"./useSlot-CO4IlLCl.js";import"./TransitionGroupContext-D4TXwhqE.js";import"./SwitchBase-B7zN4q3R.js";import"./useFormControl-CsRgqpY5.js";import"./useControlled-5UsadrEY.js";import"./ButtonBase-DpqQEAAf.js";import"./useId-o3zk_1yM.js";import"./CircularProgress-Bo20HsGQ.js";import"./Fade-BWgYys4A.js";import"./Modal-N30Js5sT.js";import"./ownerDocument-DW-IO8s5.js";import"./createChainedFunction-BO_9K8Jh.js";import"./Portal-Dt5KHSRP.js";import"./index-DtBJPI5W.js";import"./useSlotProps-CBCDIG0V.js";import"./List-DOdfdsGa.js";import"./debounce-Be36O1Ab.js";import"./Grow-IF_zPiYA.js";import"./listItemTextClasses-Cw1PQWTE.js";import"./dividerClasses-BOZ5yH6J.js";const le=[{title:"weeks",href:"/weeks"},{title:"bookings",href:""}];function xr(){var D;const E=K();Y(E.breakpoints.down("sm"));const{week:d,bookings:t,companies:T}=q().props,[M,W]=m.useState(!1),[s,c]=m.useState({userId:null,companyId:"",dayOfWeek:"",turno:""}),h=m.useMemo(()=>{const r=new Map;return t.forEach(i=>r.set(i.user.id,i.user)),Array.from(r.values())},[t]),[a,N]=m.useState(null),P=m.useMemo(()=>a?t.filter(r=>r.user.id===a):[],[a,t]),p=T.find(r=>r.id===Number(s.companyId)),R=p?[...new Set(p.availabilityDays.map(r=>r.day_of_week))]:[],H=p&&s.dayOfWeek?[...new Set(p.availabilityDays.filter(r=>r.day_of_week===s.dayOfWeek).map(r=>r.turno))]:[];function $(r){c({userId:r,companyId:"",dayOfWeek:"",turno:""}),W(!0)}function j(){W(!1)}function L(){s.userId&&s.companyId&&s.dayOfWeek&&s.turno&&u.Inertia.post(`/weeks/${d.id}/bookings`,{user_id:s.userId,company_id:s.companyId,day_of_week:s.dayOfWeek,turno:s.turno},{onSuccess:()=>{j(),u.Inertia.reload({only:["bookings"]})}})}function F(r){confirm("¿Eliminar esta reserva?")&&u.Inertia.delete(`/weeks/${d.id}/bookings/${r}`,{onSuccess:()=>u.Inertia.reload({only:["bookings"]})})}const z=t.length,G=t.filter(r=>r.status==="Active").length,U=t.filter(r=>r.status==="Completed").length,w={monday:"Lunes",tuesday:"Martes",wednesday:"Miércoles",thursday:"Jueves",friday:"Viernes",saturday:"Sábado",sunday:"Domingo"};return e.jsxs(Q,{breadcrumbs:le,children:[e.jsx(J,{title:`Bookings — ${d.name}`}),e.jsxs(X,{p:3,maxWidth:1200,mx:"auto",children:[e.jsxs(n,{variant:"h4",color:"primary",gutterBottom:!0,children:["Semanas — ",d.start_date," al ",d.end_date]}),e.jsxs(l,{container:!0,spacing:2,mb:4,children:[e.jsx(l,{item:!0,xs:!0,children:e.jsxs(f,{children:[e.jsx(y,{avatar:e.jsx(Z,{}),title:"Total"}),e.jsx(g,{children:e.jsx(n,{children:z})})]})}),e.jsx(l,{item:!0,xs:!0,children:e.jsxs(f,{children:[e.jsx(y,{avatar:e.jsx(ee,{}),title:"Activos"}),e.jsx(g,{children:e.jsx(n,{children:G})})]})}),e.jsx(l,{item:!0,xs:!0,children:e.jsxs(f,{children:[e.jsx(y,{avatar:e.jsx(V,{}),title:"Completados"}),e.jsx(g,{children:e.jsx(n,{children:U})})]})})]}),e.jsxs(n,{variant:"h6",children:["Numero de Influencer (",h.length,")"]}),e.jsx(S,{component:O,sx:{maxHeight:300,mb:4},children:e.jsxs(_,{stickyHeader:!0,size:"small",children:[e.jsx(A,{children:e.jsxs(x,{children:[e.jsx(o,{}),e.jsx(o,{children:"Nombre"}),e.jsx(o,{children:"Acción"})]})}),e.jsx(B,{children:h.map(r=>e.jsxs(x,{hover:!0,selected:r.id===a,onClick:()=>N(i=>i===r.id?null:r.id),children:[e.jsx(o,{padding:"checkbox",children:e.jsx(re,{checked:r.id===a})}),e.jsx(o,{children:r.name}),e.jsx(o,{children:e.jsx(k,{variant:"text",size:"small",onClick:i=>{i.stopPropagation(),$(r.id)},children:"Agregar Empresa"})})]},r.id))})]})}),a&&e.jsxs(e.Fragment,{children:[e.jsxs(n,{variant:"h6",children:["Semana de ",(D=h.find(r=>r.id===a))==null?void 0:D.name]}),e.jsx(S,{component:O,sx:{maxHeight:300},children:e.jsxs(_,{stickyHeader:!0,size:"small",children:[e.jsx(A,{children:e.jsxs(x,{children:[e.jsx(o,{children:"Día"}),e.jsx(o,{children:"Empresa"}),e.jsx(o,{children:"Turno"}),e.jsx(o,{children:"Estado"}),e.jsx(o,{children:"Acción"})]})}),e.jsx(B,{children:P.map(r=>e.jsxs(x,{hover:!0,children:[e.jsx(o,{children:w[r.day_of_week]??r.day_of_week}),e.jsx(o,{children:r.company.name}),e.jsx(o,{children:r.turno}),e.jsx(o,{children:r.status}),e.jsx(o,{children:e.jsx(se,{onClick:()=>F(r.id),children:e.jsx(oe,{})})})]},r.id))})]})})]}),e.jsxs(ie,{open:M,onClose:j,fullWidth:!0,maxWidth:"sm",PaperProps:{sx:{borderRadius:3,boxShadow:6}},children:[e.jsx(te,{sx:{backgroundColor:"primary.light",color:"primary.contrastText",px:3,py:2,borderTopLeftRadius:12,borderTopRightRadius:12},children:e.jsx(n,{variant:"h6",fontWeight:"bold",children:"Nueva reserva"})}),e.jsxs(ae,{dividers:!0,sx:{px:3,py:2,bgcolor:"grey.50"},children:[e.jsxs(b,{fullWidth:!0,margin:"dense",children:[e.jsx(C,{id:"label-empresa",children:"Empresa"}),e.jsx(v,{labelId:"label-empresa",value:s.companyId,label:"Empresa",onChange:r=>c(i=>({...i,companyId:Number(r.target.value),dayOfWeek:"",turno:""})),children:T.map(r=>e.jsx(I,{value:r.id,children:r.name},r.id))})]}),e.jsxs(l,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsxs(b,{fullWidth:!0,margin:"dense",disabled:!s.companyId,children:[e.jsx(C,{id:"label-dia",children:"Día"}),e.jsx(v,{labelId:"label-dia",value:s.dayOfWeek,label:"Día",onChange:r=>c(i=>({...i,dayOfWeek:r.target.value,turno:""})),children:R.map(r=>e.jsx(I,{value:r,children:w[r]??r},r))})]})}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsxs(b,{fullWidth:!0,margin:"dense",disabled:!s.dayOfWeek,children:[e.jsx(C,{id:"label-turno",children:"Turno"}),e.jsx(v,{labelId:"label-turno",value:s.turno,label:"Turno",onChange:r=>c(i=>({...i,turno:r.target.value})),children:H.map(r=>e.jsx(I,{value:r,children:r},r))})]})})]})]}),e.jsxs(ne,{sx:{px:3,pb:2,justifyContent:"flex-end"},children:[e.jsx(k,{variant:"outlined",onClick:j,sx:{borderColor:"primary.main",color:"primary.main","&:hover":{backgroundColor:"primary.light"}},children:"Cancelar"}),e.jsx(k,{variant:"contained",onClick:L,disabled:!(s.userId&&s.companyId&&s.dayOfWeek&&s.turno),sx:{ml:2,backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"}},children:"Crear"})]})]})]})]})}export{xr as default};

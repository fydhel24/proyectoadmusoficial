import{j as r,r as c,a as l}from"./app-B43QGLc0.js";import{b as D,A as M,B as R}from"./app-layout-Be3qQQND.js";import{A as L}from"./AccessTime-DAJkkfjM.js";import{u as V,B as w,T as b}from"./Box-wyR9uVm8.js";import{B as y}from"./Button-DYoxZ0OF.js";import{G as S}from"./Grid-CETg5pbP.js";import{F}from"./Grow-DipP32jZ.js";import{C as G,a as H}from"./CardContent-DjPAPL63.js";import{S as C}from"./Stack-QWcLADIl.js";import{C as N}from"./Chip-C2lNAEFa.js";import{S as U}from"./Snackbar-DXjD44eI.js";import{A as J}from"./Alert-jlTjsRRW.js";import{s as q,e as K,f as P}from"./format-BgZJCj5L.js";import"./app-logo-icon-2Eh3Z-eT.js";import"./index-CfAE_ukx.js";import"./index-HnoccPYx.js";import"./ButtonBase-BmVSOhCT.js";import"./CircularProgress-Bt0vLMV2.js";import"./useThemeProps-B6-r2NBi.js";import"./getThemeProps-DFqRyJBL.js";import"./IconButton-BL5db-mN.js";const Q=D(r.jsx("path",{d:"M10 2c-1.82 0-3.53.5-5 1.35C7.99 5.08 10 8.3 10 12s-2.01 6.92-5 8.65C6.47 21.5 8.18 22 10 22c5.52 0 10-4.48 10-10S15.52 2 10 2"})),X=D(r.jsx("path",{d:"m6.76 4.84-1.8-1.79-1.41 1.41 1.79 1.79zM4 10.5H1v2h3zm9-9.95h-2V3.5h2zm7.45 3.91-1.41-1.41-1.79 1.79 1.41 1.41zm-3.21 13.7 1.79 1.8 1.41-1.41-1.8-1.79zM20 10.5v2h3v-2zm-8-5c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6m-1 16.95h2V19.5h-2zm-7.45-3.91 1.41 1.41 1.79-1.8-1.41-1.41z"})),Y=[{title:"Disponibilidad de Influencers",href:"/influencer-availability"}],Z={monday:"Lunes",tuesday:"Martes",wednesday:"Miércoles",thursday:"Jueves",friday:"Viernes",saturday:"Sábado",sunday:"Domingo"},je=()=>{const o=V(),[f,A]=c.useState([]),[E,I]=c.useState([]),[m,x]=c.useState({}),[W,_]=c.useState(null),[g,n]=c.useState({open:!1,message:"",severity:"success"});c.useEffect(()=>{I(T()),u(),z()},[]);const z=()=>{l.get("/api/auth/user").then(a=>_(a.data.id)).catch(()=>n({open:!0,message:"Error obteniendo usuario",severity:"error"}))},T=()=>{const a=q(new Date,{weekStartsOn:1}),t=K(new Date,{weekStartsOn:1}),e=[];for(let i=new Date(a);i<=t;i.setDate(i.getDate()+1)){const p=new Date(i),h=p.getDay();h>=1&&h<=5&&e.push(p)}return e},u=()=>{l.get("/api/influencer-availability").then(a=>{A(a.data);const t={};a.data.forEach(e=>{t[e.day_of_week]=e.turno}),x(t)}).catch(()=>n({open:!0,message:"Error obteniendo disponibilidad",severity:"error"}))},v=(a,t)=>{const e=m[a];if(e===t){j(a,e);return}x(d=>({...d,[a]:t}));const i=t==="mañana"?"09:30":"14:00",p=t==="mañana"?"13:00":"18:00";f.find(d=>d.day_of_week===a&&d.turno===e)&&j(a,e);const k=f.find(d=>d.day_of_week===a&&d.turno===t);k?O(k.id,i,p):B(a,t,i,p)},B=(a,t,e,i)=>{l.post("/api/influencer-availability",{user_id:W,day_of_week:a,turno:t,start_time:e,end_time:i}).then(()=>{n({open:!0,message:"Disponibilidad guardada",severity:"success"}),u()}).catch(()=>n({open:!0,message:"Error guardando disponibilidad",severity:"error"}))},O=(a,t,e)=>{l.put(`/api/influencer-availability/${a}`,{start_time:t,end_time:e}).then(()=>{n({open:!0,message:"Disponibilidad actualizada",severity:"success"}),u()}).catch(()=>n({open:!0,message:"Error actualizando disponibilidad",severity:"error"}))},j=(a,t)=>{const e=f.find(i=>i.day_of_week===a&&i.turno===t);e&&l.delete(`/api/influencer-availability/${e.id}`).then(()=>{n({open:!0,message:"Disponibilidad eliminada",severity:"success"}),u()}).catch(()=>n({open:!0,message:"Error eliminando disponibilidad",severity:"error"}))},s=(a,t)=>m[a]===t,$=async()=>{var a,t;try{const e=await l.post("/api/asignar-empresa"),{empresa_nombre:i}=e.data;n({open:!0,message:`Empresas asignadas: ${i}`,severity:"success"}),window.open("/api/reporte-empresas-asignadas","_blank")}catch(e){n({open:!0,message:((t=(a=e.response)==null?void 0:a.data)==null?void 0:t.message)||"Error desconocido al asignar empresa.",severity:"error"})}};return r.jsxs(M,{breadcrumbs:Y,children:[r.jsx(w,{sx:{display:"flex",justifyContent:"flex-end",mb:3},children:r.jsx(y,{onClick:$,variant:"contained",color:"primary",size:"large",startIcon:r.jsx(R,{}),sx:{fontWeight:"bold",borderRadius:3,boxShadow:3,textTransform:"none",px:4,py:1.5},children:"Asignar Empresa"})}),r.jsxs(w,{sx:{borderRadius:4,background:`linear-gradient(135deg, ${o.palette.background.paper} 60%, ${o.palette.grey[100]})`,boxShadow:6,p:{xs:2,md:4},mb:4},children:[r.jsx(b,{variant:"h4",fontWeight:"bold",color:"primary",gutterBottom:!0,children:"Disponibilidad de Influencers"}),r.jsx(b,{variant:"subtitle1",color:"text.secondary",sx:{mb:3},children:"Agrega los días y turnos disponibles para la semana actual"}),r.jsx(S,{container:!0,spacing:3,children:E.filter(a=>{const t=a.getDay();return t>=1&&t<=5}).map((a,t)=>{const e=P(a,"EEEE").toLowerCase(),i=Z[e];return r.jsx(S,{item:!0,xs:12,sm:6,md:2.4,children:r.jsx(F,{in:!0,timeout:600+t*100,children:r.jsx(G,{elevation:s(e,"mañana")||s(e,"tarde")?8:2,sx:{borderRadius:3,border:s(e,"mañana")||s(e,"tarde")?`2px solid ${o.palette.primary.main}`:`1px solid ${o.palette.grey[200]}`,background:s(e,"mañana")?"linear-gradient(135deg, #e3fcec 60%, #b2f2e5)":s(e,"tarde")?"linear-gradient(135deg, #fff3e0 60%, #ffe0b2)":o.palette.background.paper,transition:"all 0.3s"},children:r.jsx(H,{children:r.jsxs(C,{alignItems:"center",spacing:2,children:[r.jsx(b,{variant:"h6",fontWeight:"bold",color:"text.primary",children:i}),r.jsxs(C,{direction:"row",spacing:2,width:"100%",children:[r.jsx(y,{fullWidth:!0,variant:s(e,"mañana")?"contained":"outlined",color:"success",startIcon:r.jsx(X,{}),sx:{fontWeight:600,boxShadow:s(e,"mañana")?3:0,background:s(e,"mañana")?"linear-gradient(90deg, #43e97b 0%, #38f9d7 100%)":void 0,color:s(e,"mañana")?"#fff":void 0,borderColor:s(e,"mañana")?o.palette.success.main:void 0,transition:"all 0.2s"},onClick:()=>v(e,"mañana"),children:"Mañana"}),r.jsx(y,{fullWidth:!0,variant:s(e,"tarde")?"contained":"outlined",color:"warning",startIcon:r.jsx(Q,{}),sx:{fontWeight:600,boxShadow:s(e,"tarde")?3:0,background:s(e,"tarde")?"linear-gradient(90deg, #f7971e 0%, #ffd200 100%)":void 0,color:s(e,"tarde")?"#fff":void 0,borderColor:s(e,"tarde")?o.palette.warning.main:void 0,transition:"all 0.2s"},onClick:()=>v(e,"tarde"),children:"Tarde"})]}),m[e]&&r.jsx(N,{icon:r.jsx(L,{}),label:m[e]==="mañana"?"09:30 - 13:00":"14:00 - 18:00",color:m[e]==="mañana"?"success":"warning",sx:{fontWeight:500}})]})})})})},t)})})]}),r.jsx(U,{open:g.open,autoHideDuration:4e3,onClose:()=>n(a=>({...a,open:!1})),anchorOrigin:{vertical:"top",horizontal:"center"},children:r.jsx(J,{severity:g.severity,onClose:()=>n(a=>({...a,open:!1})),children:g.message})})]})};export{je as default};

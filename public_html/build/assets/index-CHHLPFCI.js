import{r as i,j as t,$ as oe}from"./app-DS3uoOND.js";import{A as re}from"./app-layout-dGixMl-5.js";import{A as ae}from"./Add-Bb1wGiDl.js";import{D as W}from"./Delete-BioLUTcp.js";import{E as ie}from"./Edit-DFxHfvAa.js";import{S as ne}from"./Search-Bc7UiiSl.js";import{u as se,T as ce,P as le}from"./Typography-Cn8qhNN2.js";import{B as q}from"./Box-CrJgDB4g.js";import{T as P}from"./TextField-v1JzYI7D.js";import{I as v}from"./IconButton-BgLeftg_.js";import{B as N}from"./Button-CTeTaFAq.js";import{T as me,a as de}from"./TablePagination-Bk2yTSlZ.js";import{T as pe}from"./TableContainer-DF0RHotP.js";import{T as ue,a as he,b as L,c as ge}from"./TableRow-B7sPEMUn.js";import{T as u}from"./TableCell-DWjCeP20.js";import{C as M}from"./Checkbox-B3prJ-ve.js";import{T as K}from"./TableSortLabel-DJWeF2uM.js";import{D as xe,a as fe,b as be}from"./DialogTitle-DhzMfPFK.js";import{D as je}from"./DialogActions-RdHqDlnC.js";import{S as Ce}from"./Snackbar-D-Obroo_.js";import"./button-Kx2Zvocp.js";import"./clsx-B-dksMZM.js";import"./avatar-DFuxCuZM.js";import"./createLucideIcon-DKQO-RzO.js";import"./index-CYi7GZxD.js";import"./index-p19kejRW.js";import"./index-C0VGp2n2.js";import"./settings-BD-k1jiO.js";import"./app-logo-icon-CG32F8XV.js";import"./createSvgIcon-Calpj8hy.js";import"./DefaultPropsProvider-C7SiBE39.js";import"./useSlot-DFNZbsPJ.js";import"./useTimeout-MaWeZhHA.js";import"./useId-JcoErVa5.js";import"./Select-DOfJ3Geg.js";import"./isMuiElement-DyoSLfDx.js";import"./index-Htz8HIlZ.js";import"./useSlotProps-B3LOQJQT.js";import"./List-BlyVhjTx.js";import"./Fade-DOI0Eqcg.js";import"./Modal-BUVjLBoZ.js";import"./Portal-BW3CIyqt.js";import"./debounce-Be36O1Ab.js";import"./Grow-DzyevDEk.js";import"./useControlled-DphJ1wc8.js";import"./ButtonBase-Ai_L0S2Q.js";import"./CircularProgress-B4tsNAyg.js";import"./KeyboardArrowRight-DM-gBlrB.js";import"./LastPage-DyKxIrmo.js";import"./MenuItem-CQ6FF82o.js";import"./listItemTextClasses-DNcqAbCk.js";import"./dividerClasses-B3Jw0fQu.js";import"./SwitchBase-gK4QOO3w.js";import"./ClickAwayListener-BcAxHBCQ.js";const Se=[{title:"Categorías",href:"/categories"}];function X(m,o,n){return o[n]<m[n]?-1:o[n]>m[n]?1:0}function ke(m,o){return m==="desc"?(n,s)=>X(n,s,o):(n,s)=>-X(n,s,o)}function ye(m,o){const n=m.map((s,d)=>[s,d]);return n.sort((s,d)=>{const f=o(s[0],d[0]);return f!==0?f:s[1]-d[1]}),n.map(s=>s[0])}function Tt({categories:m}){const o=se(),[n,s]=i.useState(m),[d,f]=i.useState(""),[$,C]=i.useState(!1),[S,c]=i.useState(null),[H,T]=i.useState(null),[w,D]=i.useState(""),[k,J]=i.useState(""),[h,U]=i.useState("asc"),[l,_]=i.useState("id"),[p,E]=i.useState([]),[y,I]=i.useState(0),[b,G]=i.useState(10),A=async e=>{var r;if(window.confirm("¿Seguro que deseas eliminar?"))try{const a=((r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content"))||"";await fetch(`/categories/${e}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":a}}),s(x=>x.filter(j=>j.id!==e)),c("Categoría eliminada")}catch{c("Error al eliminar")}},R=(e,r)=>{T(e),D(r)},O=async e=>{var r;if(!w.trim()){c("Nombre obligatorio");return}try{const a=((r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content"))||"",x=await fetch(`/categories/${e}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":a},body:JSON.stringify({name:w})});if(!x.ok)throw new Error;const j=await x.json();s(te=>te.map(B=>B.id===e?j:B)),c("Categoría actualizada")}catch{c("Error al actualizar")}finally{T(null),D("")}},Q=async()=>{var e;if(!d.trim()){c("Nombre obligatorio");return}try{const r=((e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.getAttribute("content"))||"",a=await fetch("/categories",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":r},body:JSON.stringify({name:d})});if(!a.ok)throw new Error;const x=await a.json();s(j=>[...j,x]),c("Categoría creada"),f(""),C(!1)}catch{c("Error al crear")}};i.useEffect(()=>{if(!S)return;const e=setTimeout(()=>c(null),4e3);return()=>clearTimeout(e)},[S]);const g=i.useMemo(()=>n.filter(e=>e.name.toLowerCase().includes(k.toLowerCase())||String(e.id).includes(k)),[n,k]),z=i.useMemo(()=>ye(g,ke(h,l)),[g,h,l]),V=i.useMemo(()=>z.slice(y*b,y*b+b),[z,y,b]),F=e=>{U(l===e&&h==="asc"?"desc":"asc"),_(e)},Y=e=>{e.target.checked?E(g.map(r=>r.id)):E([])},Z=e=>{E(r=>r.includes(e)?r.filter(a=>a!==e):[...r,e])},ee=e=>p.indexOf(e)!==-1;return t.jsxs(re,{breadcrumbs:Se,children:[t.jsx(oe,{title:"Categorías"}),t.jsxs(q,{sx:{display:"flex",gap:2,mb:3,alignItems:"center"},children:[t.jsx(P,{label:"Buscar por nombre o ID",variant:"outlined",size:"small",value:k,onChange:e=>J(e.target.value),sx:{maxWidth:320},InputProps:{startAdornment:t.jsx(v,{tabIndex:-1,children:t.jsx(ne,{})})}}),t.jsx(N,{variant:"contained",startIcon:t.jsx(ae,{}),onClick:()=>C(!0),sx:{fontWeight:"bold"},children:"Crear categoría"})]}),p.length>0&&t.jsxs(me,{sx:{bgcolor:"action.selected",mb:1,borderRadius:2},children:[t.jsxs(ce,{sx:{flex:"1 1 100%"},color:"inherit",children:[p.length," seleccionado",p.length>1?"s":""]}),t.jsx(v,{color:"error",onClick:()=>p.forEach(e=>A(e)),children:t.jsx(W,{})})]}),t.jsxs(pe,{component:le,sx:{borderRadius:2,boxShadow:3,overflowX:"auto",border:"1px solid #e0e0e0",background:o.palette.background.paper,mx:{xs:0,md:2}},children:[t.jsxs(ue,{size:"small",children:[t.jsx(he,{children:t.jsxs(L,{children:[t.jsx(u,{padding:"checkbox",sx:{backgroundColor:o.palette.primary.main,color:o.palette.common.white},children:t.jsx(M,{indeterminate:p.length>0&&p.length<g.length,checked:g.length>0&&p.length===g.length,onChange:Y,sx:{color:o.palette.common.white}})}),t.jsx(u,{sortDirection:l==="id"?h:!1,sx:{fontWeight:"bold",backgroundColor:o.palette.primary.main,color:o.palette.common.white},children:t.jsx(K,{active:l==="id",direction:l==="id"?h:"asc",onClick:()=>F("id"),sx:{color:o.palette.common.white,"&.Mui-active":{color:o.palette.common.white}},children:"ID"})}),t.jsx(u,{sortDirection:l==="name"?h:!1,sx:{fontWeight:"bold",backgroundColor:o.palette.primary.main,color:o.palette.common.white},children:t.jsx(K,{active:l==="name",direction:l==="name"?h:"asc",onClick:()=>F("name"),sx:{color:o.palette.common.white,"&.Mui-active":{color:o.palette.common.white}},children:"Nombre"})}),t.jsx(u,{sx:{fontWeight:"bold",backgroundColor:o.palette.primary.main,color:o.palette.common.white},children:"Acciones"})]})}),t.jsx(ge,{children:V.map(e=>{const r=ee(e.id);return t.jsxs(L,{hover:!0,selected:r,onClick:()=>Z(e.id),children:[t.jsx(u,{padding:"checkbox",children:t.jsx(M,{checked:r})}),t.jsx(u,{children:e.id}),t.jsx(u,{children:H===e.id?t.jsx(P,{value:w,size:"small",autoFocus:!0,onChange:a=>D(a.target.value),onBlur:()=>O(e.id),onKeyDown:a=>{a.key==="Enter"&&O(e.id),a.key==="Escape"&&T(null)}}):t.jsxs(q,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(ie,{fontSize:"small",color:"action",sx:{cursor:"pointer"},onClick:a=>{a.stopPropagation(),R(e.id,e.name)}}),t.jsx("span",{onDoubleClick:()=>R(e.id,e.name),style:{cursor:"pointer"},title:"Doble click para editar",children:e.name})]})}),t.jsx(u,{children:t.jsx(v,{size:"small",color:"error",onClick:a=>{a.stopPropagation(),A(e.id)},children:t.jsx(W,{})})})]},e.id)})})]}),t.jsx(de,{component:"div",count:g.length,page:y,rowsPerPage:b,onPageChange:(e,r)=>I(r),onRowsPerPageChange:e=>{G(parseInt(e.target.value,10)),I(0)},rowsPerPageOptions:[5,10,25],labelRowsPerPage:"Filas por página"})]}),t.jsxs(xe,{open:$,onClose:()=>C(!1),children:[t.jsx(fe,{children:"Crear Nueva Categoría"}),t.jsx(be,{children:t.jsx(P,{autoFocus:!0,fullWidth:!0,margin:"dense",label:"Nombre de la categoría",value:d,onChange:e=>f(e.target.value)})}),t.jsxs(je,{children:[t.jsx(N,{onClick:()=>C(!1),children:"Cancelar"}),t.jsx(N,{variant:"contained",onClick:Q,children:"Crear"})]})]}),t.jsx(Ce,{open:!!S,message:S,onClose:()=>c(null),autoHideDuration:4e3})]})}export{Tt as default};

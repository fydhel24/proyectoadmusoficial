import{r as t,a as o,j as a,$ as ae}from"./app-B43QGLc0.js";import{A as te}from"./app-layout-Be3qQQND.js";import{u as re,B as k,P as se,T as oe}from"./Box-wyR9uVm8.js";import{u as ie,C as M}from"./Close-Cz4RoyBw.js";import{T as n}from"./TextField-DxJvG6sb.js";import{I as c}from"./IconButton-BL5db-mN.js";import{S as ne}from"./Search-FSgN8jeY.js";import{B as E}from"./Button-DYoxZ0OF.js";import{E as B}from"./Edit-ObCAyVeJ.js";import{T as le,a as ce,b as de,c as L,d as r,e as ue,D as he}from"./Delete-BkjAzzvM.js";import{D as me,a as pe,b as xe,c as fe}from"./DialogTitle-DF65PE_P.js";import{F as N,I as P,S as F}from"./Select-BCKCZh52.js";import{M as d}from"./MenuItem-DkzQH4XY.js";import"./app-logo-icon-2Eh3Z-eT.js";import"./index-CfAE_ukx.js";import"./index-HnoccPYx.js";import"./getThemeProps-DFqRyJBL.js";import"./Grow-DipP32jZ.js";import"./ButtonBase-BmVSOhCT.js";import"./CircularProgress-Bt0vLMV2.js";import"./Portal-DCrN8Gw5.js";import"./dividerClasses-CS4maqJB.js";const je=[{title:"Tareas",href:"/tareas"}];function Re(){const[A,_]=t.useState([]),[H,s]=t.useState(!1),[u,h]=t.useState(""),[m,p]=t.useState(""),[x,f]=t.useState(""),[j,T]=t.useState(""),[b,g]=t.useState(""),[v,C]=t.useState(""),[R,$]=t.useState([]),[q,z]=t.useState([]),[I,W]=t.useState(!1),[S,D]=t.useState(!1),[G,Q]=t.useState(null),[w,X]=t.useState(""),J=re();ie(J.breakpoints.down("sm")),t.useEffect(()=>{y(),K(),O()},[]);const y=()=>{o.get("/api/tareas").then(e=>_(e.data)).catch(e=>console.error("Error fetching tareas:",e))},K=()=>{o.get("/api/tipos").then(e=>$(e.data)).catch(e=>console.error("Error fetching tipos:",e))},O=()=>{o.get("/api/companies").then(e=>z(e.data)).catch(e=>console.error("Error fetching companies:",e))},U=()=>{D(!1),h(""),p(""),f(""),T(""),g(""),C(""),s(!0)},V=e=>{D(!0),Q(e.id),h(e.titulo),p(e.descripcion),f(e.fecha),T(e.prioridad),g(e.tipo_id),C(e.company_id),s(!0)},Y=()=>{if(!u.trim()||!m.trim()||!x.trim()||!j.trim()||!b||!v)return alert("Todos los campos son obligatorios");W(!0);const e={titulo:u,descripcion:m,fecha:x,prioridad:j,tipo_id:b,company_id:v};(S?o.put(`/tareas/${G}`,e):o.post("/tareas",e)).then(()=>{s(!1),y()}).catch(l=>{console.error("Error guardando la tarea:",l),alert("Hubo un error")}).finally(()=>W(!1))},Z=e=>{confirm("¿Estás seguro de que deseas eliminar esta tarea?")&&o.delete(`/tareas/${e}`).then(()=>y()).catch(i=>{console.error("Error al eliminar la tarea:",i),alert("Hubo un error al eliminar la tarea")})},ee=A.filter(e=>e.titulo.toLowerCase().includes(w.toLowerCase())||e.descripcion.toLowerCase().includes(w.toLowerCase()));return a.jsxs(te,{breadcrumbs:je,children:[a.jsx(ae,{title:"Tareas"}),a.jsxs(k,{sx:{padding:2},children:[a.jsxs(k,{sx:{display:"flex",alignItems:"center",marginBottom:2},children:[a.jsx(n,{label:"Buscar",variant:"outlined",size:"small",fullWidth:!0,value:w,onChange:e=>X(e.target.value),sx:{marginRight:2},InputProps:{startAdornment:a.jsx(c,{children:a.jsx(ne,{})})}}),a.jsx(E,{variant:"contained",color:"primary",sx:{ml:2},onClick:U,startIcon:a.jsx(B,{}),children:"Nueva Tarea"})]}),a.jsx(le,{component:se,sx:{borderRadius:2,boxShadow:3,overflowX:"auto"},children:a.jsxs(ce,{stickyHeader:!0,sx:{minWidth:650},children:[a.jsx(de,{children:a.jsxs(L,{children:[a.jsx(r,{sx:{fontWeight:"bold"},children:"Título"}),a.jsx(r,{sx:{fontWeight:"bold"},children:"Prioridad"}),a.jsx(r,{sx:{fontWeight:"bold"},children:"Fecha"}),a.jsx(r,{sx:{fontWeight:"bold"},children:"Tipo"}),a.jsx(r,{sx:{fontWeight:"bold"},children:"Empresa"}),a.jsx(r,{sx:{fontWeight:"bold"},children:"Acciones"})]})}),a.jsx(ue,{children:ee.map(e=>{var i,l;return a.jsxs(L,{hover:!0,children:[a.jsx(r,{children:e.titulo}),a.jsx(r,{children:e.prioridad}),a.jsx(r,{children:e.fecha}),a.jsx(r,{children:(i=e.tipo)==null?void 0:i.nombre_tipo}),a.jsx(r,{children:(l=e.company)==null?void 0:l.nombre}),a.jsxs(r,{children:[a.jsx(c,{color:"primary",onClick:()=>V(e),children:a.jsx(B,{})}),a.jsx(c,{color:"error",onClick:()=>Z(e.id),children:a.jsx(he,{})})]})]},e.id)})})]})})]}),a.jsxs(me,{open:H,onClose:()=>s(!1),maxWidth:"sm",fullWidth:!0,children:[a.jsxs(pe,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsx(oe,{variant:"h6",children:S?"Editar Tarea":"Crear Nueva Tarea"}),a.jsx(c,{onClick:()=>s(!1),children:a.jsx(M,{})})]}),a.jsxs(xe,{dividers:!0,children:[a.jsx(n,{label:"Título de la tarea",variant:"outlined",fullWidth:!0,value:u,onChange:e=>h(e.target.value),sx:{mb:2}}),a.jsx(n,{label:"Descripción de la tarea",variant:"outlined",fullWidth:!0,value:m,onChange:e=>p(e.target.value),sx:{mb:2}}),a.jsx(n,{label:"Fecha de vencimiento",variant:"outlined",fullWidth:!0,type:"date",value:x,onChange:e=>f(e.target.value),sx:{mb:2},InputLabelProps:{shrink:!0}}),a.jsx(n,{label:"Prioridad",variant:"outlined",fullWidth:!0,value:j,onChange:e=>T(e.target.value),sx:{mb:2}}),a.jsxs(N,{fullWidth:!0,sx:{mb:2},children:[a.jsx(P,{id:"select-tipo-label",children:"Tipo"}),a.jsxs(F,{labelId:"select-tipo-label",value:b||"",onChange:e=>g(e.target.value),children:[a.jsx(d,{value:"",children:"Seleccionar tipo"}),R.map(e=>a.jsx(d,{value:e.id,children:e.nombre_tipo},e.id))]})]}),a.jsxs(N,{fullWidth:!0,sx:{mb:2},children:[a.jsx(P,{id:"select-company-label",children:"Empresa"}),a.jsxs(F,{labelId:"select-company-label",value:v||"",onChange:e=>C(e.target.value),children:[a.jsx(d,{value:"",children:"Seleccionar empresa"}),q.map(e=>a.jsx(d,{value:e.id,children:e.nombre},e.id))]})]})]}),a.jsxs(fe,{children:[a.jsx(E,{onClick:()=>s(!1),color:"inherit",variant:"outlined",disabled:I,startIcon:a.jsx(M,{}),children:"Cancelar"}),a.jsx(E,{onClick:Y,color:"primary",variant:"contained",disabled:I,children:I?"Guardando...":S?"Actualizar":"Crear"})]})]})]})}export{Re as default};

import{j as e,r as d,$ as F,U as G}from"./app-DwTpSH0U.js";import{A as _}from"./app-layout-DnzGBPFG.js";import{C as $}from"./CheckCircle-C5-K34PY.js";import{E as U}from"./Edit-DMjXLoX-.js";import{c as V}from"./createSvgIcon-DkcSd2-O.js";import{B as E}from"./Box-Dm-9Odlo.js";import{T as s}from"./Typography-B8heRhDi.js";import{G as h}from"./Grid-CGKqZQau.js";import{C}from"./Card-BU2PQy8v.js";import{C as S}from"./CardContent-CdRAFDU_.js";import{T as B}from"./TextField-C7xTuRXe.js";import{A as q}from"./Alert-CXzScL7w.js";import{T as J}from"./Tooltip-CIjkDYaB.js";import{I as K}from"./IconButton-zbVVF-M4.js";import{D as X}from"./Divider-DTm5htnZ.js";import{C as Y}from"./Chip-BiIDCYhV.js";import{B as D}from"./Button-D3LYaN2t.js";import{M as H}from"./Modal-EvmVwdIL.js";import{M as Q}from"./MenuItem-BREP7BA3.js";import{S as Z}from"./Stack-CfXKeJ1o.js";import"./button-CE2sw9In.js";import"./clsx-B-dksMZM.js";import"./avatar-3rZPDCsD.js";import"./createLucideIcon-8z-XiBgF.js";import"./index-DQwHB60N.js";import"./index-Bu13Uyqm.js";import"./index-DuFQU5C7.js";import"./settings-BWGxbpXO.js";import"./app-logo-icon-kT6HeMlV.js";import"./DefaultPropsProvider-DRRnqVYH.js";import"./createSimplePaletteValueFilter-fPviOYGM.js";import"./useThemeProps-BzNHYq9I.js";import"./getThemeProps-BDgLecqf.js";import"./isMuiElement-BJS3qdzF.js";import"./useSlot-DErp_0ST.js";import"./TransitionGroupContext-nALX_Gj3.js";import"./useId-DQCmvY1A.js";import"./Select-D3mwh1vN.js";import"./index-Bw2APseq.js";import"./useSlotProps-BNWp3nnv.js";import"./List-NBjoO2Ug.js";import"./ownerDocument-DW-IO8s5.js";import"./debounce-Be36O1Ab.js";import"./Grow-BaQddceE.js";import"./Fade-CPmkmtx1.js";import"./useTimeout--HoZvQIH.js";import"./useControlled-CkY63cvR.js";import"./Close-C7XsUd9X.js";import"./Popper-z26wZ0XF.js";import"./Portal-dRwe7D2B.js";import"./ButtonBase-DRmvLRZN.js";import"./CircularProgress-D9k1A7p4.js";import"./dividerClasses-DGcU9ie_.js";import"./listItemTextClasses-PvA2CV_-.js";const ee=V(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2M7 13.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5m5 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5m5 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5"})),te=[{value:"pendiente",label:"Pendiente"},{value:"en_revision",label:"En revision"},{value:"publicada",label:"Publicada"}],re=j=>j==="publicada"?"success.main":"background.paper",M={alta:"游댠 Importantes",media:"游리 Normales",baja:"游릭 B치sicas"};function ae({open:j,onClose:m,tarea:r,onSave:v}){const[f,c]=d.useState((r==null?void 0:r.estado)||"pendiente"),[t,i]=d.useState((r==null?void 0:r.detalle)||""),[o,g]=d.useState(!1);G.useEffect(()=>{r&&(c(r.estado),i(r.detalle||""))},[r]);const y=async()=>{r&&(g(!0),await v(r.id,f,t),g(!1),m())};return e.jsx(H,{open:j,onClose:m,children:e.jsxs(E,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",boxShadow:24,p:4,borderRadius:2},children:[e.jsx(s,{variant:"h6",mb:2,children:"Editar Estado y Detalle"}),e.jsx(B,{fullWidth:!0,select:!0,label:"Estado",value:f,onChange:n=>c(n.target.value),sx:{mb:2},children:te.map(n=>e.jsx(Q,{value:n.value,children:n.label},n.value))}),e.jsx(B,{fullWidth:!0,label:"Detalle",multiline:!0,minRows:3,value:t,onChange:n=>i(n.target.value),sx:{mb:3}}),e.jsxs(Z,{direction:"row",spacing:2,justifyContent:"flex-end",children:[e.jsx(D,{onClick:m,disabled:o,children:"Cancelar"}),e.jsx(D,{variant:"contained",onClick:y,disabled:o,children:"Guardar"})]})]})})}const A=({title:j,items:m,onEdit:r})=>{const[v,f]=d.useState(new Set);if(!m||m.length===0)return null;const c=t=>{f(i=>{const o=new Set(i);return o.has(t)?o.delete(t):o.add(t),o})};return e.jsxs(E,{sx:{mb:6},children:[e.jsx(s,{variant:"h5",sx:{mb:2},children:j}),e.jsx(h,{container:!0,spacing:3,children:m.map(t=>{var y,n,p;const i=t.estado==="publicada",o=t.detalle&&t.detalle.length>100,g=!o||v.has(t.id)?t.detalle:((y=t.detalle)==null?void 0:y.slice(0,100))+"...";return e.jsxs(h,{item:!0,xs:12,md:4,children:[" ",e.jsx(C,{sx:{bgcolor:re(t.estado),transition:"background-color 0.3s",height:"100%",display:"flex",flexDirection:"column",justifyContent:"space-between"},children:e.jsxs(S,{children:[e.jsxs(E,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(s,{variant:"h6",children:t.tarea.titulo}),e.jsx(J,{title:"Editar Estado y Detalle",children:e.jsx(K,{onClick:()=>r(t),size:"small",color:i?"success":"primary",children:e.jsx(U,{})})})]}),e.jsx(s,{variant:"body2",color:"text.secondary",children:t.tarea.descripcion}),e.jsx(X,{sx:{my:2}}),e.jsxs(E,{children:[" ",e.jsx("strong",{children:"Tipo:"})," ",((n=t.tarea.tipo)==null?void 0:n.nombre_tipo)||"N/A"," ",e.jsx("br",{}),e.jsx("strong",{children:"Empresa:"})," ",((p=t.tarea.company)==null?void 0:p.name)||"N/A"," ",e.jsx("br",{}),e.jsx("strong",{children:"Estado:"})]}),e.jsx(Y,{label:t.estado,color:i?"success":"default",size:"small",icon:i?e.jsx($,{}):e.jsx(ee,{})})," ",e.jsxs(E,{children:[e.jsx("strong",{children:"Detalle:"})," ",g," ",o&&e.jsx(D,{size:"small",onClick:()=>c(t.id),sx:{textTransform:"none",ml:1},children:v.has(t.id)?"Ver menos":"Ver m치s"})]})]})})]},t.id)})})]})};function st({tareas:j,filters:m}){const[r,v]=d.useState(m.search||""),[f,c]=d.useState(null),[t,i]=d.useState(j),[o,g]=d.useState({type:null,message:null}),y=d.useCallback((a,u,x)=>{i(b=>{var w;const l={...b};for(const k in l)l[k]&&(l[k]=((w=l[k])==null?void 0:w.map(I=>I.id===a?{...I,estado:u,detalle:x}:I))||[]);return l})},[i]),n=d.useMemo(()=>{var u,x,b;const a=l=>l.tarea.titulo.toLowerCase().includes(r.toLowerCase());return{alta:((u=t.alta)==null?void 0:u.filter(a))||[],media:((x=t.media)==null?void 0:x.filter(a))||[],baja:((b=t.baja)==null?void 0:b.filter(a))||[]}},[r,t]),p=a=>(a==null?void 0:a.length)||0,T=(a,u)=>(a==null?void 0:a.filter(x=>x.estado===u).length)||0,W=p(t.alta),z=p(t.media),L=p(t.baja),P=T(t.alta,"publicada")+T(t.media,"publicada")+T(t.baja,"publicada"),N=p(t.alta)+p(t.media)+p(t.baja)-P,R=async(a,u,x)=>{var b;try{const l=(b=document.querySelector('meta[name="csrf-token"]'))==null?void 0:b.getAttribute("content");if(!(await fetch(`/pasante/actualizar/${a}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":l||""},body:JSON.stringify({estado:u,detalle:x})})).ok)throw new Error("Error actualizando la tarea");y(a,u,x),c(null),g({type:"success",message:"Tarea actualizada correctamente"})}catch(l){g({type:"error",message:"Error actualizando la tarea: "+l.message})}},O=[{title:"Pasante",href:"/pasante"}];return e.jsxs(_,{breadcrumbs:O,children:[e.jsx(F,{title:"Tareas del D칤a"}),e.jsxs(E,{sx:{px:2,py:4},children:[e.jsx(s,{variant:"h4",gutterBottom:!0,children:"Tareas del D칤a"}),e.jsxs(h,{container:!0,spacing:2,sx:{mb:4},children:[e.jsx(h,{item:!0,xs:12,sm:6,md:2,children:e.jsx(C,{sx:{bgcolor:"error.light"},children:e.jsxs(S,{children:[e.jsx(s,{variant:"h6",color:"error.main",align:"center",children:W}),e.jsx(s,{variant:"body2",align:"center",fontWeight:"bold",color:"error.main",children:"Importantes"})]})})}),e.jsx(h,{item:!0,xs:12,sm:6,md:2,children:e.jsx(C,{sx:{bgcolor:"warning.light"},children:e.jsxs(S,{children:[e.jsx(s,{variant:"h6",color:"warning.main",align:"center",children:z}),e.jsx(s,{variant:"body2",align:"center",fontWeight:"bold",color:"warning.main",children:"Normales"})]})})}),e.jsx(h,{item:!0,xs:12,sm:6,md:2,children:e.jsx(C,{sx:{bgcolor:"info.light"},children:e.jsxs(S,{children:[e.jsx(s,{variant:"h6",color:"info.main",align:"center",children:L}),e.jsx(s,{variant:"body2",align:"center",fontWeight:"bold",color:"info.main",children:"B치sicas"})]})})}),e.jsx(h,{item:!0,xs:12,sm:6,md:3,children:e.jsx(C,{sx:{bgcolor:"success.light"},children:e.jsxs(S,{children:[e.jsx(s,{variant:"h6",color:"success.main",align:"center",children:P}),e.jsx(s,{variant:"body2",align:"center",fontWeight:"bold",color:"success.main",children:"Completadas"})]})})}),e.jsx(h,{item:!0,xs:12,sm:6,md:3,children:e.jsx(C,{sx:{bgcolor:"grey.300"},children:e.jsxs(S,{children:[e.jsx(s,{variant:"h6",align:"center",color:"text.primary",children:N}),e.jsx(s,{variant:"body2",align:"center",fontWeight:"bold",color:"text.primary",children:"Pendientes"})]})})})]}),e.jsx(B,{label:"Buscar tareas por t칤tulo",variant:"outlined",fullWidth:!0,value:r,onChange:a=>v(a.target.value),sx:{mb:4}}),o.type&&e.jsx(q,{severity:o.type,sx:{mb:2},children:o.message}),e.jsx(A,{title:M.alta,items:n.alta,onEdit:c}),e.jsx(A,{title:M.media,items:n.media,onEdit:c}),e.jsx(A,{title:M.baja,items:n.baja,onEdit:c})]}),e.jsx(ae,{open:!!f,onClose:()=>c(null),tarea:f,onSave:R})]})}export{st as default};

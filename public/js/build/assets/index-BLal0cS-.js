import{r as n,j as t,$ as oe}from"./app-B43QGLc0.js";import{A as ae}from"./app-layout-Be3qQQND.js";import{A as re}from"./Add-BrhojVUH.js";import{D as W,T as ne,a as se,b as ie,c as q,d as h,e as ce}from"./Delete-BkjAzzvM.js";import{E as le}from"./Edit-ObCAyVeJ.js";import{S as de}from"./Search-FSgN8jeY.js";import{u as me,B as L,T as ue,P as he}from"./Box-wyR9uVm8.js";import{T as P}from"./TextField-DxJvG6sb.js";import{I as v}from"./IconButton-BL5db-mN.js";import{B as I}from"./Button-DYoxZ0OF.js";import{T as pe,a as ge}from"./TablePagination-ByLNpSOA.js";import{C as M}from"./Checkbox-DXyLT61I.js";import{T as K}from"./TableSortLabel-BhlA9Og9.js";import{D as xe,a as fe,b as be,c as je}from"./DialogTitle-DF65PE_P.js";import{S as Ce}from"./Snackbar-DXjD44eI.js";import"./app-logo-icon-2Eh3Z-eT.js";import"./index-CfAE_ukx.js";import"./index-HnoccPYx.js";import"./Grow-DipP32jZ.js";import"./Select-BCKCZh52.js";import"./Portal-DCrN8Gw5.js";import"./ButtonBase-BmVSOhCT.js";import"./CircularProgress-Bt0vLMV2.js";import"./MenuItem-DkzQH4XY.js";import"./dividerClasses-CS4maqJB.js";const Se=[{title:"Categorías",href:"/categories"}];function X(d,o,s){return o[s]<d[s]?-1:o[s]>d[s]?1:0}function ke(d,o){return d==="desc"?(s,i)=>X(s,i,o):(s,i)=>-X(s,i,o)}function ye(d,o){const s=d.map((i,m)=>[i,m]);return s.sort((i,m)=>{const f=o(i[0],m[0]);return f!==0?f:i[1]-m[1]}),s.map(i=>i[0])}function Ge({categories:d}){const o=me(),[s,i]=n.useState(d),[m,f]=n.useState(""),[$,C]=n.useState(!1),[S,c]=n.useState(null),[H,T]=n.useState(null),[w,E]=n.useState(""),[k,J]=n.useState(""),[p,U]=n.useState("asc"),[l,_]=n.useState("id"),[u,D]=n.useState([]),[y,N]=n.useState(0),[b,G]=n.useState(10),A=async e=>{var a;if(window.confirm("¿Seguro que deseas eliminar?"))try{const r=((a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.getAttribute("content"))||"";await fetch(`/categories/${e}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":r}}),i(x=>x.filter(j=>j.id!==e)),c("Categoría eliminada")}catch{c("Error al eliminar")}},R=(e,a)=>{T(e),E(a)},O=async e=>{var a;if(!w.trim()){c("Nombre obligatorio");return}try{const r=((a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.getAttribute("content"))||"",x=await fetch(`/categories/${e}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":r},body:JSON.stringify({name:w})});if(!x.ok)throw new Error;const j=await x.json();i(te=>te.map(B=>B.id===e?j:B)),c("Categoría actualizada")}catch{c("Error al actualizar")}finally{T(null),E("")}},Q=async()=>{var e;if(!m.trim()){c("Nombre obligatorio");return}try{const a=((e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.getAttribute("content"))||"",r=await fetch("/categories",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":a},body:JSON.stringify({name:m})});if(!r.ok)throw new Error;const x=await r.json();i(j=>[...j,x]),c("Categoría creada"),f(""),C(!1)}catch{c("Error al crear")}};n.useEffect(()=>{if(!S)return;const e=setTimeout(()=>c(null),4e3);return()=>clearTimeout(e)},[S]);const g=n.useMemo(()=>s.filter(e=>e.name.toLowerCase().includes(k.toLowerCase())||String(e.id).includes(k)),[s,k]),z=n.useMemo(()=>ye(g,ke(p,l)),[g,p,l]),V=n.useMemo(()=>z.slice(y*b,y*b+b),[z,y,b]),F=e=>{U(l===e&&p==="asc"?"desc":"asc"),_(e)},Y=e=>{e.target.checked?D(g.map(a=>a.id)):D([])},Z=e=>{D(a=>a.includes(e)?a.filter(r=>r!==e):[...a,e])},ee=e=>u.indexOf(e)!==-1;return t.jsxs(ae,{breadcrumbs:Se,children:[t.jsx(oe,{title:"Categorías"}),t.jsxs(L,{sx:{display:"flex",gap:2,mb:3,alignItems:"center"},children:[t.jsx(P,{label:"Buscar por nombre o ID",variant:"outlined",size:"small",value:k,onChange:e=>J(e.target.value),sx:{maxWidth:320},InputProps:{startAdornment:t.jsx(v,{tabIndex:-1,children:t.jsx(de,{})})}}),t.jsx(I,{variant:"contained",startIcon:t.jsx(re,{}),onClick:()=>C(!0),sx:{fontWeight:"bold"},children:"Crear categoría"})]}),u.length>0&&t.jsxs(pe,{sx:{bgcolor:"action.selected",mb:1,borderRadius:2},children:[t.jsxs(ue,{sx:{flex:"1 1 100%"},color:"inherit",children:[u.length," seleccionado",u.length>1?"s":""]}),t.jsx(v,{color:"error",onClick:()=>u.forEach(e=>A(e)),children:t.jsx(W,{})})]}),t.jsxs(ne,{component:he,sx:{borderRadius:2,boxShadow:3,overflowX:"auto",border:"1px solid #e0e0e0",background:o.palette.background.paper,mx:{xs:0,md:2}},children:[t.jsxs(se,{size:"small",children:[t.jsx(ie,{children:t.jsxs(q,{children:[t.jsx(h,{padding:"checkbox",sx:{backgroundColor:o.palette.primary.main,color:o.palette.common.white},children:t.jsx(M,{indeterminate:u.length>0&&u.length<g.length,checked:g.length>0&&u.length===g.length,onChange:Y,sx:{color:o.palette.common.white}})}),t.jsx(h,{sortDirection:l==="id"?p:!1,sx:{fontWeight:"bold",backgroundColor:o.palette.primary.main,color:o.palette.common.white},children:t.jsx(K,{active:l==="id",direction:l==="id"?p:"asc",onClick:()=>F("id"),sx:{color:o.palette.common.white,"&.Mui-active":{color:o.palette.common.white}},children:"ID"})}),t.jsx(h,{sortDirection:l==="name"?p:!1,sx:{fontWeight:"bold",backgroundColor:o.palette.primary.main,color:o.palette.common.white},children:t.jsx(K,{active:l==="name",direction:l==="name"?p:"asc",onClick:()=>F("name"),sx:{color:o.palette.common.white,"&.Mui-active":{color:o.palette.common.white}},children:"Nombre"})}),t.jsx(h,{sx:{fontWeight:"bold",backgroundColor:o.palette.primary.main,color:o.palette.common.white},children:"Acciones"})]})}),t.jsx(ce,{children:V.map(e=>{const a=ee(e.id);return t.jsxs(q,{hover:!0,selected:a,onClick:()=>Z(e.id),children:[t.jsx(h,{padding:"checkbox",children:t.jsx(M,{checked:a})}),t.jsx(h,{children:e.id}),t.jsx(h,{children:H===e.id?t.jsx(P,{value:w,size:"small",autoFocus:!0,onChange:r=>E(r.target.value),onBlur:()=>O(e.id),onKeyDown:r=>{r.key==="Enter"&&O(e.id),r.key==="Escape"&&T(null)}}):t.jsxs(L,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(le,{fontSize:"small",color:"action",sx:{cursor:"pointer"},onClick:r=>{r.stopPropagation(),R(e.id,e.name)}}),t.jsx("span",{onDoubleClick:()=>R(e.id,e.name),style:{cursor:"pointer"},title:"Doble click para editar",children:e.name})]})}),t.jsx(h,{children:t.jsx(v,{size:"small",color:"error",onClick:r=>{r.stopPropagation(),A(e.id)},children:t.jsx(W,{})})})]},e.id)})})]}),t.jsx(ge,{component:"div",count:g.length,page:y,rowsPerPage:b,onPageChange:(e,a)=>N(a),onRowsPerPageChange:e=>{G(parseInt(e.target.value,10)),N(0)},rowsPerPageOptions:[5,10,25],labelRowsPerPage:"Filas por página"})]}),t.jsxs(xe,{open:$,onClose:()=>C(!1),children:[t.jsx(fe,{children:"Crear Nueva Categoría"}),t.jsx(be,{children:t.jsx(P,{autoFocus:!0,fullWidth:!0,margin:"dense",label:"Nombre de la categoría",value:m,onChange:e=>f(e.target.value)})}),t.jsxs(je,{children:[t.jsx(I,{onClick:()=>C(!1),children:"Cancelar"}),t.jsx(I,{variant:"contained",onClick:Q,children:"Crear"})]})]}),t.jsx(Ce,{open:!!S,message:S,onClose:()=>c(null),autoHideDuration:4e3})]})}export{Ge as default};

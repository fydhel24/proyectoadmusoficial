import{q as M,r as m,v as k,j as e,$ as W,Y}from"./app-DWYhLQL6.js";import{A as _}from"./app-layout-p7K4X7eV.js";import{d as p}from"./index-CHqsbLd4.js";import{D as H}from"./Delete-mfqLQQwu.js";import{d as U}from"./dayjs.min-DD258iJ7.js";import{B as o}from"./Box-BbMU-_RR.js";import{T as n}from"./Typography-IkT196je.js";import{G as u}from"./Grid-DU2EuT6q.js";import{T as d}from"./TextField-MHNYv_sC.js";import{T as C}from"./TableContainer-DwTJ9q9t.js";import{P as S}from"./Paper-EniTK7He.js";import{T as y,a as I,b as l,c as w}from"./TableRow-DBOU2XrP.js";import{T as s}from"./TableCell-C5DOKis2.js";import{A as q}from"./Autocomplete-V3kj0McP.js";import{F as D,I as P,S as A}from"./Select-DJEe7ust.js";import{M as z}from"./MenuItem-Bm9YqGqc.js";import{B as $}from"./Button-BrLf_Pls.js";import{I as G}from"./IconButton-BGvBFu85.js";import"./button-wMTuvAkw.js";import"./clsx-B-dksMZM.js";import"./avatar-C0bnmZQz.js";import"./createLucideIcon-DISkT-zV.js";import"./index-vDywYphy.js";import"./index-CvZMSx04.js";import"./index-C-qtZoBa.js";import"./settings-B1FLQ7wV.js";import"./app-logo-icon-HoYzQaBs.js";import"./createSvgIcon-C-V1FIKo.js";import"./DefaultPropsProvider-CHy6HlRv.js";import"./createSimplePaletteValueFilter-WGi9SSDd.js";import"./useThemeProps-Bas4AH8z.js";import"./getThemeProps-DLKBaTjH.js";import"./isMuiElement-D94hBNTL.js";import"./useSlot-CO4IlLCl.js";import"./TransitionGroupContext-D4TXwhqE.js";import"./useId-o3zk_1yM.js";import"./useFormControl-CsRgqpY5.js";import"./Close-DmBjolgA.js";import"./useControlled-5UsadrEY.js";import"./usePreviousProps-VIxPXDBR.js";import"./useTimeout-CcjJ2cmE.js";import"./Portal-Dt5KHSRP.js";import"./Fade-BWgYys4A.js";import"./Popper-BNtv9MeI.js";import"./index-DtBJPI5W.js";import"./ownerDocument-DW-IO8s5.js";import"./useSlotProps-CBCDIG0V.js";import"./Chip-Dd1dfm5j.js";import"./ButtonBase-DpqQEAAf.js";import"./List-DOdfdsGa.js";import"./Modal-N30Js5sT.js";import"./createChainedFunction-BO_9K8Jh.js";import"./debounce-Be36O1Ab.js";import"./Grow-IF_zPiYA.js";import"./listItemTextClasses-Cw1PQWTE.js";import"./dividerClasses-BOZ5yH6J.js";import"./CircularProgress-Bo20HsGQ.js";function Oe(){var v;const{fecha:h,tareasAsignadas:c,todasTareas:x}=M().props,[i,j]=m.useState(null),[f,E]=m.useState(""),a=k({tarea_id:null,estado:"pendiente",detalle:""}),g=m.useMemo(()=>{const r=new Map;return c.forEach(t=>r.set(t.user.id,t.user)),Array.from(r.values())},[c]),B=g.filter(r=>r.name.toLowerCase().includes(f.toLowerCase())||r.email.toLowerCase().includes(f.toLowerCase())),b=i?c.filter(r=>r.user.id===i):[],F=(r,t)=>{p.Inertia.patch(route("asignaciones.update",r),{estado:t},{preserveScroll:!0,preserveState:!0})},L=(r,t)=>{p.Inertia.patch(route("asignaciones.update",r),{detalle:t},{preserveScroll:!0,preserveState:!0})};return e.jsxs(_,{children:[e.jsx(W,{title:"Tareas Asignadas por Día"}),e.jsxs(o,{sx:{p:3,maxWidth:1200,mx:"auto"},children:[e.jsxs(o,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsx(Y,{href:route("asignaciones.fechas"),children:"← Volver a Fechas"}),e.jsxs(n,{variant:"h4",children:["Tareas – ",U(h).format("DD MMM YYYY")]})]}),e.jsxs(u,{container:!0,spacing:3,children:[e.jsxs(u,{item:!0,xs:12,md:4,children:[e.jsx(n,{variant:"h6",children:"Usuarios"}),e.jsx(d,{fullWidth:!0,placeholder:"Buscar usuario",size:"small",sx:{mb:2},onChange:r=>{E(r.target.value),j(null)}}),e.jsx(C,{component:S,sx:{maxHeight:300},children:e.jsxs(y,{stickyHeader:!0,size:"small",children:[e.jsx(I,{children:e.jsxs(l,{children:[e.jsx(s,{padding:"checkbox"}),e.jsx(s,{children:"Nombre"}),e.jsx(s,{children:"Email"})]})}),e.jsx(w,{children:B.map(r=>e.jsxs(l,{hover:!0,selected:i===r.id,onClick:()=>j(t=>t===r.id?null:r.id),sx:{cursor:"pointer"},children:[e.jsx(s,{padding:"checkbox",children:i===r.id&&e.jsx(n,{children:"✓"})}),e.jsx(s,{children:r.name}),e.jsx(s,{children:r.email})]},r.id))})]})})]}),e.jsxs(u,{item:!0,xs:12,md:8,children:[e.jsx(o,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:e.jsx(n,{variant:"h6",children:i?`Tareas de ${(v=g.find(r=>r.id===i))==null?void 0:v.name}`:"Seleccione un usuario"})}),i&&e.jsxs(o,{component:"form",onSubmit:r=>{r.preventDefault(),a.post(route("asignaciones.store",{fecha:h,user:i}),{preserveScroll:!0,preserveState:!0,onSuccess:()=>a.reset()})},sx:{mb:2,display:"flex",gap:2,flexWrap:"wrap",alignItems:"center"},children:[e.jsx(q,{options:x,getOptionLabel:r=>r.titulo,size:"small",sx:{width:250},value:x.find(r=>r.id===a.data.tarea_id)||null,onChange:(r,t)=>a.setData("tarea_id",(t==null?void 0:t.id)||null),renderInput:r=>e.jsx(d,{...r,label:"Buscar tarea",required:!0})}),e.jsxs(D,{size:"small",sx:{width:160},children:[e.jsx(P,{id:"estado-label",children:"Estado"}),e.jsx(A,{labelId:"estado-label",label:"Estado",value:a.data.estado,onChange:r=>a.setData("estado",r.target.value),required:!0,children:["pendiente","en_revision","publicada"].map(r=>e.jsx(z,{value:r,children:r.charAt(0).toUpperCase()+r.slice(1)},r))})]}),e.jsx(d,{label:"Detalle",size:"small",value:a.data.detalle,onChange:r=>a.setData("detalle",r.target.value),sx:{width:250}}),e.jsx($,{variant:"contained",type:"submit",disabled:a.processing,children:"Añadir"})]}),e.jsx(C,{component:S,sx:{maxHeight:360},children:e.jsxs(y,{stickyHeader:!0,size:"small",children:[e.jsx(I,{children:e.jsxs(l,{children:[e.jsx(s,{children:"Título"}),e.jsx(s,{children:"Estado"}),e.jsx(s,{children:"Detalle"}),e.jsx(s,{children:"Acciones"})]})}),e.jsx(w,{children:b.length>0?b.map(r=>e.jsxs(l,{hover:!0,children:[e.jsx(s,{children:r.tarea.titulo}),e.jsx(s,{children:e.jsx(D,{size:"small",fullWidth:!0,children:e.jsx(A,{value:r.estado,onChange:t=>F(r.id,t.target.value),sx:{minWidth:120},children:["pendiente","en_revision","publicada"].map(t=>e.jsx(z,{value:t,children:t.charAt(0).toUpperCase()+t.slice(1)},t))})})}),e.jsx(s,{children:e.jsx(d,{defaultValue:r.detalle,size:"small",fullWidth:!0,onBlur:t=>{const T=t.target.value;T!==r.detalle&&L(r.id,T)}})}),e.jsx(s,{children:e.jsx(G,{size:"small",onClick:()=>{confirm("¿Eliminar asignación?")&&p.Inertia.delete(route("asignaciones.destroy",r.id),{preserveScroll:!0,preserveState:!0})},children:e.jsx(H,{fontSize:"small"})})})]},r.id)):e.jsx(l,{children:e.jsx(s,{colSpan:4,align:"center",children:"No hay tareas para este usuario en esta fecha."})})})]})})]})]})]})]})}export{Oe as default};

import{r as o,j as e,$ as I,m as h}from"./app-DWYhLQL6.js";import{A}from"./app-layout-p7K4X7eV.js";import"./button-wMTuvAkw.js";import"./clsx-B-dksMZM.js";import"./avatar-C0bnmZQz.js";import"./createLucideIcon-DISkT-zV.js";import"./index-vDywYphy.js";import"./index-CvZMSx04.js";import"./index-C-qtZoBa.js";import"./settings-B1FLQ7wV.js";import"./app-logo-icon-HoYzQaBs.js";import"./createSvgIcon-C-V1FIKo.js";import"./DefaultPropsProvider-CHy6HlRv.js";const Q=({planes:C})=>{const[b,m]=o.useState(C),[w,g]=o.useState(!1),[d,j]=o.useState(null),[l,c]=o.useState(""),[y,k]=o.useState(""),[S,i]=o.useState(null),[x,f]=o.useState(""),_=(s,a,t)=>{const n=b.map(r=>r.id===s?{...r,[a]:t}:r);m(n)},E=s=>{h.post("/planes-empresas/save",s,{preserveScroll:!0})},T=s=>{j(s),c(""),g(!0)},u=()=>{g(!1),j(null),c("")},F=()=>{!l.trim()||!d||h.post("/comentarios-planes",{contenido:l,plan_empresa_id:d},{onSuccess:()=>{m(s=>s.map(a=>a.id===d?{...a,comentarios:[...a.comentarios||[],{id:Date.now(),contenido:l,user:{name:"Tú"}}]}:a)),u()}})},N=(s,a,t)=>{if(!a.trim()||!t){i(null);return}h.post("/comentarios-planes/update",{id:s,contenido:a},{preserveScroll:!0,onSuccess:()=>{m(n=>n.map(r=>{var v;return r.id===t?{...r,comentarios:(v=r.comentarios)==null?void 0:v.map(p=>p.id===s?{...p,contenido:a}:p)}:r})),i(null)}})},P=b.filter(s=>s.empresa.name.toLowerCase().includes(y.toLowerCase()));return e.jsxs(A,{children:[e.jsx(I,{title:"Planes de Empresas"}),e.jsxs("div",{className:"relative container mx-auto p-6",children:[e.jsx("h1",{className:"mb-6 text-2xl font-bold",children:"Planes de Empresas"}),e.jsx("button",{onClick:()=>window.open("/planes-empresas/pdf","_blank"),className:"mb-4 rounded bg-green-600 px-4 py-2 text-white hover:bg-green-700",children:"Generar PDF"}),e.jsx("div",{className:"mb-4 flex items-center justify-between",children:e.jsx("input",{type:"text",placeholder:"Buscar por empresa...",value:y,onChange:s=>k(s.target.value),className:"w-full max-w-sm rounded border border-gray-300 px-4 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none"})}),e.jsxs("table",{className:"min-w-full border border-gray-200 bg-white shadow-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 text-left text-sm font-semibold",children:[e.jsx("th",{className:"px-4 py-2",children:"Empresa"}),e.jsx("th",{className:"px-4 py-2",children:"TikTok (Mes)"}),e.jsx("th",{className:"px-4 py-2",children:"TikTok (Semana)"}),e.jsx("th",{className:"px-4 py-2",children:"Facebook (Mes)"}),e.jsx("th",{className:"px-4 py-2",children:"Facebook (Semana)"}),e.jsx("th",{className:"px-4 py-2",children:"Instagram (Mes)"}),e.jsx("th",{className:"px-4 py-2",children:"Instagram (Semana)"}),e.jsx("th",{className:"px-4 py-2",children:"Mensajes"}),e.jsx("th",{className:"px-4 py-2",children:"Comentarios"})]})}),e.jsx("tbody",{children:P.map((s,a)=>e.jsxs("tr",{className:"border-t text-sm",children:[e.jsxs("td",{className:"px-4 py-2 text-xs",children:[e.jsx("div",{children:e.jsx("a",{href:`/empresas/${s.empresa_id}/seguimiento-videos`,className:"text-blue-600 underline hover:text-blue-800",children:s.empresa.name})}),e.jsxs("div",{className:"text-gray-700",children:["Cat: ",s.empresa.category_name]}),e.jsxs("div",{className:"text-gray-700",children:["Plan: ",s.empresa.paquete_nombre]}),e.jsxs("div",{className:"text-gray-700 italic",children:["Infl: ",s.empresa.influencer]})]}),["tiktok_mes","tiktok_semana","facebook_mes","facebook_semana","instagram_mes","instagram_semana","mensajes"].map(t=>e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"text",value:s[t]||"",onChange:n=>_(s.id,t,n.target.value),onBlur:()=>E(s),className:"w-full rounded border px-2 py-1 text-sm"})},t)),e.jsxs("td",{className:"px-4 py-2 align-top",children:[e.jsx("button",{onClick:()=>T(s.id),className:"rounded bg-blue-500 px-2 py-1 text-white hover:bg-blue-600",children:"Agregar"}),e.jsx("div",{className:"mt-2 max-h-32 overflow-y-auto rounded border border-gray-200 bg-gray-50 p-2 text-xs text-gray-700",children:s.comentarios&&s.comentarios.length>0?s.comentarios.map(t=>{var n;return e.jsxs("div",{className:"mb-1 border-b border-gray-200 pb-1 last:border-none",children:[e.jsx("div",{className:"font-semibold",children:((n=t.user)==null?void 0:n.name)||"Anónimo"}),S===t.id?e.jsx("input",{type:"text",className:"w-full rounded border px-1 py-0.5 text-xs",value:x,autoFocus:!0,onChange:r=>f(r.target.value),onBlur:()=>N(t.id,x,s.id),onKeyDown:r=>{r.key==="Enter"?(r.preventDefault(),N(t.id,x,s.id)):r.key==="Escape"&&i(null)}}):e.jsx("div",{onClick:()=>{i(t.id),f(t.contenido)},className:"cursor-pointer",title:"Click para editar",children:t.contenido})]},t.id)}):e.jsx("div",{className:"text-gray-400 italic",children:"Sin comentarios"})})]})]},s.empresa_id))})]}),w&&e.jsxs("div",{className:"fixed top-0 right-0 z-50 flex h-full w-96 flex-col border-l border-gray-300 bg-white p-6 shadow-lg",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Agregar Comentario"}),e.jsx("button",{onClick:u,className:"text-xl font-bold text-gray-600 hover:text-gray-900","aria-label":"Cerrar",children:"×"})]}),e.jsx("textarea",{rows:6,className:"mb-4 w-full resize-none rounded border p-2",value:l,onChange:s=>c(s.target.value),placeholder:"Escribe tu comentario aquí..."}),e.jsxs("div",{className:"mt-auto flex justify-end gap-2",children:[e.jsx("button",{onClick:u,className:"rounded border px-4 py-2 hover:bg-gray-100",children:"Cancelar"}),e.jsx("button",{onClick:F,className:"rounded bg-blue-600 px-4 py-2 text-white hover:bg-blue-700 disabled:opacity-50",disabled:!l.trim(),children:"Guardar"})]})]})]})]})};export{Q as default};

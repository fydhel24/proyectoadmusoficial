import{j as e,q as Me,r as c,a as y}from"./app-BS78KgI9.js";import{A as ie,B as le,P as _e}from"./app-layout-DXAC2WAv.js";import{u as Re,T as s,P as qe}from"./Typography-CcX01ihT.js";import{B as j}from"./Box-DUIKlT8z.js";import{S as p}from"./Stack-D-Gkkt_v.js";import{T as He}from"./TextField-CvGdJWCa.js";import{C as M}from"./Card-Cu_cYAkA.js";import{C as _}from"./CardContent-CAp0mljq.js";import{B as S}from"./Button-DqXQBeNq.js";import{P as Ne}from"./PictureAsPdf-NzZasuJV.js";import{T as Ve,a as Ge,b as R,c as Qe}from"./TableRow-HyuXIcfb.js";import{T as h}from"./TableCell-Bw8sPQev.js";import{A as k}from"./Avatar-Bg0t12nq.js";import{S as Ue}from"./Schedule-BBI9pTkp.js";import{C as E}from"./Chip-co4ExwZU.js";import{D as ce}from"./Delete-BBGxcFmB.js";import{T as de}from"./Tooltip-IWvH1ko8.js";import{I as P}from"./IconButton-CZ7CUvid.js";import{A as Ye}from"./Add--ainIzPA.js";import{D as me,a as pe,b as fe}from"./DialogTitle-DtfVYivh.js";import{C as he}from"./Close-BY2rlbAm.js";import{F as q,I as H,S as N}from"./Select-9OsFqQh0.js";import{M as V}from"./MenuItem-D3GBDHMT.js";import{F as Je}from"./FormControlLabel-CLdvIqrW.js";import{S as Xe}from"./Switch-pCUu358Z.js";import{D as ge}from"./DialogActions-DeDSLuz4.js";import{W as xe}from"./WbSunny-BtGTupMV.js";import{c as Ke}from"./createSvgIcon-12aY9Ngm.js";import{N as Ze}from"./NightsStay-C6JPlj0I.js";import{b as l}from"./DefaultPropsProvider-Dk6HDr1M.js";import"./button-oAFDZpeO.js";import"./clsx-B-dksMZM.js";import"./avatar-BWsYigjR.js";import"./createLucideIcon-D-6WHVmO.js";import"./index-Qic-rRyU.js";import"./index--gTV4hvx.js";import"./index-DBd0QHkk.js";import"./settings-DV0Bctrx.js";import"./app-logo-icon-GUvtkzgu.js";import"./useThemeProps-hgA8uWgq.js";import"./getThemeProps--CMPU-9n.js";import"./useSlot-DerHgNuN.js";import"./useTimeout-oSTK7AfQ.js";import"./useId-DZf0Wwsg.js";import"./ButtonBase-DLk8W6EL.js";import"./CircularProgress-DHT395bS.js";import"./index-BZb61BhM.js";import"./useControlled-wSjlUgLl.js";import"./Fade-FGt6R6vx.js";import"./Grow-CxMvSjLL.js";import"./Popper-DnDfq_y6.js";import"./Portal-CCwm8dqL.js";import"./useSlotProps-Cf7xKLKx.js";import"./Modal-BH4F5tNL.js";import"./isMuiElement-w8fP3KeW.js";import"./List-ctjg6MFH.js";import"./debounce-Be36O1Ab.js";import"./listItemTextClasses-CBB9ZnPp.js";import"./dividerClasses-893dsvZ6.js";import"./SwitchBase-D7t7AbaY.js";const er=Ke(e.jsx("path",{d:"M9 2c-1.05 0-2.05.16-3 .46 4.06 1.27 7 5.06 7 9.54s-2.94 8.27-7 9.54c.95.3 1.95.46 3 .46 5.52 0 10-4.48 10-10S14.52 2 9 2"})),cn=()=>{const d=Re(),ue=Me().props,{datosPorEmpresa:be=[],diasSemana:x=[],influencers:F=[],pasantes:je=[],asignacionesPasantes:v={},currentWeek:ye={id:0,name:""}}=ue,[w,Se]=c.useState(be),[A,we]=c.useState(""),[Ce,G]=c.useState(!1),[m,T]=c.useState(null),[z,Q]=c.useState(""),[L,U]=c.useState(!1),[B,Y]=c.useState(""),[ke,J]=c.useState(!1),[D,X]=c.useState(""),[I,f]=c.useState(!1),[K,Z]=c.useState(null),[ee,O]=c.useState(null),[rr,re]=c.useState(0),ve=c.useMemo(()=>{if(!A.trim())return w;const r=n=>n.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase();return w.filter(n=>{var a;return r(((a=n==null?void 0:n.empresa)==null?void 0:a.name)||"").includes(r(A))})},[A,w]),W=["linear-gradient(135deg, #667eea 0%, #764ba2 100%)","linear-gradient(135deg, #f093fb 0%, #f5576c 100%)","linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)","linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)","linear-gradient(135deg, #fa709a 0%, #fee140 100%)","linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)","linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)","linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)"],Ae={monday:"Lunes",tuesday:"Martes",wednesday:"Mi칠rcoles",thursday:"Jueves",friday:"Viernes",saturday:"S치bado",sunday:"Domingo"},ne=r=>{switch(r){case"ma침ana":return e.jsx(xe,{fontSize:"small"});case"tarde":return e.jsx(Ze,{fontSize:"small"});case"noche":return e.jsx(er,{fontSize:"small"});default:return e.jsx(xe,{fontSize:"small"})}},ae=r=>{switch(r){case"ma침ana":return"linear-gradient(135deg, #FFD700 0%, #FFA500 100%)";case"tarde":return"linear-gradient(135deg, #4A90E2 0%, #7B68EE 100%)";case"noche":return"linear-gradient(135deg, #2C3E50 0%, #4A148C 100%)";default:return"linear-gradient(135deg, #FFD700 0%, #FFA500 100%)"}},ze=(r,n,a)=>{T({empresaId:r,dia:n,turno:a}),G(!0),re(0)},Ie=(r,n,a)=>{T({empresaId:r,dia:n,turno:a}),J(!0),re(1)},g=()=>{G(!1),J(!1),T(null),Q(""),Y(""),X(""),U(!1)},We=async(r,n,a,o)=>{f(!0);try{await y.post("/quitar-influencer",{empresa_id:r,dia:n,turno:a,influencer_id:o}),Se(t=>t.map(i=>i.empresa.id===r?{...i,influencersAsignados:{...i.influencersAsignados,[n]:{...i.influencersAsignados[n],[a]:i.influencersAsignados[n][a].filter(u=>u.id!==o)}}}:i))}catch(t){console.error("Error al quitar influencer:",t),alert("Hubo un error al quitar el influencer")}finally{f(!1)}},Ee=async r=>{f(!0);try{await y.delete(`/asignacion-pasantes/${r}`),window.location.reload()}catch(n){console.error("Error al quitar pasante:",n),alert("Hubo un error al quitar el pasante")}finally{f(!1)}},Pe=async()=>{if(!m)return;const r=[];if(z&&r.push(y.post("/asignar-influencer",{empresa_id:m.empresaId,dia:m.dia,turno:m.turno,influencer_id:z})),L&&B&&r.push(y.post("/asignar-influencer",{empresa_id:m.empresaId,dia:m.dia,turno:m.turno,influencer_id:B})),r.length===0){alert("Debes seleccionar al menos un influencer.");return}f(!0);try{await Promise.all(r),g(),window.location.reload()}catch(n){console.error("Error al asignar influencer(es):",n),alert("Hubo un error al asignar el influencer.")}finally{f(!1)}},Fe=async()=>{if(!m||!D){alert("Debes seleccionar un pasante.");return}f(!0);try{const n=Te()[m.dia];await y.post("/asignacion-pasantes",{user_id:D,company_id:m.empresaId,turno:m.turno,dia:m.dia,week_id:ye.id,fecha:n}),g(),window.location.reload()}catch(r){console.error("Error al asignar pasante:",r),alert("Hubo un error al asignar el pasante.")}finally{f(!1)}},Te=()=>{const r={};return x.length>0&&x.forEach((n,a)=>{r[n.nombre.toLowerCase()]=n.fecha}),r},Le=r=>{try{return new Date(r).toLocaleDateString("es-ES",{day:"numeric",month:"short"})}catch{return r}},Be=()=>w.reduce((r,n)=>r+Object.values((n==null?void 0:n.influencersAsignados)||{}).reduce((a,o)=>a+Object.values(o||{}).reduce((t,i)=>t+((i==null?void 0:i.length)||0),0),0),0),De=()=>{let r=0;return Object.values(v||{}).forEach(n=>{Object.values(n||{}).forEach(a=>{Object.values(a||{}).forEach(o=>{r+=(o==null?void 0:o.length)||0})})}),r},Oe=(r,n,a)=>{var o,t;return((t=(o=v==null?void 0:v[r])==null?void 0:o[n])==null?void 0:t[a])||[]},$e=async()=>{var r,n;f(!0),Z(null),O(null);try{const a=await y.post("/asignar-empresas-masivamente");Z(a.data.message),console.log("Detalle de asignaciones:",a.data.detalle),window.location.reload()}catch(a){(n=(r=a.response)==null?void 0:r.data)!=null&&n.message?O(a.response.data.message):O("Ocurri칩 un error inesperado al asignar empresas.")}finally{f(!1)}},$=r=>r?r.split(" ")[0]:"",te=["ma침ana","tarde","noche"];return!x||x.length===0?e.jsx(ie,{children:e.jsx(j,{p:3,children:e.jsx(s,{variant:"h4",children:"Cargando datos..."})})}):e.jsx(ie,{children:e.jsxs(j,{p:3,sx:{background:`linear-gradient(135deg, ${l(d.palette.primary.light,.05)} 0%, ${l(d.palette.secondary.light,.05)} 100%)`,minHeight:"100vh"},children:[e.jsxs(j,{mb:4,children:[e.jsxs(p,{direction:{xs:"column",md:"row"},spacing:3,alignItems:"center",justifyContent:"space-between",children:[e.jsxs(j,{children:[e.jsx(s,{variant:"h3",fontWeight:"bold",sx:{background:`linear-gradient(45deg, ${d.palette.primary.main}, ${d.palette.secondary.main})`,backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",mb:1},children:"游늰 Gesti칩n Semanal"}),e.jsx(s,{variant:"h6",color:"text.secondary",children:"Asignaci칩n de influencers y pasantes por empresa y turno"})]}),e.jsx(j,{mb:2,display:"flex",alignItems:"center",gap:2,children:e.jsx(He,{label:"Buscar empresa",variant:"outlined",size:"small",value:A,onChange:r=>we(r.target.value),sx:{minWidth:280,background:"#fff",borderRadius:2}})}),e.jsxs(p,{direction:"row",spacing:2,children:[e.jsx(M,{sx:{minWidth:120},children:e.jsxs(_,{sx:{py:1.5,px:2,textAlign:"center"},children:[e.jsx(s,{variant:"h4",fontWeight:"bold",color:"primary",children:w.length}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Empresas"})]})}),e.jsx(M,{sx:{minWidth:120},children:e.jsxs(_,{sx:{py:1.5,px:2,textAlign:"center"},children:[e.jsx(s,{variant:"h4",fontWeight:"bold",color:"secondary",children:Be()}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Influencers"})]})}),e.jsx(M,{sx:{minWidth:120},children:e.jsxs(_,{sx:{py:1.5,px:2,textAlign:"center"},children:[e.jsx(s,{variant:"h4",fontWeight:"bold",color:"success",children:De()}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Pasantes"})]})})]})]}),e.jsxs(j,{mt:3,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,children:[e.jsx(S,{variant:"contained",startIcon:e.jsx(Ne,{}),onClick:()=>window.open("/disponibilidad-semanal-pdf","_blank"),sx:{textTransform:"none",fontWeight:"bold",borderRadius:3,background:"linear-gradient(135deg, #6a11cb 0%, #2575fc 100%)",boxShadow:`0 8px 32px ${l("#2575fc",.3)}`,px:4,py:1.5,"&:hover":{background:"linear-gradient(135deg, #4b0eb9 0%, #1a56d0 100%)",transform:"translateY(-2px)",boxShadow:`0 12px 40px ${l("#2575fc",.4)}`},transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)"},children:"Generar Reporte PDF"}),e.jsxs(j,{children:[e.jsx(S,{variant:"contained",onClick:$e,disabled:I,sx:{textTransform:"none",fontWeight:"bold",borderRadius:3,background:"linear-gradient(135deg, #28a745 0%, #218838 100%)",boxShadow:`0 8px 32px ${l("#218838",.3)}`,px:4,py:1.5,"&:hover":{background:"linear-gradient(135deg, #1e7e34 0%, #1c7430 100%)",transform:"translateY(-2px)",boxShadow:`0 12px 40px ${l("#218838",.4)}`},transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)"},children:I?"Asignando...":"Asignar Empresas Masivamente"}),K&&e.jsx(s,{mt:1,color:"success.main",fontWeight:"medium",children:K}),ee&&e.jsx(s,{mt:1,color:"error.main",fontWeight:"medium",children:ee})]})]})]}),e.jsx(qe,{elevation:0,sx:{overflowX:"auto",borderRadius:4,background:l(d.palette.background.paper,.8),backdropFilter:"blur(10px)",border:`1px solid ${l(d.palette.divider,.1)}`,position:"relative"},children:e.jsxs(Ve,{sx:{borderCollapse:"separate",borderSpacing:0,fontSize:"0.80rem"},children:[e.jsxs(Ge,{children:[e.jsxs(R,{sx:{background:"linear-gradient(135deg, #6a11cb 0%, #2575fc 100%)","& th":{color:"#fff",fontFamily:"'Poppins', sans-serif",fontWeight:"600",fontSize:"0.90rem",py:1,px:1}},children:[e.jsx(h,{sx:{width:120,pl:1,position:"sticky",left:0,zIndex:10,background:"linear-gradient(135deg, #6a11cb 0%, #2575fc 100%)",borderRight:"1px solid rgba(255,255,255,0.2)"},children:e.jsxs(p,{direction:"row",alignItems:"center",gap:.5,children:[e.jsx(k,{sx:{bgcolor:l("#fff",.2),width:24,height:24},children:e.jsx(le,{fontSize:"small"})}),e.jsx("span",{style:{fontSize:"0.95rem"},children:"Empresa"})]})}),e.jsx(h,{sx:{width:80,pl:1,fontWeight:"bold"},children:"Turno"}),x.map((r,n)=>e.jsx(h,{align:"center",children:e.jsxs(p,{alignItems:"center",gap:.2,children:[e.jsx(k,{sx:{bgcolor:l("#fff",.2),width:20,height:20},children:e.jsx(Ue,{fontSize:"inherit"})}),e.jsx(s,{fontWeight:"bold",fontSize:"0.80rem",children:Ae[r.nombre.toLowerCase()]??r.nombre}),e.jsx(E,{label:Le(r.fecha),size:"small",sx:{bgcolor:l("#fff",.2),color:"#fff",fontSize:"0.65rem",height:18,px:.5}})]})},n))]}),te.map(r=>e.jsxs(R,{sx:{background:"linear-gradient(90deg, #f5f7fa 0%, #c3cfe2 100%)","& td":{fontFamily:"'Poppins', sans-serif",fontSize:"0.75rem",py:.5,px:1,color:"#333",borderBottom:"1px solid #e0e0e0"}},children:[r==="ma침ana"&&e.jsx(h,{rowSpan:3,sx:{fontWeight:"bold",color:"#666",background:"linear-gradient(90deg, #f5f7fa 0%, #c3cfe2 100%)",verticalAlign:"middle",position:"sticky",left:0,zIndex:10,borderRight:"1px solid rgba(224,224,224,0.5)"},children:"Influencers disponibles"}),e.jsx(h,{sx:{fontWeight:"bold",color:r==="ma침ana"?"#FFA500":r==="tarde"?"#4A90E2":"#2C3E50",verticalAlign:"middle",background:"transparent",borderBottom:"1px solid #e0e0e0"},children:e.jsxs(p,{direction:"row",alignItems:"center",gap:1,children:[e.jsx(k,{sx:{background:ae(r),width:20,height:20,fontSize:"1rem"},children:ne(r)}),e.jsx(s,{fontWeight:"bold",fontSize:"0.80rem",children:r.charAt(0).toUpperCase()+r.slice(1)})]})}),x.map((n,a)=>{const o=F.filter(t=>t.availabilities&&t.availabilities.some(i=>{var u,C;return((u=i.day_of_week)==null?void 0:u.toLowerCase())===n.nombre.toLowerCase()&&((C=i.turno)==null?void 0:C.toLowerCase())===r}));return e.jsx(h,{align:"center",children:e.jsx(p,{direction:"row",spacing:.5,alignItems:"center",flexWrap:"wrap",justifyContent:"center",children:o.length>0?o.map(t=>e.jsx(E,{label:$(t.name),size:"small",sx:{fontSize:"0.68rem",bgcolor:l(r==="ma침ana"?d.palette.primary.light:r==="tarde"?d.palette.secondary.light:d.palette.info.light,.15),color:r==="ma침ana"?d.palette.primary.dark:r==="tarde"?d.palette.secondary.dark:d.palette.info.dark,mb:.1}},`${r}-${t.id}`)):e.jsx(s,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.68rem"},children:"-"})})},a)})]},`disponibilidad-${r}`))]}),e.jsx(Qe,{children:ve.map((r,n)=>te.map((a,o)=>e.jsxs(R,{sx:{background:W[n%W.length],"& td":{fontFamily:"'Poppins', sans-serif",fontSize:"0.80rem",py:1,px:1}},children:[o===0?e.jsx(h,{rowSpan:3,sx:{fontWeight:"bold",color:"#fff",background:W[n%W.length],verticalAlign:"middle",position:"sticky",left:0,zIndex:10,borderRight:"1px solid rgba(224,224,224,0.5)"},children:e.jsxs(p,{direction:"row",alignItems:"center",gap:1,children:[e.jsx(k,{sx:{bgcolor:l("#fff",.25),color:"#333",width:28,height:28,fontWeight:"bold",fontSize:"1.1rem"},children:e.jsx(le,{fontSize:"small"})}),e.jsx(s,{fontWeight:"bold",fontSize:"1rem",children:r.empresa.name})]})}):null,e.jsx(h,{sx:{fontWeight:"bold",color:a==="ma침ana"?"#FFA500":a==="tarde"?"#4A90E2":"#2C3E50",verticalAlign:"middle",background:"transparent",borderBottom:"1px solid #e0e0e0"},children:e.jsxs(p,{direction:"row",alignItems:"center",gap:1,children:[e.jsx(k,{sx:{background:ae(a),width:20,height:20,fontSize:"1rem"},children:ne(a)}),e.jsx(s,{fontWeight:"bold",fontSize:"0.80rem",children:a.charAt(0).toUpperCase()+a.slice(1)})]})}),x.map((t,i)=>{var se,oe;const u=((oe=(se=r.influencersAsignados)==null?void 0:se[t.nombre.toLowerCase()])==null?void 0:oe[a])||[],C=Oe(r.empresa.id,a,t.nombre.toLowerCase());return e.jsx(h,{align:"center",children:e.jsxs(p,{direction:"column",spacing:.5,alignItems:"center",justifyContent:"center",children:[e.jsxs(p,{direction:"row",spacing:.5,flexWrap:"wrap",justifyContent:"center",children:[u.length>0?u.map(b=>e.jsx(E,{label:$(b.name),size:"small",color:"primary",sx:{fontSize:"0.70rem",bgcolor:l("#fff",.25),color:"#333",mb:.2},onDelete:()=>We(r.empresa.id,t.nombre.toLowerCase(),a,b.id),deleteIcon:e.jsx(ce,{fontSize:"small"})},b.id)):e.jsx(s,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.68rem"},children:"-"}),e.jsx(de,{title:"Asignar influencer",children:e.jsx(P,{size:"small",color:"primary",onClick:()=>ze(r.empresa.id,t.nombre.toLowerCase(),a),sx:{ml:.5},children:e.jsx(Ye,{fontSize:"small"})})})]}),e.jsxs(p,{direction:"row",spacing:.5,flexWrap:"wrap",justifyContent:"center",mt:.5,children:[C.length>0?C.map(b=>e.jsx(E,{label:$(b.user.name),size:"small",color:"success",sx:{fontSize:"0.70rem",bgcolor:l("#fff",.18),color:"#333",mb:.2},onDelete:()=>Ee(b.id),deleteIcon:e.jsx(ce,{fontSize:"small"})},b.id)):e.jsx(e.Fragment,{}),e.jsx(de,{title:"Asignar pasante",children:e.jsx(P,{size:"small",color:"success",onClick:()=>Ie(r.empresa.id,t.nombre.toLowerCase(),a),sx:{ml:.5},children:e.jsx(_e,{fontSize:"small"})})})]})]})},i)})]},`${r.empresa.id}-${a}`)))})]})}),e.jsxs(me,{open:Ce,onClose:g,maxWidth:"xs",fullWidth:!0,children:[e.jsxs(pe,{children:["Asignar Influencer",e.jsx(P,{"aria-label":"close",onClick:g,sx:{position:"absolute",right:8,top:8,color:r=>r.palette.grey[500]},children:e.jsx(he,{})})]}),e.jsxs(fe,{children:[e.jsxs(q,{fullWidth:!0,sx:{mb:2},children:[e.jsx(H,{children:"Influencer"}),e.jsx(N,{value:z,onChange:r=>Q(r.target.value),label:"Influencer",children:F.map(r=>e.jsx(V,{value:r.id,children:r.name},r.id))})]}),e.jsx(Je,{control:e.jsx(Xe,{checked:L,onChange:r=>U(r.target.checked),color:"primary"}),label:"Agregar otro influencer"}),L&&e.jsxs(q,{fullWidth:!0,sx:{mt:2},children:[e.jsx(H,{children:"Influencer extra"}),e.jsx(N,{value:B,onChange:r=>Y(r.target.value),label:"Influencer extra",children:F.filter(r=>r.id!==z).map(r=>e.jsx(V,{value:r.id,children:r.name},r.id))})]})]}),e.jsxs(ge,{children:[e.jsx(S,{onClick:g,children:"Cancelar"}),e.jsx(S,{onClick:Pe,variant:"contained",color:"primary",disabled:I,children:"Asignar"})]})]}),e.jsxs(me,{open:ke,onClose:g,maxWidth:"xs",fullWidth:!0,children:[e.jsxs(pe,{children:["Asignar Pasante",e.jsx(P,{"aria-label":"close",onClick:g,sx:{position:"absolute",right:8,top:8,color:r=>r.palette.grey[500]},children:e.jsx(he,{})})]}),e.jsx(fe,{children:e.jsxs(q,{fullWidth:!0,children:[e.jsx(H,{children:"Pasante"}),e.jsx(N,{value:D,onChange:r=>X(r.target.value),label:"Pasante",children:je.map(r=>e.jsxs(V,{value:r.id,children:[r.name," (",r.email,")"]},r.id))})]})}),e.jsxs(ge,{children:[e.jsx(S,{onClick:g,children:"Cancelar"}),e.jsx(S,{onClick:Fe,variant:"contained",color:"success",disabled:I,children:"Asignar"})]})]})]})})};export{cn as default};

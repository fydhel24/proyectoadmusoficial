import{r as o,a as d,j as r,$ as Y}from"./app-DpimSwWW.js";import{A as Z}from"./app-layout-D5OrI1FG.js";import{u as _,P as ee,T as re}from"./Typography-KhbTzJKe.js";import{u as oe}from"./index-DBzhtlNW.js";import{B as I}from"./Box-CcvOzitD.js";import{T as p}from"./TextField-pyf36G8w.js";import{I as h}from"./IconButton-BtLKT3mk.js";import{S as te}from"./Search-Ct1doS4x.js";import{B as k}from"./Button-Wm0H3U4H.js";import{E as W}from"./Edit-ZmCSNoYm.js";import{T as se}from"./TableContainer-B8F1Zvae.js";import{T as ae,a as ie,b as M,c as le}from"./TableRow-N8g30skt.js";import{T as s}from"./TableCell-DTOdW9i4.js";import{C as N}from"./Checkbox-rjN0LcSe.js";import{D as ne}from"./Delete-H3bfBGYi.js";import{D as me,a as ce,b as de}from"./DialogTitle-DvoWtW-x.js";import{C as D}from"./Close-DVzdr6ZP.js";import{F as pe,I as he,S as ue}from"./Select-CnVUmuq6.js";import{M as B}from"./MenuItem-tKSb3dvZ.js";import{D as xe}from"./DialogActions-BvV5DOfo.js";import"./button-CFsyWUbq.js";import"./clsx-B-dksMZM.js";import"./avatar-CMLXmpAO.js";import"./createLucideIcon-D4CW-wHK.js";import"./index-CTw00F6I.js";import"./index-C0zh00gI.js";import"./index-VNCpVeP9.js";import"./settings-DlGdy5XP.js";import"./app-logo-icon-ZRykUD-a.js";import"./createSvgIcon-CzCXeKc2.js";import"./DefaultPropsProvider-DZDWfkmA.js";import"./createSimplePaletteValueFilter-CGtfMTWx.js";import"./getThemeProps-B8XpDgi_.js";import"./useTimeout-BOj4Dk7I.js";import"./useSlot-wiR_y7XT.js";import"./TransitionGroupContext-eXL9qMo5.js";import"./useId-B3TWxL2D.js";import"./ButtonBase-pmj5C_mX.js";import"./CircularProgress-DtoVrIul.js";import"./SwitchBase-sM3yfSLK.js";import"./useControlled-BSzbgMqW.js";import"./Fade-C4vPWcQd.js";import"./Modal-CR54Ot3q.js";import"./ownerDocument-DW-IO8s5.js";import"./Portal-b9dgGZtC.js";import"./isMuiElement-D4a5-yK2.js";import"./index-DRp8ehcT.js";import"./useSlotProps-DEgqb-LW.js";import"./List-BgLYZ338.js";import"./debounce-Be36O1Ab.js";import"./Grow-CQQAZfUW.js";import"./listItemTextClasses-AIltRUCP.js";import"./dividerClasses-CuYbhpCd.js";const fe=[{title:"Usuarios y Roles",href:"/users-roles"}];function fr(){const[L,z]=o.useState([]),[A,l]=o.useState(!1),[u,x]=o.useState(""),[f,g]=o.useState(""),[j,T]=o.useState(""),[b,C]=o.useState(null),[H,P]=o.useState([]),[w,U]=o.useState(!1),[m,R]=o.useState(!1),[$,q]=o.useState(null),[S,F]=o.useState(""),[c,v]=o.useState([]),a=_(),i=oe(a.breakpoints.down("sm"));o.useEffect(()=>{y(),G()},[]);const y=()=>{d.get("/api/users").then(e=>z(e.data)).catch(e=>console.error("Error fetching users:",e))},G=()=>{d.get("/api/roles").then(e=>P(e.data)).catch(e=>console.error("Error fetching roles:",e))},Q=()=>{R(!1),x(""),g(""),T(""),C(""),l(!0)},X=e=>{var t;R(!0),q(e.id),x(e.name),g(e.email),C(((t=e.roles[0])==null?void 0:t.name)||""),l(!0)},J=()=>{if(!u.trim()||!f.trim()||!m&&!j.trim()||!b)return alert("Todos los campos son obligatorios");U(!0);const e={name:u,email:f,password:j,role:b};(m?d.put(`/users/${$}`,e):d.post("/users",e)).then(()=>{l(!1),y()}).catch(E=>{console.error("Error guardando el usuario:",E),alert("Hubo un error")}).finally(()=>U(!1))},K=e=>{confirm("¿Estás seguro de que deseas eliminar este usuario?")&&d.delete(`/users/${e}`).then(()=>y()).catch(t=>{console.error("Error al eliminar el usuario:",t),alert("Hubo un error al eliminar el usuario")})},n=L.filter(e=>e.name.toLowerCase().includes(S.toLowerCase())||e.email.toLowerCase().includes(S.toLowerCase())),O=e=>{v(t=>t.includes(e)?t.filter(E=>E!==e):[...t,e])},V=()=>{c.length===n.length?v([]):v(n.map(e=>e.id))};return r.jsxs(Z,{breadcrumbs:fe,children:[r.jsx(Y,{title:"Usuarios y Roles"}),r.jsxs(I,{sx:{padding:2},children:[r.jsxs(I,{sx:{display:"flex",alignItems:"center",marginBottom:2},children:[r.jsx(p,{label:"Buscar",variant:"outlined",size:"small",fullWidth:!0,value:S,onChange:e=>F(e.target.value),sx:{marginRight:2},InputProps:{startAdornment:r.jsx(h,{children:r.jsx(te,{})})}}),r.jsx(k,{variant:"contained",color:"primary",sx:{ml:2},onClick:Q,startIcon:r.jsx(W,{}),children:"Nuevo Usuario"})]}),r.jsx(se,{component:ee,sx:{borderRadius:2,boxShadow:3,overflowX:"auto",maxHeight:"calc(100vh - 200px)"},children:r.jsxs(ae,{stickyHeader:!0,sx:{minWidth:650},children:[r.jsx(ie,{children:r.jsxs(M,{children:[r.jsx(s,{padding:"checkbox",children:r.jsx(N,{color:"primary",checked:n.length>0&&c.length===n.length,indeterminate:c.length>0&&c.length<n.length,onChange:V})}),r.jsx(s,{sx:{fontWeight:"bold",backgroundColor:a.palette.primary.main,color:a.palette.common.white,padding:i?"8px":"16px",fontSize:i?"0.875rem":"1rem"},children:"Nombre"}),r.jsx(s,{sx:{fontWeight:"bold",backgroundColor:a.palette.primary.main,color:a.palette.common.white,padding:i?"8px":"16px",fontSize:i?"0.875rem":"1rem"},children:"Email"}),r.jsx(s,{sx:{fontWeight:"bold",backgroundColor:a.palette.primary.main,color:a.palette.common.white,padding:i?"8px":"16px",fontSize:i?"0.875rem":"1rem"},children:"Rol"}),r.jsx(s,{sx:{fontWeight:"bold",backgroundColor:a.palette.primary.main,color:a.palette.common.white,padding:i?"8px":"16px",fontSize:i?"0.875rem":"1rem"},children:"Acciones"})]})}),r.jsx(le,{children:n.map(e=>r.jsxs(M,{hover:!0,children:[r.jsx(s,{padding:"checkbox",children:r.jsx(N,{color:"primary",checked:c.includes(e.id),onChange:()=>O(e.id)})}),r.jsx(s,{children:e.name}),r.jsx(s,{children:e.email}),r.jsx(s,{children:e.roles&&e.roles.length>0?e.roles.map(t=>t.name).join(", "):r.jsx("span",{className:"italic text-gray-400",children:"Sin rol"})}),r.jsxs(s,{children:[r.jsx(h,{color:"primary",onClick:()=>X(e),"aria-label":"Editar",children:r.jsx(W,{})}),r.jsx(h,{color:"error",onClick:()=>K(e.id),"aria-label":"Eliminar",children:r.jsx(ne,{})})]})]},e.id))})]})})]}),r.jsxs(me,{open:A,onClose:()=>l(!1),maxWidth:"sm",fullWidth:!0,children:[r.jsxs(ce,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx(re,{variant:"h6",children:m?"Editar Usuario":"Crear Nuevo Usuario"}),r.jsx(h,{onClick:()=>l(!1),children:r.jsx(D,{})})]}),r.jsxs(de,{dividers:!0,children:[r.jsx(p,{label:"Nombre del usuario",variant:"outlined",fullWidth:!0,value:u,onChange:e=>x(e.target.value),sx:{mb:2}}),r.jsx(p,{label:"Email del usuario",variant:"outlined",fullWidth:!0,value:f,onChange:e=>g(e.target.value),sx:{mb:2}}),!m&&r.jsx(p,{label:"Contraseña",variant:"outlined",fullWidth:!0,type:"password",value:j,onChange:e=>T(e.target.value),sx:{mb:2}}),r.jsxs(pe,{fullWidth:!0,sx:{mb:2},children:[r.jsx(he,{id:"select-role-label",children:"Rol"}),r.jsxs(ue,{labelId:"select-role-label",value:b||"",label:"Rol",onChange:e=>C(e.target.value),children:[r.jsx(B,{value:"",children:r.jsx("em",{children:"Seleccionar rol"})}),H.map(e=>r.jsx(B,{value:e.name,children:e.name},e.id))]})]})]}),r.jsxs(xe,{children:[r.jsx(k,{onClick:()=>l(!1),color:"inherit",variant:"outlined",disabled:w,startIcon:r.jsx(D,{}),children:"Cancelar"}),r.jsx(k,{onClick:J,color:"primary",variant:"contained",disabled:w,children:w?"Guardando...":m?"Actualizar":"Crear"})]})]})]})}export{fr as default};

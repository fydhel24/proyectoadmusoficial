import{r as t,a as d,j as e,$ as O}from"./app-DWYhLQL6.js";import{A as U}from"./app-layout-p7K4X7eV.js";import{u as V,P as Z}from"./Paper-EniTK7He.js";import{u as _}from"./index-BcECN-C9.js";import{B as T}from"./Box-BbMU-_RR.js";import{T as v}from"./TextField-MHNYv_sC.js";import{I as x}from"./IconButton-BGvBFu85.js";import{S as ee}from"./Search-DU2LiQPG.js";import{B as C}from"./Button-BrLf_Pls.js";import{E as P}from"./Edit-y_0_0Hdp.js";import{T as oe}from"./TableContainer-DwTJ9q9t.js";import{T as re,a as te,b as I,c as se}from"./TableRow-DBOU2XrP.js";import{T as s}from"./TableCell-C5DOKis2.js";import{C as y}from"./Checkbox-CWR5Giys.js";import{D as ie}from"./Delete-mfqLQQwu.js";import{D as ae,a as ne,b as le}from"./DialogTitle-BRc-au27.js";import{T as D}from"./Typography-IkT196je.js";import{C as B}from"./Close-CWq84GBm.js";import{F as me}from"./FormGroup-CSMZ22Zq.js";import{F as ce}from"./FormControlLabel-C_q7oJPT.js";import{D as de}from"./DialogActions-2fZYmJbN.js";import"./button-wMTuvAkw.js";import"./clsx-B-dksMZM.js";import"./avatar-C0bnmZQz.js";import"./createLucideIcon-DISkT-zV.js";import"./index-vDywYphy.js";import"./index-CvZMSx04.js";import"./index-C-qtZoBa.js";import"./settings-B1FLQ7wV.js";import"./app-logo-icon-HoYzQaBs.js";import"./createSvgIcon-C-V1FIKo.js";import"./DefaultPropsProvider-CHy6HlRv.js";import"./getThemeProps-DLKBaTjH.js";import"./useTimeout-CcjJ2cmE.js";import"./useSlot-CO4IlLCl.js";import"./TransitionGroupContext-D4TXwhqE.js";import"./useId-o3zk_1yM.js";import"./Select-DJEe7ust.js";import"./useFormControl-CsRgqpY5.js";import"./isMuiElement-D94hBNTL.js";import"./createSimplePaletteValueFilter-WGi9SSDd.js";import"./index-DtBJPI5W.js";import"./useSlotProps-CBCDIG0V.js";import"./List-DOdfdsGa.js";import"./ownerDocument-DW-IO8s5.js";import"./Modal-N30Js5sT.js";import"./createChainedFunction-BO_9K8Jh.js";import"./Portal-Dt5KHSRP.js";import"./Fade-BWgYys4A.js";import"./debounce-Be36O1Ab.js";import"./Grow-IF_zPiYA.js";import"./useControlled-5UsadrEY.js";import"./ButtonBase-DpqQEAAf.js";import"./CircularProgress-Bo20HsGQ.js";import"./SwitchBase-B7zN4q3R.js";const pe=[{title:"Roles y Permisos",href:"/roles-permissions"}];function uo(){const[M,N]=t.useState([]),[W,n]=t.useState(!1),[u,p]=t.useState(""),[R,h]=t.useState([]),[A,H]=t.useState([]),[f,S]=t.useState(!1),[g,k]=t.useState(!1),[L,z]=t.useState(null),[w,F]=t.useState(""),[c,j]=t.useState([]),i=V(),l=_(i.breakpoints.down("sm"));t.useEffect(()=>{b(),$()},[]);const b=()=>{d.get("/api/roles").then(o=>N(o.data)).catch(o=>console.error("Error fetching roles:",o))},$=()=>{d.get("/api/permissions").then(o=>H(o.data)).catch(o=>console.error("Error fetching permissions:",o))},q=()=>{k(!1),p(""),h([]),n(!0)},G=o=>{var r;k(!0),z(o.id),p(o.name),h(((r=o.permissions)==null?void 0:r.map(a=>a.name))||[]),n(!0)},Q=()=>{if(!u.trim())return alert("El nombre del rol es obligatorio");S(!0);const o={name:u,permissions:R};(g?d.put(`/roles/${L}`,o):d.post("/create/roles",o)).then(()=>{n(!1),p(""),h([]),b()}).catch(a=>{console.error("Error guardando el rol:",a),alert("Hubo un error")}).finally(()=>S(!1))},X=o=>{confirm("¿Estás seguro de que deseas eliminar este rol?")&&d.delete(`/roles/${o}`).then(()=>b()).catch(r=>{console.error("Error al eliminar el rol:",r),alert("Hubo un error al eliminar el rol")})},m=M.filter(o=>o.name.toLowerCase().includes(w.toLowerCase())),Y=o=>{j(r=>r.includes(o)?r.filter(a=>a!==o):[...r,o])},J=()=>{c.length===m.length?j([]):j(m.map(o=>o.id))};return e.jsxs(U,{breadcrumbs:pe,children:[e.jsx(O,{title:"Roles y Permisos"}),e.jsxs(T,{sx:{padding:2},children:[e.jsxs(T,{sx:{display:"flex",alignItems:"center",marginBottom:2},children:[e.jsx(v,{label:"Buscar",variant:"outlined",size:"small",fullWidth:!0,value:w,onChange:o=>F(o.target.value),sx:{marginRight:2},InputProps:{startAdornment:e.jsx(x,{children:e.jsx(ee,{})})}}),e.jsx(C,{variant:"contained",color:"primary",sx:{ml:2},onClick:q,startIcon:e.jsx(P,{}),children:"Nuevo Rol"})]}),e.jsx(oe,{component:Z,sx:{borderRadius:2,boxShadow:3,overflowX:"auto",maxHeight:"calc(100vh - 200px)"},children:e.jsxs(re,{stickyHeader:!0,sx:{minWidth:650},children:[e.jsx(te,{children:e.jsxs(I,{children:[e.jsx(s,{padding:"checkbox",children:e.jsx(y,{color:"primary",checked:m.length>0&&c.length===m.length,indeterminate:c.length>0&&c.length<m.length,onChange:J})}),e.jsx(s,{sx:{fontWeight:"bold",backgroundColor:i.palette.primary.main,color:i.palette.common.white,padding:l?"8px":"16px",fontSize:l?"0.875rem":"1rem"},children:"Rol"}),e.jsx(s,{sx:{fontWeight:"bold",backgroundColor:i.palette.primary.main,color:i.palette.common.white,padding:l?"8px":"16px",fontSize:l?"0.875rem":"1rem"},children:"Permisos"}),e.jsx(s,{sx:{fontWeight:"bold",backgroundColor:i.palette.primary.main,color:i.palette.common.white,padding:l?"8px":"16px",fontSize:l?"0.875rem":"1rem"},children:"Acciones"})]})}),e.jsx(se,{children:m.map(o=>e.jsxs(I,{hover:!0,children:[e.jsx(s,{padding:"checkbox",children:e.jsx(y,{color:"primary",checked:c.includes(o.id),onChange:()=>Y(o.id)})}),e.jsx(s,{children:o.name}),e.jsx(s,{children:o.permissions&&o.permissions.length>0?e.jsx("ul",{style:{margin:0,paddingLeft:16},children:o.permissions.map(r=>e.jsx("li",{children:r.name},r.id))}):e.jsx("span",{className:"italic text-gray-400",children:"No tiene permisos asignados"})}),e.jsxs(s,{children:[e.jsx(x,{color:"primary",onClick:()=>G(o),"aria-label":"Editar",children:e.jsx(P,{})}),e.jsx(x,{color:"error",onClick:()=>X(o.id),"aria-label":"Eliminar",children:e.jsx(ie,{})})]})]},o.id))})]})})]}),e.jsxs(ae,{open:W,onClose:()=>n(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsxs(ne,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(D,{variant:"h6",children:g?"Editar Rol":"Crear Nuevo Rol"}),e.jsx(x,{onClick:()=>n(!1),children:e.jsx(B,{})})]}),e.jsxs(le,{dividers:!0,children:[e.jsx(v,{label:"Nombre del rol",variant:"outlined",fullWidth:!0,value:u,onChange:o=>p(o.target.value),sx:{mb:2}}),e.jsx(D,{variant:"subtitle1",sx:{mb:1},children:"Permisos"}),e.jsx(me,{sx:{maxHeight:200,overflowY:"auto",pl:1},children:A.map(o=>e.jsx(ce,{control:e.jsx(y,{checked:R.includes(o.name),onChange:r=>{const{checked:a}=r.target;h(E=>a?[...E,o.name]:E.filter(K=>K!==o.name))},value:o.name}),label:o.name},o.id))})]}),e.jsxs(de,{children:[e.jsx(C,{onClick:()=>n(!1),color:"inherit",variant:"outlined",disabled:f,startIcon:e.jsx(B,{}),children:"Cancelar"}),e.jsx(C,{onClick:Q,color:"primary",variant:"contained",disabled:f,children:f?"Guardando...":g?"Actualizar":"Crear"})]})]})]})}export{uo as default};

import{v as Y,r as c,j as e,$ as J,Y as K}from"./app-DWYhLQL6.js";import{A as X}from"./app-layout-p7K4X7eV.js";import{l as j,M as ee,T as ae,a as se,L as F}from"./leaflet-BzwQYN7u.js";import{B as m}from"./Button-BrLf_Pls.js";import{D as re,a as te,b as ie}from"./DialogTitle-BRc-au27.js";import{T as M}from"./Typography-IkT196je.js";import{D as ne}from"./DialogActions-2fZYmJbN.js";import{u as le}from"./hooks-BFTWSKZK.js";import{P as oe}from"./Popup-Dh6cJdko.js";import"./button-wMTuvAkw.js";import"./clsx-B-dksMZM.js";import"./avatar-C0bnmZQz.js";import"./createLucideIcon-DISkT-zV.js";import"./index-vDywYphy.js";import"./index-CvZMSx04.js";import"./index-C-qtZoBa.js";import"./settings-B1FLQ7wV.js";import"./app-logo-icon-HoYzQaBs.js";import"./createSvgIcon-C-V1FIKo.js";import"./DefaultPropsProvider-CHy6HlRv.js";import"./createSimplePaletteValueFilter-WGi9SSDd.js";import"./useId-o3zk_1yM.js";import"./ButtonBase-DpqQEAAf.js";import"./useTimeout-CcjJ2cmE.js";import"./TransitionGroupContext-D4TXwhqE.js";import"./CircularProgress-Bo20HsGQ.js";import"./Paper-EniTK7He.js";import"./useSlot-CO4IlLCl.js";import"./Fade-BWgYys4A.js";import"./Modal-N30Js5sT.js";import"./ownerDocument-DW-IO8s5.js";import"./createChainedFunction-BO_9K8Jh.js";import"./Portal-Dt5KHSRP.js";const P=F.icon({iconUrl:"/Gflores/ubicacion.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});F.Marker.prototype.options.icon=P;const ce={lat:-16.5871,lng:-68.0855},de=13,A=t=>t?new Date(t).toISOString().slice(0,10):"";function Ge({company:t,categories:U,paquetes:R,has_user:q}){const{data:r,setData:n,post:T,processing:O,errors:i}=Y({name:t.name,company_category_id:t.company_category_id.toString(),contract_duration:t.contract_duration,description:t.description||"",direccion:t.direccion,start_date:A(t.start_date),end_date:A(t.end_date),celular:t.celular||"",contrato:null,monto_mensual:t.monto_mensual||"",logo:null,availability:t.availability.length>0?t.availability:[{day_of_week:1,start_time:"",end_time:"",turno:"mañana",cantidad:null}],crear_usuario:!1,influencer:t.influencer??"no",paquete_id:t.paquete_id?String(t.paquete_id):"",nombre_cliente:t.nombre_cliente||"",especificaciones:t.especificaciones||"",seguidores_inicio:t.seguidores_inicio?String(t.seguidores_inicio):"",seguidores_fin:t.seguidores_fin?String(t.seguidores_fin):"",_method:"PUT"}),[g,v]=c.useState(""),[N,y]=c.useState([]),[_,w]=c.useState(!1),[C,$]=c.useState(t.logo_url),[k,I]=c.useState(t.contrato_url),z=()=>{n("availability",[...r.availability,{day_of_week:1,start_time:"",end_time:"",turno:"mañana",cantidad:null}])},S=(a,s,l)=>{const d=[...r.availability];d[a]={...d[a],[s]:l},n("availability",d)},B=a=>{r.availability.length!==1&&n("availability",r.availability.filter((s,l)=>l!==a))},G=a=>{a.preventDefault(),T(`/companies/${t.id}`)},[H,p]=c.useState(!1),[o,b]=c.useState(null),[E,h]=c.useState("");c.useEffect(()=>{if(r.direccion){const[a,s]=r.direccion.split(",").map(Number);!isNaN(a)&&!isNaN(s)&&b(new j.LatLng(a,s))}},[r.direccion]);const V=()=>{h(""),p(!0)},L=()=>{p(!1)},Z=()=>{if(!o){h("Por favor seleccione una ubicación en el mapa");return}const a=Number(o.lat.toFixed(6)),s=Number(o.lng.toFixed(6));n("direccion",`${a},${s}`),p(!1),h("")};function Q(){const a=le({dblclick(s){s.originalEvent.preventDefault();const{lat:l,lng:d}=s.latlng,u=new j.LatLng(Number(l.toFixed(6)),Number(d.toFixed(6)));b(u),h("")}});return c.useEffect(()=>{o&&a.setView(o,a.getZoom())},[o]),o?e.jsx(se,{position:o,icon:P,children:e.jsx(oe,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"Ubicación seleccionada"}),e.jsxs("small",{children:[o.lat.toFixed(6),", ",o.lng.toFixed(6)]})]})})}):null}const D=async a=>{if(a.trim()){w(!0);try{const l=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(a)}&limit=5`)).json();y(l)}catch(s){console.error("Error searching location:",s)}finally{w(!1)}}},W=a=>{const s=new j.LatLng(Number(a.lat),Number(a.lon));b(s),y([]),v("")};return e.jsxs(X,{children:[e.jsx(J,{title:`Editar Empresa - ${t.name}`}),e.jsxs("div",{className:"mx-auto max-w-3xl rounded-xl bg-gradient-to-br from-white via-blue-50 to-blue-100 p-8 shadow-2xl ring-1 ring-blue-100",children:[e.jsxs("h1",{className:"mb-6 text-center text-3xl font-extrabold text-blue-700",children:["Editar Empresa: ",t.name]}),e.jsxs("form",{onSubmit:G,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Nombre de la Empresa"}),e.jsx("input",{type:"text",className:"mt-2 w-full rounded-md border border-gray-300 p-3 shadow transition focus:border-blue-500 focus:ring-2 focus:ring-blue-300 focus:outline-none",value:r.name,onChange:a=>n("name",a.target.value)}),i.name&&e.jsx("div",{className:"mt-1 text-red-600",children:i.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Categoría"}),e.jsxs("select",{className:"mt-2 w-full rounded-md border border-gray-300 p-3 shadow transition focus:border-blue-500 focus:ring-2 focus:ring-blue-300 focus:outline-none",value:r.company_category_id,onChange:a=>n("company_category_id",a.target.value),children:[e.jsx("option",{value:"",children:"Seleccione una categoría"}),U.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),i.company_category_id&&e.jsx("div",{className:"mt-1 text-red-600",children:i.company_category_id})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Duración del contrato"}),e.jsx("input",{type:"text",className:"mt-2 w-full rounded-md border border-gray-300 p-3 shadow transition focus:border-blue-500 focus:ring-2 focus:ring-blue-300 focus:outline-none",value:r.contract_duration,onChange:a=>n("contract_duration",a.target.value)}),i.contract_duration&&e.jsx("div",{className:"mt-1 text-red-600",children:i.contract_duration})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Fecha de inicio"}),e.jsx("input",{type:"date",className:"mt-2 w-full rounded-md border border-gray-300 p-3 shadow-sm focus:ring-2 focus:ring-blue-500 focus:outline-none",value:r.start_date,onChange:a=>n("start_date",a.target.value)}),i.start_date&&e.jsx("div",{className:"mt-1 text-red-600",children:i.start_date})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Fecha de fin"}),e.jsx("input",{type:"date",className:"mt-2 w-full rounded-md border border-gray-300 p-3 shadow-sm focus:ring-2 focus:ring-blue-500 focus:outline-none",value:r.end_date,onChange:a=>n("end_date",a.target.value)}),i.end_date&&e.jsx("div",{className:"mt-1 text-red-600",children:i.end_date})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Nombre del Cliente"}),e.jsx("input",{type:"text",className:"mt-2 w-full rounded-md border border-gray-300 p-3 shadow transition focus:border-blue-500 focus:ring-2 focus:ring-blue-300 focus:outline-none",value:r.nombre_cliente,onChange:a=>n("nombre_cliente",a.target.value)}),i.nombre_cliente&&e.jsx("div",{className:"mt-1 text-red-600",children:i.nombre_cliente})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Especificaciones"}),e.jsx("input",{type:"text",className:"mt-2 w-full rounded-md border border-gray-300 p-3 shadow transition focus:border-blue-500 focus:ring-2 focus:ring-blue-300 focus:outline-none",value:r.especificaciones,onChange:a=>n("especificaciones",a.target.value)}),i.especificaciones&&e.jsx("div",{className:"mt-1 text-red-600",children:i.especificaciones})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Seguidores Inicio"}),e.jsx("input",{type:"number",className:"mt-2 w-full rounded-md border border-gray-300 p-3 shadow transition focus:border-blue-500 focus:ring-2 focus:ring-blue-300 focus:outline-none",value:r.seguidores_inicio,onChange:a=>n("seguidores_inicio",a.target.value)}),i.seguidores_inicio&&e.jsx("div",{className:"mt-1 text-red-600",children:i.seguidores_inicio})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Seguidores Fin"}),e.jsx("input",{type:"number",className:"mt-2 w-full rounded-md border border-gray-300 p-3 shadow transition focus:border-blue-500 focus:ring-2 focus:ring-blue-300 focus:outline-none",value:r.seguidores_fin,onChange:a=>n("seguidores_fin",a.target.value)}),i.seguidores_fin&&e.jsx("div",{className:"mt-1 text-red-600",children:i.seguidores_fin})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Dirección",e.jsx("span",{className:"ml-1 text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"text",className:"mt-2 w-full rounded-md border border-gray-300 p-3 shadow-sm focus:ring-2 focus:ring-blue-500 focus:outline-none",value:r.direccion,placeholder:"Seleccione una ubicación en el mapa",readOnly:!0}),e.jsx(m,{variant:"contained",color:"primary",onClick:V,children:"Seleccionar Ubicación"})]}),i.direccion&&e.jsx("div",{className:"mt-1 text-red-600",children:i.direccion})]}),e.jsxs(re,{open:H,onClose:L,maxWidth:"md",fullWidth:!0,children:[e.jsxs(te,{children:["Seleccionar Ubicación",e.jsx(M,{variant:"caption",component:"div",color:"textSecondary",children:"Haga doble clic en el mapa para seleccionar la ubicación"})]}),e.jsxs(ie,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"text",className:"w-full rounded-md border border-gray-300 p-2",placeholder:"Buscar ubicación...",value:g,onChange:a=>v(a.target.value),onKeyPress:a=>{a.key==="Enter"&&(a.preventDefault(),D(g))}}),e.jsx(m,{onClick:()=>D(g),variant:"contained",disabled:_,children:_?"Buscando...":"Buscar"})]}),N.length>0&&e.jsx("div",{className:"mt-2 max-h-40 overflow-y-auto rounded-md border border-gray-200",children:N.map((a,s)=>e.jsx("div",{className:"cursor-pointer border-b border-gray-200 p-2 hover:bg-gray-100",onClick:()=>W(a),children:a.display_name},s))})]}),e.jsxs(ee,{center:o||ce,zoom:de,style:{height:"400px",width:"100%"},doubleClickZoom:!1,className:"rounded-lg border border-gray-300 shadow-md",children:[e.jsx(ae,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'}),e.jsx(Q,{})]}),E&&e.jsx(M,{color:"error",className:"mt-2 text-center",children:E})]}),e.jsxs(ne,{children:[e.jsx(m,{onClick:L,color:"secondary",children:"Cancelar"}),e.jsx(m,{onClick:Z,color:"primary",disabled:!o,children:"Guardar Ubicación"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"¿Es influencer?"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",name:"influencer",value:"si",checked:r.influencer==="si",onChange:()=>n("influencer","si"),className:"form-radio"}),e.jsx("span",{className:"ml-2",children:"Sí"})]}),e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",name:"influencer",value:"no",checked:r.influencer==="no",onChange:()=>n("influencer","no"),className:"form-radio"}),e.jsx("span",{className:"ml-2",children:"No"})]})]}),i.influencer&&e.jsx("div",{className:"mt-1 text-red-600",children:i.influencer})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Paquete"}),e.jsxs("select",{className:"w-full rounded-md border border-gray-300 p-3 shadow transition focus:border-blue-500 focus:ring-2 focus:ring-blue-300 focus:outline-none",value:r.paquete_id,onChange:a=>n("paquete_id",a.target.value),children:[e.jsx("option",{value:"",children:"Seleccione un paquete"}),R.map(a=>e.jsx("option",{value:a.id,children:a.nombre_paquete},a.id))]}),i.paquete_id&&e.jsx("div",{className:"mt-1 text-red-600",children:i.paquete_id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Descripción"}),e.jsx("textarea",{className:"mt-2 w-full rounded-md border border-gray-300 p-3 shadow-sm focus:ring-2 focus:ring-blue-500 focus:outline-none",value:r.description,onChange:a=>n("description",a.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Celular"}),e.jsx("input",{type:"text",className:"mt-2 w-full rounded-md border border-gray-300 p-3 shadow transition focus:border-blue-500 focus:ring-2 focus:ring-blue-300 focus:outline-none",value:r.celular,onChange:a=>{const s=a.target.value;/^\d*$/.test(s)&&n("celular",s)}}),i.celular&&e.jsx("div",{className:"mt-1 text-red-600",children:i.celular})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Monto Mensual"}),e.jsx("input",{type:"text",className:"mt-2 w-full rounded-md border border-gray-300 p-3 shadow transition focus:border-blue-500 focus:ring-2 focus:ring-blue-300 focus:outline-none",value:r.monto_mensual,onChange:a=>{const s=a.target.value;/^\d*\.?\d*$/.test(s)&&n("monto_mensual",s)}}),i.monto_mensual&&e.jsx("div",{className:"mt-1 text-red-600",children:i.monto_mensual})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-8 p-4 md:grid-cols-2",children:[e.jsxs("div",{className:"rounded-lg border p-4 shadow transition hover:shadow-md",children:[e.jsx("h3",{className:"mb-3 text-lg font-semibold",children:"Contrato (PDF)"}),e.jsxs("label",{className:"flex h-20 w-full cursor-pointer flex-col items-center justify-center rounded-lg border-2 border-dashed transition hover:border-blue-500",children:[e.jsx("span",{className:"text-gray-600",children:"Haz clic o arrastra un archivo PDF aquí"}),e.jsx("input",{type:"file",accept:"application/pdf",className:"hidden",onChange:a=>{var l;const s=((l=a.target.files)==null?void 0:l[0])||null;n("contrato",s),I(s?URL.createObjectURL(s):null)}})]}),k&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"mb-2 text-sm text-gray-600",children:r.contrato?"Nuevo archivo seleccionado":"Archivo actual"}),e.jsx("embed",{src:k,type:"application/pdf",width:"100%",height:"300px",className:"rounded border"})]})]}),e.jsxs("div",{className:"rounded-lg border p-4 shadow transition hover:shadow-md",children:[e.jsx("h3",{className:"mb-3 text-lg font-semibold",children:"Logo"}),e.jsxs("label",{className:"flex h-20 w-full cursor-pointer flex-col items-center justify-center rounded-lg border-2 border-dashed transition hover:border-green-500",children:[e.jsx("span",{className:"text-gray-600",children:"Haz clic o arrastra una imagen aquí"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:a=>{var l;const s=((l=a.target.files)==null?void 0:l[0])||null;n("logo",s),$(s?URL.createObjectURL(s):null)}})]}),C&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"mb-2 text-sm text-gray-600",children:r.logo?"Nueva imagen seleccionada":"Imagen actual"}),e.jsx("img",{src:C,alt:"Vista previa del logo",className:"max-h-48 w-full rounded border object-contain"})]})]})]}),!q&&e.jsx("div",{className:"mt-6",children:e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",className:"form-checkbox",checked:r.crear_usuario,onChange:a=>n("crear_usuario",a.target.checked)}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"¿Desea crear usuario para esta empresa?"})]})}),e.jsxs("div",{className:"mt-6",children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Días de disponibilidad"}),r.availability.map((a,s)=>e.jsx("div",{className:"mb-4 flex justify-center",children:e.jsxs("div",{className:"grid w-full max-w-3xl grid-cols-1 gap-4 md:grid-cols-4",children:[e.jsxs("select",{className:"col-span-1 w-full rounded-md border border-gray-300 p-3 shadow-sm focus:ring-2 focus:ring-blue-500 focus:outline-none",value:a.day_of_week,onChange:l=>S(s,"day_of_week",parseInt(l.target.value)),children:[e.jsx("option",{value:1,children:"Lunes"}),e.jsx("option",{value:2,children:"Martes"}),e.jsx("option",{value:3,children:"Miércoles"}),e.jsx("option",{value:4,children:"Jueves"}),e.jsx("option",{value:5,children:"Viernes"}),e.jsx("option",{value:6,children:"Sábado"}),e.jsx("option",{value:7,children:"Domingo"})]}),e.jsxs("select",{className:"col-span-1 w-full rounded-md border border-gray-300 p-3 shadow-sm focus:ring-2 focus:ring-blue-500 focus:outline-none",value:a.turno,onChange:l=>{const d=l.target.value;let u=a.start_time,x=a.end_time;d==="mañana"&&(!u||!x)?(u="09:30",x="13:00"):d==="tarde"&&(!u||!x)&&(u="14:00",x="18:00");const f=[...r.availability];f[s]={...f[s],turno:d,start_time:u,end_time:x},n("availability",f)},children:[e.jsx("option",{value:"mañana",children:"Mañana"}),e.jsx("option",{value:"tarde",children:"Tarde"})]}),e.jsx("div",{className:"col-span-1",children:e.jsx("input",{type:"number",min:"0",className:"w-full rounded-md border border-gray-300 p-3 shadow-sm focus:ring-2 focus:ring-blue-500 focus:outline-none",placeholder:"Cantidad",value:a.cantidad??"",onChange:l=>S(s,"cantidad",l.target.value===""?null:parseInt(l.target.value,10))})}),e.jsx("div",{className:"col-span-1 flex items-center justify-center",children:e.jsx("button",{type:"button",className:"text-xl font-bold text-red-600 hover:text-red-800",onClick:()=>B(s),disabled:r.availability.length===1,title:"Eliminar este día",children:"×"})})]})},s)),e.jsx("div",{className:"flex justify-end",children:e.jsx(m,{type:"button",variant:"outlined",color:"primary",onClick:z,children:"Agregar día"})})]}),e.jsxs("div",{className:"mt-8 flex justify-between",children:[e.jsx(K,{href:"/companies",className:"inline-block rounded-md bg-gray-200 px-6 py-3 text-center font-semibold text-gray-700 shadow transition hover:bg-gray-300",children:"Cancelar"}),e.jsx(m,{type:"submit",variant:"contained",color:"primary",disabled:O,children:"Guardar Cambios"})]})]})]})]})}export{Ge as default};

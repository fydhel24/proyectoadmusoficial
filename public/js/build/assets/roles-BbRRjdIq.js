import{r as n,j as e,a as T,$ as le}from"./app-B43QGLc0.js";import{a as V,g as Z,u as _,s as z,f as ee,c as oe,m as re,A as ne}from"./app-layout-Be3qQQND.js";import{T as D,u as ie,B as X,P as ce}from"./Box-wyR9uVm8.js";import{u as de,C as Y}from"./Close-Cz4RoyBw.js";import{T as J}from"./TextField-DxJvG6sb.js";import{I as N}from"./IconButton-BL5db-mN.js";import{S as me}from"./Search-FSgN8jeY.js";import{B}from"./Button-DYoxZ0OF.js";import{E as K}from"./Edit-ObCAyVeJ.js";import{T as pe,a as ue,b as he,c as O,d as f,e as xe,D as fe}from"./Delete-BkjAzzvM.js";import{C as G}from"./Checkbox-DXyLT61I.js";import{D as be,a as ge,b as je,c as Ce}from"./DialogTitle-DF65PE_P.js";import{c as H}from"./app-logo-icon-2Eh3Z-eT.js";import{u as se,f as te}from"./Select-BCKCZh52.js";import{b as ye}from"./Grow-DipP32jZ.js";import"./index-CfAE_ukx.js";import"./index-HnoccPYx.js";import"./getThemeProps-DFqRyJBL.js";import"./ButtonBase-BmVSOhCT.js";import"./CircularProgress-Bt0vLMV2.js";import"./Portal-DCrN8Gw5.js";function we(r){return Z("MuiFormControlLabel",r)}const E=V("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),Re=r=>{const{classes:s,disabled:a,labelPlacement:t,error:d,required:m}=r,u={root:["root",a&&"disabled",`labelPlacement${ee(t)}`,d&&"error",m&&"required"],label:["label",a&&"disabled"],asterisk:["asterisk",d&&"error"]};return oe(u,we,s)},ve=z("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(r,s)=>{const{ownerState:a}=r;return[{[`& .${E.label}`]:s.label},s.root,s[`labelPlacement${ee(a.labelPlacement)}`]]}})(re(({theme:r})=>({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${E.disabled}`]:{cursor:"default"},[`& .${E.label}`]:{[`&.${E.disabled}`]:{color:(r.vars||r).palette.text.disabled}},variants:[{props:{labelPlacement:"start"},style:{flexDirection:"row-reverse",marginRight:-11}},{props:{labelPlacement:"top"},style:{flexDirection:"column-reverse"}},{props:{labelPlacement:"bottom"},style:{flexDirection:"column"}},{props:({labelPlacement:s})=>s==="start"||s==="top"||s==="bottom",style:{marginLeft:16}}]}))),Pe=z("span",{name:"MuiFormControlLabel",slot:"Asterisk"})(re(({theme:r})=>({[`&.${E.error}`]:{color:(r.vars||r).palette.error.main}}))),Se=n.forwardRef(function(s,a){const t=_({props:s,name:"MuiFormControlLabel"}),{checked:d,className:m,componentsProps:u={},control:c,disabled:v,disableTypography:j,inputRef:C,label:F,labelPlacement:P="end",name:I,onChange:U,required:$,slots:L={},slotProps:q={},value:y,...S}=t,i=se(),p=v??c.props.disabled??(i==null?void 0:i.disabled),b=$??c.props.required,M={disabled:p,required:b};["checked","name","onChange","value","inputRef"].forEach(o=>{typeof c.props[o]>"u"&&typeof t[o]<"u"&&(M[o]=t[o])});const A=te({props:t,muiFormControl:i,states:["error"]}),w={...t,disabled:p,labelPlacement:P,required:b,error:A.error},k=Re(w),W={slots:L,slotProps:{...u,...q}},[h,R]=ye("typography",{elementType:D,externalForwardedProps:W,ownerState:w});let x=F;return x!=null&&x.type!==D&&!j&&(x=e.jsx(h,{component:"span",...R,className:H(k.label,R==null?void 0:R.className),children:x})),e.jsxs(ve,{className:H(k.root,m),ownerState:w,ref:a,...S,children:[n.cloneElement(c,M),b?e.jsxs("div",{children:[x,e.jsxs(Pe,{ownerState:w,"aria-hidden":!0,className:k.asterisk,children:[" ","*"]})]}):x]})});function ke(r){return Z("MuiFormGroup",r)}V("MuiFormGroup",["root","row","error"]);const Te=r=>{const{classes:s,row:a,error:t}=r;return oe({root:["root",a&&"row",t&&"error"]},ke,s)},Ee=z("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(r,s)=>{const{ownerState:a}=r;return[s.root,a.row&&s.row]}})({display:"flex",flexDirection:"column",flexWrap:"wrap",variants:[{props:{row:!0},style:{flexDirection:"row"}}]}),Fe=n.forwardRef(function(s,a){const t=_({props:s,name:"MuiFormGroup"}),{className:d,row:m=!1,...u}=t,c=se(),v=te({props:t,muiFormControl:c,states:["error"]}),j={...t,row:m,error:v.error},C=Te(j);return e.jsx(Ee,{className:H(C.root,d),ownerState:j,ref:a,...u})}),Le=[{title:"Roles y Permisos",href:"/roles-permissions"}];function _e(){const[r,s]=n.useState([]),[a,t]=n.useState(!1),[d,m]=n.useState(""),[u,c]=n.useState([]),[v,j]=n.useState([]),[C,F]=n.useState(!1),[P,I]=n.useState(!1),[U,$]=n.useState(null),[L,q]=n.useState(""),[y,S]=n.useState([]),i=ie(),p=de(i.breakpoints.down("sm"));n.useEffect(()=>{b(),M()},[]);const b=()=>{T.get("/api/roles").then(o=>s(o.data)).catch(o=>console.error("Error fetching roles:",o))},M=()=>{T.get("/api/permissions").then(o=>j(o.data)).catch(o=>console.error("Error fetching permissions:",o))},A=()=>{I(!1),m(""),c([]),t(!0)},w=o=>{var l;I(!0),$(o.id),m(o.name),c(((l=o.permissions)==null?void 0:l.map(g=>g.name))||[]),t(!0)},k=()=>{if(!d.trim())return alert("El nombre del rol es obligatorio");F(!0);const o={name:d,permissions:u};(P?T.put(`/roles/${U}`,o):T.post("/create/roles",o)).then(()=>{t(!1),m(""),c([]),b()}).catch(g=>{console.error("Error guardando el rol:",g),alert("Hubo un error")}).finally(()=>F(!1))},W=o=>{confirm("¿Estás seguro de que deseas eliminar este rol?")&&T.delete(`/roles/${o}`).then(()=>b()).catch(l=>{console.error("Error al eliminar el rol:",l),alert("Hubo un error al eliminar el rol")})},h=r.filter(o=>o.name.toLowerCase().includes(L.toLowerCase())),R=o=>{S(l=>l.includes(o)?l.filter(g=>g!==o):[...l,o])},x=()=>{y.length===h.length?S([]):S(h.map(o=>o.id))};return e.jsxs(ne,{breadcrumbs:Le,children:[e.jsx(le,{title:"Roles y Permisos"}),e.jsxs(X,{sx:{padding:2},children:[e.jsxs(X,{sx:{display:"flex",alignItems:"center",marginBottom:2},children:[e.jsx(J,{label:"Buscar",variant:"outlined",size:"small",fullWidth:!0,value:L,onChange:o=>q(o.target.value),sx:{marginRight:2},InputProps:{startAdornment:e.jsx(N,{children:e.jsx(me,{})})}}),e.jsx(B,{variant:"contained",color:"primary",sx:{ml:2},onClick:A,startIcon:e.jsx(K,{}),children:"Nuevo Rol"})]}),e.jsx(pe,{component:ce,sx:{borderRadius:2,boxShadow:3,overflowX:"auto",maxHeight:"calc(100vh - 200px)"},children:e.jsxs(ue,{stickyHeader:!0,sx:{minWidth:650},children:[e.jsx(he,{children:e.jsxs(O,{children:[e.jsx(f,{padding:"checkbox",children:e.jsx(G,{color:"primary",checked:h.length>0&&y.length===h.length,indeterminate:y.length>0&&y.length<h.length,onChange:x})}),e.jsx(f,{sx:{fontWeight:"bold",backgroundColor:i.palette.primary.main,color:i.palette.common.white,padding:p?"8px":"16px",fontSize:p?"0.875rem":"1rem"},children:"Rol"}),e.jsx(f,{sx:{fontWeight:"bold",backgroundColor:i.palette.primary.main,color:i.palette.common.white,padding:p?"8px":"16px",fontSize:p?"0.875rem":"1rem"},children:"Permisos"}),e.jsx(f,{sx:{fontWeight:"bold",backgroundColor:i.palette.primary.main,color:i.palette.common.white,padding:p?"8px":"16px",fontSize:p?"0.875rem":"1rem"},children:"Acciones"})]})}),e.jsx(xe,{children:h.map(o=>e.jsxs(O,{hover:!0,children:[e.jsx(f,{padding:"checkbox",children:e.jsx(G,{color:"primary",checked:y.includes(o.id),onChange:()=>R(o.id)})}),e.jsx(f,{children:o.name}),e.jsx(f,{children:o.permissions&&o.permissions.length>0?e.jsx("ul",{style:{margin:0,paddingLeft:16},children:o.permissions.map(l=>e.jsx("li",{children:l.name},l.id))}):e.jsx("span",{className:"italic text-gray-400",children:"No tiene permisos asignados"})}),e.jsxs(f,{children:[e.jsx(N,{color:"primary",onClick:()=>w(o),"aria-label":"Editar",children:e.jsx(K,{})}),e.jsx(N,{color:"error",onClick:()=>W(o.id),"aria-label":"Eliminar",children:e.jsx(fe,{})})]})]},o.id))})]})})]}),e.jsxs(be,{open:a,onClose:()=>t(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsxs(ge,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(D,{variant:"h6",children:P?"Editar Rol":"Crear Nuevo Rol"}),e.jsx(N,{onClick:()=>t(!1),children:e.jsx(Y,{})})]}),e.jsxs(je,{dividers:!0,children:[e.jsx(J,{label:"Nombre del rol",variant:"outlined",fullWidth:!0,value:d,onChange:o=>m(o.target.value),sx:{mb:2}}),e.jsx(D,{variant:"subtitle1",sx:{mb:1},children:"Permisos"}),e.jsx(Fe,{sx:{maxHeight:200,overflowY:"auto",pl:1},children:v.map(o=>e.jsx(Se,{control:e.jsx(G,{checked:u.includes(o.name),onChange:l=>{const{checked:g}=l.target;c(Q=>g?[...Q,o.name]:Q.filter(ae=>ae!==o.name))},value:o.name}),label:o.name},o.id))})]}),e.jsxs(Ce,{children:[e.jsx(B,{onClick:()=>t(!1),color:"inherit",variant:"outlined",disabled:C,startIcon:e.jsx(Y,{}),children:"Cancelar"}),e.jsx(B,{onClick:k,color:"primary",variant:"contained",disabled:C,children:C?"Guardando...":P?"Actualizar":"Crear"})]})]})]})}export{_e as default};
